<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Analyze and visualize cell-to-nearest-endothelial-cell distance distributions for the bonemarrow-codex-chop dataset.">

<title>Distance Analysis: bonemarrow-codex-chop – HRA: Cell Distance Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-000f0825b9c55ed21d14970d810c14a9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Distance Analysis: bonemarrow-codex-chop – HRA: Cell Distance Analysis">
<meta property="og:description" content="Analyze and visualize cell-to-nearest-endothelial-cell distance distributions for the bonemarrow-codex-chop dataset.">
<meta property="og:image" content="https://cns-iu.github.io/hra-cell-distance-analysis/09_distance_analysis__bonemarrow-codex-chop_files/figure-html/cell-24-output-1.png">
<meta property="og:site_name" content="HRA: Cell Distance Analysis">
<meta property="og:image:height" content="790">
<meta property="og:image:width" content="1990">
<meta name="twitter:title" content="Distance Analysis: bonemarrow-codex-chop – HRA: Cell Distance Analysis">
<meta name="twitter:description" content="Analyze and visualize cell-to-nearest-endothelial-cell distance distributions for the bonemarrow-codex-chop dataset.">
<meta name="twitter:image" content="https://cns-iu.github.io/hra-cell-distance-analysis/09_distance_analysis__bonemarrow-codex-chop_files/figure-html/cell-24-output-1.png">
<meta name="twitter:image-height" content="790">
<meta name="twitter:image-width" content="1990">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">HRA: Cell Distance Analysis</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./distance_analysis__bonemarrow-codex-chop.html">Distance Analysis: bonemarrow-codex-chop</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cell Distance Analysis for Spatial Omics Datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_processing__convert_to_cde_format.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Processing: Convert to CDE Format</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_processing__crosswalk_cell_type_names.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Processing: Harmonize Cell Types</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_analysis__cell_distribution_across_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Analysis: Call Distribution Across Datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_processing__distance_computation_for_all_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Processing: Cell Distance Computation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__intestine-codex-stanford.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: codex-intestine-stanford</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__pancreas-geomx-ufl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: pancreas-geomx-ufl</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__oralcavity-codex-czi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: oralcavity-codex-czi</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__lung-codex-urmc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: lung-codex-urmc</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__skin-confocal-sorgerlab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: skin-confocal-sorgerlab</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__bonemarrow-codex-chop.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Distance Analysis: bonemarrow-codex-chop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__colon-cycif-sorgerlab-colon-xenium-stanford.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: colon-xenium-stanford and colon-cycif-sorgerlab</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__lymphnode-codex-yale.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: lymphnode-codex-yale</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__spleen-codex-ufl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: spleen-codex-ufl</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__tonsil-codex-stanford-esophagus-codex-stanford.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: tonsil-codex-stanford and esophagus-codex-stanford</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__skin-celldive-ge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: skin-celldive-ge</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__maternalfetalinterface-mibitof-stanford.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: maternalfetalinterface-mibitof-stanford</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset." id="toc-get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset." class="nav-link active" data-scroll-target="#get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset.">Get initial statistics and identify endothelial cell categories for dataset.</a></li>
  <li><a href="#process-datasets-to-add-region-information-to-nodes-files." id="toc-process-datasets-to-add-region-information-to-nodes-files." class="nav-link" data-scroll-target="#process-datasets-to-add-region-information-to-nodes-files.">Process datasets to add region information to Nodes files.</a></li>
  <li><a href="#process-datasets-to-add-region-information-to-edges-files." id="toc-process-datasets-to-add-region-information-to-edges-files." class="nav-link" data-scroll-target="#process-datasets-to-add-region-information-to-edges-files.">Process datasets to add region information to Edges files.</a></li>
  <li><a href="#node-analysis" id="toc-node-analysis" class="nav-link" data-scroll-target="#node-analysis">Node Analysis</a></li>
  <li><a href="#distance-analysis" id="toc-distance-analysis" class="nav-link" data-scroll-target="#distance-analysis">Distance Analysis</a>
  <ul class="collapse">
  <li><a href="#level-one-cell-type-analysis" id="toc-level-one-cell-type-analysis" class="nav-link" data-scroll-target="#level-one-cell-type-analysis">Level One Cell Type Analysis</a></li>
  <li><a href="#level-two-cell-type-analysis" id="toc-level-two-cell-type-analysis" class="nav-link" data-scroll-target="#level-two-cell-type-analysis">Level Two Cell Type Analysis</a></li>
  <li><a href="#level-three-cell-type-analysis" id="toc-level-three-cell-type-analysis" class="nav-link" data-scroll-target="#level-three-cell-type-analysis">Level Three Cell Type Analysis</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/cns-iu/hra-cell-distance-analysis/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="distance_analysis__bonemarrow-codex-chop.html.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Distance Analysis: bonemarrow-codex-chop</h1>
</div>

<div>
  <div class="description">
    Analyze and visualize cell-to-nearest-endothelial-cell distance distributions for the <code>bonemarrow-codex-chop</code> dataset.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div id="5fadacbc" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> normalize</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> _cde_compute_edges_from_nodes <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="va">None</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="va">None</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># suppress warnings</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="adeb3050" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>basepath <span class="op">=</span> <span class="st">"/u/yashjain/hra-cell-distance-analysis/data"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dataset_dir <span class="op">=</span> <span class="st">"bonemarrow-codex-chop"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>data_filedir <span class="op">=</span> os.path.join(<span class="st">"data-processed-nodes-with-harmonized-cell-types"</span>, dataset_dir)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>output_edge_dir <span class="op">=</span> os.path.join(<span class="st">"data-processed-edges"</span>, dataset_dir)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>figures_output_dir <span class="op">=</span> <span class="st">"generated-figures"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="bef847e0" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to load your data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_data(path, edges<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> edges:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        column_names <span class="op">=</span> [<span class="st">'cell_id'</span>, <span class="st">'x1'</span>, <span class="st">'y1'</span>, <span class="st">'z1'</span>, <span class="st">'x2'</span>, <span class="st">'y2'</span>, <span class="st">'z2'</span>]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> pd.read_csv(path, header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>column_names)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> pd.read_csv(path)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="ccf99558" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to read all files ending with "-nodes.csv" in the `data_filedir` directory into a single DataFrame. </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Another additional column `Dataset` is added to identify the dataset name which comes from the filename before the `-nodes.csv` suffix.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Additionally, function reads all files ending with "-edges.csv" in the `output_edge_dir` directory into a single DataFrame. </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Three additional columns are added "Dataset", "Anchor Cell Type", and "Anchor Cell Type Level" to identify the dataset name, anchor cell type, and anchor cell type level respectively which come from the filename before the `.csv` suffix.</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The three additional columns are created by splitting the filename on the `-` character, and extracting the relevant parts.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># On splitting, the first part is the dataset name, second part is the anchor cell type level, and third part is the anchor cell type, and last part is the `edges` suffix.</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># When reading files, check if the file has the correct format (i.e., ends with `-edges.csv`).</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Additionally, the function merges the edges DataFrame with the nodes DataFrame to get the cell type information for the anchor cells.</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># This is done by reading the corresponding nodes file from the `data_filedir` directory for each edges file, and merging it with the edges DataFrame on the `cell_id` column.</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># The merged DataFrame contains the edges with additional columns for the cell type information.</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># The function returns three DataFrames:</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. `merged_nodes`: DataFrame containing all nodes with an additional column `Dataset`.</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. `merged_edges`: DataFrame containing all edges with additional columns `Dataset`, `Anchor Cell Type`, and `Anchor Cell Type Level`.</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. `merged_nodes_for_all_edges`: DataFrame containing all edges with additional columns `Dataset`, `Anchor Cell Type`, `Anchor Cell Type Level`, and the cell type information for cells.</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_all_edge_datasets(basepath, data_filedir, output_edge_dir):</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    all_nodes_files <span class="op">=</span> []</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    all_edges_files <span class="op">=</span> []</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    all_nodes_edges_files <span class="op">=</span> []</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir(os.path.join(basepath, output_edge_dir)):</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">"-edges.csv"</span>):</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            file_path <span class="op">=</span> os.path.join(basepath, output_edge_dir, <span class="bu">file</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>            dataset_name, anchor_cell_type_level, anchor_cell_type <span class="op">=</span> <span class="bu">file</span>.replace(<span class="st">"-edges.csv"</span>, <span class="st">""</span>).split(<span class="st">'-'</span>)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            edges_df <span class="op">=</span> load_data(file_path, edges<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>            edges_df[<span class="st">'Dataset'</span>] <span class="op">=</span> dataset_name</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            edges_df[<span class="st">'Anchor Cell Type'</span>] <span class="op">=</span> anchor_cell_type</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>            edges_df[<span class="st">'Anchor Cell Type Level'</span>] <span class="op">=</span> anchor_cell_type_level</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>            edges_df.rename(columns<span class="op">=</span>{<span class="st">"distance"</span>: <span class="st">"Distance"</span>}, inplace<span class="op">=</span><span class="va">True</span>) <span class="co"># Rename column "distance" to "Distance".</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>            all_edges_files.append(edges_df)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Read the corresponding nodes file from data_filedir to get the cell type information</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>            nodes_file_path <span class="op">=</span> os.path.join(basepath, data_filedir, <span class="ss">f"</span><span class="sc">{</span>dataset_name<span class="sc">}</span><span class="ss">-nodes.csv"</span>)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>            nodes_df <span class="op">=</span> load_data(nodes_file_path)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>            nodes_df[<span class="st">'Dataset'</span>] <span class="op">=</span> dataset_name</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>            all_nodes_files.append(nodes_df)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a new 'cell_id' column to nodes_df</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>            nodes_df[<span class="st">'cell_id'</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(nodes_df))</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Set 'cell_id' column as index for nodes_df</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>            nodes_df.set_index(<span class="st">'cell_id'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Merge edges_df with nodes_df to get the cell type information for the anchor cells</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>            edges_nodes_df <span class="op">=</span> pd.merge(edges_df, nodes_df[[<span class="st">'Level Three Cell Type'</span>, <span class="st">'Level Two Cell Type'</span>, <span class="st">'Level One Cell Type'</span>]], how<span class="op">=</span><span class="st">'left'</span>, left_on<span class="op">=</span><span class="st">'cell_id'</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>            all_nodes_edges_files.append(edges_nodes_df)</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    merged_edges <span class="op">=</span> pd.concat(all_edges_files, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    merged_nodes <span class="op">=</span> pd.concat(all_nodes_files, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    merged_nodes_for_all_edges <span class="op">=</span> pd.concat(all_nodes_edges_files, ignore_index<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merged_nodes, merged_edges, merged_nodes_for_all_edges</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="60b3e7da" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_directory(directory):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(directory):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        os.makedirs(directory)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Directory '</span><span class="sc">{</span>directory<span class="sc">}</span><span class="ss">' created successfully."</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Directory '</span><span class="sc">{</span>directory<span class="sc">}</span><span class="ss">' already exists."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset." class="level2">
<h2 class="anchored" data-anchor-id="get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset.">Get initial statistics and identify endothelial cell categories for dataset.</h2>
<div id="ed2deded" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_all_nodes, df_all_edges, df_all_edges_with_cell_types <span class="op">=</span> read_all_edge_datasets(basepath, data_filedir, output_edge_dir)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="77a43e90" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df_all_nodes.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">Original Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three CL Label</th>
<th data-quarto-table-cell-role="th">Level Three CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/3</th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Level Two CL Label</th>
<th data-quarto-table-cell-role="th">Level Two CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/2</th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Level One CL Label</th>
<th data-quarto-table-cell-role="th">Level One CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/1</th>
<th data-quarto-table-cell-role="th">Dataset</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>5776.546667</td>
<td>4000.546667</td>
<td>Erythroid</td>
<td>erythroid lineage cell</td>
<td>erythroid lineage cell</td>
<td>CL:0000764</td>
<td>skos:exactMatch</td>
<td>erythroid precursor</td>
<td>erythroid progenitor cell</td>
<td>CL:0000038</td>
<td>skos:exactMatch</td>
<td>hematopoietic precursor cell</td>
<td>hematopoietic precursor cell</td>
<td>CL:0008001</td>
<td>skos:exactMatch</td>
<td>SB67_NBM48_NSM1_1720</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>6406.298077</td>
<td>4001.134615</td>
<td>B-Cells</td>
<td>b cell</td>
<td>B cell</td>
<td>CL:0000236</td>
<td>skos:exactMatch</td>
<td>b cell</td>
<td>B cell</td>
<td>CL:0000236</td>
<td>skos:exactMatch</td>
<td>immune cell</td>
<td>leukocyte</td>
<td>CL:0000738</td>
<td>skos:exactMatch</td>
<td>SB67_NBM48_NSM1_1720</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>6805.010526</td>
<td>4000.701754</td>
<td>Erythroid</td>
<td>erythroid lineage cell</td>
<td>erythroid lineage cell</td>
<td>CL:0000764</td>
<td>skos:exactMatch</td>
<td>erythroid precursor</td>
<td>erythroid progenitor cell</td>
<td>CL:0000038</td>
<td>skos:exactMatch</td>
<td>hematopoietic precursor cell</td>
<td>hematopoietic precursor cell</td>
<td>CL:0008001</td>
<td>skos:exactMatch</td>
<td>SB67_NBM48_NSM1_1720</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>6032.794326</td>
<td>4002.039007</td>
<td>AEC</td>
<td>endothelial cell of artery</td>
<td>endothelial cell of artery</td>
<td>CL:1000413</td>
<td>skos:exactMatch</td>
<td>endothelial cell of artery</td>
<td>endothelial cell of artery</td>
<td>CL:1000413</td>
<td>skos:exactMatch</td>
<td>endothelial cell</td>
<td>endothelial cell</td>
<td>CL:0000115</td>
<td>skos:exactMatch</td>
<td>SB67_NBM48_NSM1_1720</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>6159.116364</td>
<td>4001.763636</td>
<td>Early Myeloid Progenitor</td>
<td>myeloid progenitor cell:common</td>
<td>common myeloid progenitor</td>
<td>CL:0000049</td>
<td>skos:exactMatch</td>
<td>progenitor cell</td>
<td>hematopoietic precursor cell</td>
<td>CL:0008001</td>
<td>skos:exactMatch</td>
<td>hematopoietic precursor cell</td>
<td>hematopoietic precursor cell</td>
<td>CL:0008001</td>
<td>skos:exactMatch</td>
<td>SB67_NBM48_NSM1_1720</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="600caf4b" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the total number of unique cell types per dataset. Compute separately for each cell type column (Level One Cell Type, Level Two Cell Type, Level Three Cell Type, Original Cell Type).</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Total number of unique cell types per cell type annnotation level:"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>unique_cell_types <span class="op">=</span> {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Original Cell Type'</span>: df_all_nodes[<span class="st">'Original Cell Type'</span>].nunique(),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Three Cell Type'</span>: df_all_nodes[<span class="st">'Level Three Cell Type'</span>].nunique(),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Two Cell Type'</span>: df_all_nodes[<span class="st">'Level Two Cell Type'</span>].nunique(),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level One Cell Type'</span>: df_all_nodes[<span class="st">'Level One Cell Type'</span>].nunique()</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cell_type, count <span class="kw">in</span> unique_cell_types.items():</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>cell_type<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total number of unique cell types per cell type annnotation level:
Original Cell Type: 37
Level Three Cell Type: 33
Level Two Cell Type: 22
Level One Cell Type: 6</code></pre>
</div>
</div>
<div id="d929d75a" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the unique cell types containing "endothelial" in name per cell type column (Level One Cell Type, Level Two Cell Type, Level Three Cell Type, Original Cell Type) to a dictionary where the key is the level and the value is a list of unique cell types.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>endothelial_cell_types <span class="op">=</span> {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Original Cell Type'</span>: df_all_nodes[df_all_nodes[<span class="st">'Original Cell Type'</span>].<span class="bu">str</span>.contains(<span class="st">"endothelial"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)][<span class="st">'Original Cell Type'</span>].unique().tolist(),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Three Cell Type'</span>: df_all_nodes[df_all_nodes[<span class="st">'Level Three Cell Type'</span>].<span class="bu">str</span>.contains(<span class="st">"endothelial"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)][<span class="st">'Level Three Cell Type'</span>].unique().tolist(),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Two Cell Type'</span>: df_all_nodes[df_all_nodes[<span class="st">'Level Two Cell Type'</span>].<span class="bu">str</span>.contains(<span class="st">"endothelial"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)][<span class="st">'Level Two Cell Type'</span>].unique().tolist(),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level One Cell Type'</span>: df_all_nodes[df_all_nodes[<span class="st">'Level One Cell Type'</span>].<span class="bu">str</span>.contains(<span class="st">"endothelial"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)][<span class="st">'Level One Cell Type'</span>].unique().tolist()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Endothelial cell types per cell type annotation level:"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> level, cell_types <span class="kw">in</span> endothelial_cell_types.items():</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cell <span class="kw">in</span> cell_types:</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  - </span><span class="sc">{</span>cell<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Endothelial cell types per cell type annotation level:

Original Cell Type:

Level Three Cell Type:
  - endothelial cell of artery
  - endothelial cell of sinusoid

Level Two Cell Type:
  - endothelial cell of artery
  - endothelial cell of sinusoid

Level One Cell Type:
  - endothelial cell</code></pre>
</div>
</div>
<div id="e245563c" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>type_field_list <span class="op">=</span> [<span class="st">"Level Three Cell Type"</span>, <span class="st">"Level Two Cell Type"</span>, <span class="st">"Level One Cell Type"</span>] <span class="co"># Skipping Original Cell Type as it is not a hierarchical level.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the anchor cell type (type of endothelial cell) for each level in type_field_list based on available categories in the previous cell. The distance analysis at all three levels will be limited to the specified anchor cell type.</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>anchor_cell_type_dict <span class="op">=</span> {</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Three Cell Type'</span>: <span class="st">'endothelial cell of sinusoid'</span>, <span class="co"># Picking sinusoid instead of artery because the cell count of sinusoid is higher than artery in the dataset.</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Two Cell Type'</span>: <span class="st">'endothelial cell of sinusoid'</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level One Cell Type'</span>: <span class="st">'endothelial cell'</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="process-datasets-to-add-region-information-to-nodes-files." class="level2">
<h2 class="anchored" data-anchor-id="process-datasets-to-add-region-information-to-nodes-files.">Process datasets to add region information to Nodes files.</h2>
<div id="634fc0da" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print unique values in Dataset column as a list.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Unique values in Dataset column:"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_all_edges[<span class="st">'Dataset'</span>].unique().tolist())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Unique values in Dataset column:
['SB67_NBM48_NSM1_1720', 'SB67_NBM49_NSM2_1086', 'SB67_NBM47_NSM3_1996', 'SB67_NBM51_AML1_183', 'SB67_NBM46_AML1_382', 'SB67_NBM44_AML2_191', 'SB67_NBM52_AML3_1329', 'SB67_NBM54_AML3_1443', 'SB67_NBM27_H10', 'SB67_NBM28_H14', 'SB67_NBM36_H26', 'SB67_NBM41_H27', 'SB67_NBM31_H32', 'SB67_NBM38_H33', 'SB67_NBM37_H35', 'SB67_NBM33_H36', 'SB67_NBM32_H37', 'SB67_NBM34_H38', 'SB67_NBM40_H39', 'SB67_NBM39_H41']</code></pre>
</div>
</div>
<div id="dcea34e8" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dictionary to map bone marrow regions to correct region names (conditions).</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># AML = Acute Myeloid Leukemia</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># NSM = Negative lymphoma Staging bone Marrow biopsies</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># NBM = Normal Bone Marrow</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>region_map <span class="op">=</span> {</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM48_NSM1_1720'</span>: <span class="st">'NSM'</span>, </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM49_NSM2_1086'</span>: <span class="st">'NSM'</span>, </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM47_NSM3_1996'</span>: <span class="st">'NSM'</span>, </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM51_AML1_183'</span>: <span class="st">'AML'</span>, </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM46_AML1_382'</span>: <span class="st">'AML'</span>, </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM44_AML2_191'</span>: <span class="st">'AML'</span>, </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM52_AML3_1329'</span>: <span class="st">'AML'</span>, </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM54_AML3_1443'</span>: <span class="st">'AML'</span>, </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM27_H10'</span>: <span class="st">'NBM'</span>, </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM28_H14'</span>: <span class="st">'NBM'</span>, </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM36_H26'</span>: <span class="st">'NBM'</span>, </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM41_H27'</span>: <span class="st">'NBM'</span>, </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM31_H32'</span>: <span class="st">'NBM'</span>, </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM38_H33'</span>: <span class="st">'NBM'</span>, </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM37_H35'</span>: <span class="st">'NBM'</span>, </span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM33_H36'</span>: <span class="st">'NBM'</span>, </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM32_H37'</span>: <span class="st">'NBM'</span>, </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM34_H38'</span>: <span class="st">'NBM'</span>, </span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM40_H39'</span>: <span class="st">'NBM'</span>, </span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SB67_NBM39_H41'</span>: <span class="st">'NBM'</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="732cb581" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df_all_nodes.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">Original Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three CL Label</th>
<th data-quarto-table-cell-role="th">Level Three CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/3</th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Level Two CL Label</th>
<th data-quarto-table-cell-role="th">Level Two CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/2</th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Level One CL Label</th>
<th data-quarto-table-cell-role="th">Level One CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/1</th>
<th data-quarto-table-cell-role="th">Dataset</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>5776.546667</td>
<td>4000.546667</td>
<td>Erythroid</td>
<td>erythroid lineage cell</td>
<td>erythroid lineage cell</td>
<td>CL:0000764</td>
<td>skos:exactMatch</td>
<td>erythroid precursor</td>
<td>erythroid progenitor cell</td>
<td>CL:0000038</td>
<td>skos:exactMatch</td>
<td>hematopoietic precursor cell</td>
<td>hematopoietic precursor cell</td>
<td>CL:0008001</td>
<td>skos:exactMatch</td>
<td>SB67_NBM48_NSM1_1720</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>6406.298077</td>
<td>4001.134615</td>
<td>B-Cells</td>
<td>b cell</td>
<td>B cell</td>
<td>CL:0000236</td>
<td>skos:exactMatch</td>
<td>b cell</td>
<td>B cell</td>
<td>CL:0000236</td>
<td>skos:exactMatch</td>
<td>immune cell</td>
<td>leukocyte</td>
<td>CL:0000738</td>
<td>skos:exactMatch</td>
<td>SB67_NBM48_NSM1_1720</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>6805.010526</td>
<td>4000.701754</td>
<td>Erythroid</td>
<td>erythroid lineage cell</td>
<td>erythroid lineage cell</td>
<td>CL:0000764</td>
<td>skos:exactMatch</td>
<td>erythroid precursor</td>
<td>erythroid progenitor cell</td>
<td>CL:0000038</td>
<td>skos:exactMatch</td>
<td>hematopoietic precursor cell</td>
<td>hematopoietic precursor cell</td>
<td>CL:0008001</td>
<td>skos:exactMatch</td>
<td>SB67_NBM48_NSM1_1720</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>6032.794326</td>
<td>4002.039007</td>
<td>AEC</td>
<td>endothelial cell of artery</td>
<td>endothelial cell of artery</td>
<td>CL:1000413</td>
<td>skos:exactMatch</td>
<td>endothelial cell of artery</td>
<td>endothelial cell of artery</td>
<td>CL:1000413</td>
<td>skos:exactMatch</td>
<td>endothelial cell</td>
<td>endothelial cell</td>
<td>CL:0000115</td>
<td>skos:exactMatch</td>
<td>SB67_NBM48_NSM1_1720</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>6159.116364</td>
<td>4001.763636</td>
<td>Early Myeloid Progenitor</td>
<td>myeloid progenitor cell:common</td>
<td>common myeloid progenitor</td>
<td>CL:0000049</td>
<td>skos:exactMatch</td>
<td>progenitor cell</td>
<td>hematopoietic precursor cell</td>
<td>CL:0008001</td>
<td>skos:exactMatch</td>
<td>hematopoietic precursor cell</td>
<td>hematopoietic precursor cell</td>
<td>CL:0008001</td>
<td>skos:exactMatch</td>
<td>SB67_NBM48_NSM1_1720</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="6fddc955" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through the df_all_data dataframe to create new column "Unique Region" based on the "Dataset" column.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The "Unique Region" column is created by mapping the region names based on the full dataset name.</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>df_all_nodes[<span class="st">'Unique Region'</span>] <span class="op">=</span> df_all_nodes[<span class="st">'Dataset'</span>].<span class="bu">map</span>(region_map)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># df_all_nodes['Unique Region'] = df_all_nodes['Dataset'].str.split('-').str[1].map(region_map)</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the new columns are created correctly.</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>df_all_nodes[[<span class="st">'Dataset'</span>, <span class="st">'Unique Region'</span>]].head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>SB67_NBM48_NSM1_1720</td>
<td>NSM</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>SB67_NBM48_NSM1_1720</td>
<td>NSM</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>SB67_NBM48_NSM1_1720</td>
<td>NSM</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>SB67_NBM48_NSM1_1720</td>
<td>NSM</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>SB67_NBM48_NSM1_1720</td>
<td>NSM</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="f0f51fca" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print all unique regions in the data.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Unique Regions in the data:"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_all_nodes[<span class="st">'Unique Region'</span>].unique())</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the total number of unique regions.</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total number of unique regions: </span><span class="sc">{</span>df_all_nodes[<span class="st">'Unique Region'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print number of unique datasets per unique region.</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Number of unique datasets per unique region:"</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> df_all_nodes[<span class="st">'Unique Region'</span>].unique():</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    num_datasets <span class="op">=</span> df_all_nodes[df_all_nodes[<span class="st">'Unique Region'</span>] <span class="op">==</span> region][<span class="st">'Dataset'</span>].nunique()</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>num_datasets<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Unique Regions in the data:
['NSM' 'AML' 'NBM']
Total number of unique regions: 3

Number of unique datasets per unique region:
NSM: 3
AML: 5
NBM: 12</code></pre>
</div>
</div>
</section>
<section id="process-datasets-to-add-region-information-to-edges-files." class="level2">
<h2 class="anchored" data-anchor-id="process-datasets-to-add-region-information-to-edges-files.">Process datasets to add region information to Edges files.</h2>
<div id="681b64bd" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df_all_edges.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cell_id</th>
<th data-quarto-table-cell-role="th">x1</th>
<th data-quarto-table-cell-role="th">y1</th>
<th data-quarto-table-cell-role="th">z1</th>
<th data-quarto-table-cell-role="th">x2</th>
<th data-quarto-table-cell-role="th">y2</th>
<th data-quarto-table-cell-role="th">z2</th>
<th data-quarto-table-cell-role="th">Distance</th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type Level</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1117</td>
<td>5746.650000</td>
<td>4541.361111</td>
<td>0</td>
<td>5895.403361</td>
<td>4573.613445</td>
<td>0</td>
<td>152.209644</td>
<td>SB67_NBM48_NSM1_1720</td>
<td>endothelial cell of artery</td>
<td>Level Three Cell Type</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1145</td>
<td>5734.788679</td>
<td>4551.400000</td>
<td>0</td>
<td>5895.403361</td>
<td>4573.613445</td>
<td>0</td>
<td>162.143496</td>
<td>SB67_NBM48_NSM1_1720</td>
<td>endothelial cell of artery</td>
<td>Level Three Cell Type</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1151</td>
<td>5756.300000</td>
<td>4553.104348</td>
<td>0</td>
<td>5895.403361</td>
<td>4573.613445</td>
<td>0</td>
<td>140.607141</td>
<td>SB67_NBM48_NSM1_1720</td>
<td>endothelial cell of artery</td>
<td>Level Three Cell Type</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1185</td>
<td>5746.238095</td>
<td>4563.619048</td>
<td>0</td>
<td>5895.403361</td>
<td>4573.613445</td>
<td>0</td>
<td>149.499714</td>
<td>SB67_NBM48_NSM1_1720</td>
<td>endothelial cell of artery</td>
<td>Level Three Cell Type</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1268</td>
<td>5624.227027</td>
<td>4594.664865</td>
<td>0</td>
<td>5541.917031</td>
<td>4700.170306</td>
<td>0</td>
<td>133.814549</td>
<td>SB67_NBM48_NSM1_1720</td>
<td>endothelial cell of artery</td>
<td>Level Three Cell Type</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="7feb0112" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Process the edge data to create new columns "Unique Region" based on the "Dataset" column, similar to how it was done for the node data.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>df_all_edges[<span class="st">'Unique Region'</span>] <span class="op">=</span> df_all_edges[<span class="st">'Dataset'</span>].<span class="bu">map</span>(region_map)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the new columns are created correctly.</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>df_all_edges[[<span class="st">'Dataset'</span>, <span class="st">'Unique Region'</span>]].head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>SB67_NBM48_NSM1_1720</td>
<td>NSM</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>SB67_NBM48_NSM1_1720</td>
<td>NSM</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>SB67_NBM48_NSM1_1720</td>
<td>NSM</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>SB67_NBM48_NSM1_1720</td>
<td>NSM</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>SB67_NBM48_NSM1_1720</td>
<td>NSM</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="c8e34640" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print all unique regions in the data.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Unique Regions in the data:"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_all_edges[<span class="st">'Unique Region'</span>].unique())</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the total number of unique regions.</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total number of unique regions: </span><span class="sc">{</span>df_all_edges[<span class="st">'Unique Region'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print number of unique datasets per unique region.</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Number of unique datasets per unique region:"</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> df_all_edges[<span class="st">'Unique Region'</span>].unique():</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    num_datasets <span class="op">=</span> df_all_edges[df_all_edges[<span class="st">'Unique Region'</span>] <span class="op">==</span> region][<span class="st">'Dataset'</span>].nunique()</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>num_datasets<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Unique Regions in the data:
['NSM' 'AML' 'NBM']
Total number of unique regions: 3

Number of unique datasets per unique region:
NSM: 3
AML: 5
NBM: 12</code></pre>
</div>
</div>
<div id="e4ab9fe2" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_types[<span class="st">'Unique Region'</span>] <span class="op">=</span> df_all_edges_with_cell_types[<span class="st">'Dataset'</span>].<span class="bu">map</span>(region_map)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the new columns are created correctly.</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_types[[<span class="st">'Dataset'</span>, <span class="st">'Unique Region'</span>]].head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>SB67_NBM48_NSM1_1720</td>
<td>NSM</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>SB67_NBM48_NSM1_1720</td>
<td>NSM</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>SB67_NBM48_NSM1_1720</td>
<td>NSM</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>SB67_NBM48_NSM1_1720</td>
<td>NSM</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>SB67_NBM48_NSM1_1720</td>
<td>NSM</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="60047aad" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df_all_nodes.head(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">Original Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three CL Label</th>
<th data-quarto-table-cell-role="th">Level Three CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/3</th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Level Two CL Label</th>
<th data-quarto-table-cell-role="th">Level Two CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/2</th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Level One CL Label</th>
<th data-quarto-table-cell-role="th">Level One CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/1</th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>5776.546667</td>
<td>4000.546667</td>
<td>Erythroid</td>
<td>erythroid lineage cell</td>
<td>erythroid lineage cell</td>
<td>CL:0000764</td>
<td>skos:exactMatch</td>
<td>erythroid precursor</td>
<td>erythroid progenitor cell</td>
<td>CL:0000038</td>
<td>skos:exactMatch</td>
<td>hematopoietic precursor cell</td>
<td>hematopoietic precursor cell</td>
<td>CL:0008001</td>
<td>skos:exactMatch</td>
<td>SB67_NBM48_NSM1_1720</td>
<td>NSM</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="c1a92443" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df_all_edges.head(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cell_id</th>
<th data-quarto-table-cell-role="th">x1</th>
<th data-quarto-table-cell-role="th">y1</th>
<th data-quarto-table-cell-role="th">z1</th>
<th data-quarto-table-cell-role="th">x2</th>
<th data-quarto-table-cell-role="th">y2</th>
<th data-quarto-table-cell-role="th">z2</th>
<th data-quarto-table-cell-role="th">Distance</th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type Level</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1117</td>
<td>5746.65</td>
<td>4541.361111</td>
<td>0</td>
<td>5895.403361</td>
<td>4573.613445</td>
<td>0</td>
<td>152.209644</td>
<td>SB67_NBM48_NSM1_1720</td>
<td>endothelial cell of artery</td>
<td>Level Three Cell Type</td>
<td>NSM</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="373cf6f8" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_types.head(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cell_id</th>
<th data-quarto-table-cell-role="th">x1</th>
<th data-quarto-table-cell-role="th">y1</th>
<th data-quarto-table-cell-role="th">z1</th>
<th data-quarto-table-cell-role="th">x2</th>
<th data-quarto-table-cell-role="th">y2</th>
<th data-quarto-table-cell-role="th">z2</th>
<th data-quarto-table-cell-role="th">Distance</th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type Level</th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1117</td>
<td>5746.65</td>
<td>4541.361111</td>
<td>0</td>
<td>5895.403361</td>
<td>4573.613445</td>
<td>0</td>
<td>152.209644</td>
<td>SB67_NBM48_NSM1_1720</td>
<td>endothelial cell of artery</td>
<td>Level Three Cell Type</td>
<td>erythroid lineage cell</td>
<td>erythroid precursor</td>
<td>hematopoietic precursor cell</td>
<td>NSM</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="node-analysis" class="level2">
<h2 class="anchored" data-anchor-id="node-analysis">Node Analysis</h2>
<div id="85eb0da0" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot number of cells per cell type in the same plot. Color by cell type and unique region. Output figure saved in existing `figures_output_dir`.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_cells_per_celltype(df, type_field, output_dir):</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">8</span>))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    sns.countplot(data<span class="op">=</span>df, x<span class="op">=</span>type_field, palette<span class="op">=</span><span class="st">'Spectral'</span>, hue<span class="op">=</span><span class="st">'Unique Region'</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Number of Cells per </span><span class="sc">{</span>type_field<span class="sc">}</span><span class="ss"> in `</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">`'</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_cells_per_celltype_</span><span class="sc">{</span>type_field<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>                pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_cells_per_celltype_</span><span class="sc">{</span>type_field<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>                bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>                pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    plt.legend(title<span class="op">=</span><span class="st">'Unique Region'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.85</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(type_field)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For numbers on y-axis, do not use scientific notation.</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    plt.ticklabel_format(style<span class="op">=</span><span class="st">'plain'</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set y-axis label</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Number of Cells'</span>)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the plot</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> type_field <span class="kw">in</span> type_field_list:</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    plot_cells_per_celltype(df_all_nodes, type_field, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_distance_analysis__bonemarrow-codex-chop_files/figure-html/cell-24-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_distance_analysis__bonemarrow-codex-chop_files/figure-html/cell-24-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_distance_analysis__bonemarrow-codex-chop_files/figure-html/cell-24-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="distance-analysis" class="level2">
<h2 class="anchored" data-anchor-id="distance-analysis">Distance Analysis</h2>
<div id="87e7043f" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get mean, median, minimum, maximum distance per unique region per anchor cell type.</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>df_distance_stats <span class="op">=</span> df_all_edges_with_cell_types.groupby([<span class="st">'Unique Region'</span>, <span class="st">'Anchor Cell Type'</span>, <span class="st">'Anchor Cell Type Level'</span>]).agg(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    min_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'min'</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    max_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'max'</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the first few rows of the distance statistics DataFrame.</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>df_distance_stats</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type Level</th>
<th data-quarto-table-cell-role="th">mean_distance</th>
<th data-quarto-table-cell-role="th">median_distance</th>
<th data-quarto-table-cell-role="th">min_distance</th>
<th data-quarto-table-cell-role="th">max_distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>AML</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>74.382151</td>
<td>66.806253</td>
<td>6.056625</td>
<td>199.988548</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>AML</td>
<td>endothelial cell of artery</td>
<td>Level Three Cell Type</td>
<td>111.758598</td>
<td>112.688440</td>
<td>8.275107</td>
<td>199.997878</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>AML</td>
<td>endothelial cell of artery</td>
<td>Level Two Cell Type</td>
<td>111.758598</td>
<td>112.688440</td>
<td>8.275107</td>
<td>199.997878</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>AML</td>
<td>endothelial cell of sinusoid</td>
<td>Level Three Cell Type</td>
<td>79.390329</td>
<td>72.177834</td>
<td>6.056625</td>
<td>199.988548</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>AML</td>
<td>endothelial cell of sinusoid</td>
<td>Level Two Cell Type</td>
<td>79.390329</td>
<td>72.177834</td>
<td>6.056625</td>
<td>199.988548</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>NBM</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>90.322695</td>
<td>85.240398</td>
<td>5.750231</td>
<td>199.999142</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>NBM</td>
<td>endothelial cell of artery</td>
<td>Level Three Cell Type</td>
<td>115.284424</td>
<td>119.163665</td>
<td>5.750231</td>
<td>199.999998</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>NBM</td>
<td>endothelial cell of artery</td>
<td>Level Two Cell Type</td>
<td>115.284424</td>
<td>119.163665</td>
<td>5.750231</td>
<td>199.999998</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>NBM</td>
<td>endothelial cell of sinusoid</td>
<td>Level Three Cell Type</td>
<td>95.298876</td>
<td>91.351118</td>
<td>7.165130</td>
<td>199.999142</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>NBM</td>
<td>endothelial cell of sinusoid</td>
<td>Level Two Cell Type</td>
<td>95.298876</td>
<td>91.351118</td>
<td>7.165130</td>
<td>199.999142</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>NSM</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>93.842789</td>
<td>87.951406</td>
<td>7.675593</td>
<td>199.997910</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>NSM</td>
<td>endothelial cell of artery</td>
<td>Level Three Cell Type</td>
<td>117.211880</td>
<td>121.868198</td>
<td>8.340683</td>
<td>199.999051</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>NSM</td>
<td>endothelial cell of artery</td>
<td>Level Two Cell Type</td>
<td>117.211880</td>
<td>121.868198</td>
<td>8.340683</td>
<td>199.999051</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>NSM</td>
<td>endothelial cell of sinusoid</td>
<td>Level Three Cell Type</td>
<td>95.636834</td>
<td>90.176577</td>
<td>7.675593</td>
<td>199.997910</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>NSM</td>
<td>endothelial cell of sinusoid</td>
<td>Level Two Cell Type</td>
<td>95.636834</td>
<td>90.176577</td>
<td>7.675593</td>
<td>199.997910</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="level-one-cell-type-analysis" class="level3">
<h3 class="anchored" data-anchor-id="level-one-cell-type-analysis">Level One Cell Type Analysis</h3>
<div id="d4913a21" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get mean, median, minimum, maximum distance per cell type in all unique regions.</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>cell_type_level <span class="op">=</span> <span class="st">'Level One Cell Type'</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_type_level <span class="op">=</span> df_all_edges_with_cell_types[(df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type Level'</span>] <span class="op">==</span> cell_type_level) <span class="op">&amp;</span> (df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type'</span>] <span class="op">==</span> anchor_cell_type_dict[cell_type_level])]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level <span class="op">=</span> df_all_edges_with_cell_type_level.groupby([cell_type_level, <span class="st">'Unique Region'</span>]).agg(</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>),</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    min_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'min'</span>),</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    max_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'max'</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">mean_distance</th>
<th data-quarto-table-cell-role="th">median_distance</th>
<th data-quarto-table-cell-role="th">min_distance</th>
<th data-quarto-table-cell-role="th">max_distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>hematopoietic precursor cell</td>
<td>AML</td>
<td>75.807458</td>
<td>68.350787</td>
<td>6.056625</td>
<td>199.982016</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>hematopoietic precursor cell</td>
<td>NBM</td>
<td>91.437465</td>
<td>86.347062</td>
<td>7.368943</td>
<td>199.999142</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>hematopoietic precursor cell</td>
<td>NSM</td>
<td>95.233485</td>
<td>89.641506</td>
<td>8.036234</td>
<td>199.985663</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>immune cell</td>
<td>AML</td>
<td>72.244373</td>
<td>64.713204</td>
<td>8.247845</td>
<td>199.988548</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>immune cell</td>
<td>NBM</td>
<td>89.656605</td>
<td>84.596595</td>
<td>5.750231</td>
<td>199.998770</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>immune cell</td>
<td>NSM</td>
<td>93.334766</td>
<td>87.175896</td>
<td>7.675593</td>
<td>199.997383</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>mesenchymal cell</td>
<td>AML</td>
<td>68.072424</td>
<td>59.045392</td>
<td>8.275107</td>
<td>198.703670</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>mesenchymal cell</td>
<td>NBM</td>
<td>82.079626</td>
<td>75.429180</td>
<td>7.596170</td>
<td>199.992343</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>mesenchymal cell</td>
<td>NSM</td>
<td>79.140648</td>
<td>69.671854</td>
<td>8.344688</td>
<td>199.997910</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>neural cell</td>
<td>AML</td>
<td>79.843632</td>
<td>79.843632</td>
<td>61.290397</td>
<td>98.396868</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>neural cell</td>
<td>NBM</td>
<td>57.869702</td>
<td>49.944344</td>
<td>9.815320</td>
<td>187.956746</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>unknown cell</td>
<td>NBM</td>
<td>91.914579</td>
<td>87.038869</td>
<td>6.586107</td>
<td>199.984000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="f39a0f19" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top five and bottom five cell types with respect to mean distance in each unique region separately.</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_top_bottom_cell_types_by_mean(df, cell_type_level, unique_region, top_n<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the DataFrame for the specified unique region and cell type level</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    df_filtered <span class="op">=</span> df[df[<span class="st">'Unique Region'</span>] <span class="op">==</span> unique_region]</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by the specified cell type level and calculate mean distance</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    df_grouped <span class="op">=</span> df_filtered.groupby(cell_type_level).agg(mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>)).reset_index()</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by mean distance to get top and bottom cell types</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    df_sorted <span class="op">=</span> df_grouped.sort_values(by<span class="op">=</span><span class="st">'mean_distance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get top N and bottom N cell types</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    top_cell_types <span class="op">=</span> df_sorted.head(top_n)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    bottom_cell_types <span class="op">=</span> df_sorted.tail(top_n)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> top_cell_types, bottom_cell_types</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_mean(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in NSM:
            Level One Cell Type  mean_distance
0  hematopoietic precursor cell      95.233485
1                   immune cell      93.334766
2              mesenchymal cell      79.140648

Bottom 5 cell types in NSM:
            Level One Cell Type  mean_distance
0  hematopoietic precursor cell      95.233485
1                   immune cell      93.334766
2              mesenchymal cell      79.140648

Top 5 cell types in AML:
            Level One Cell Type  mean_distance
3                   neural cell      79.843632
0  hematopoietic precursor cell      75.807458
1                   immune cell      72.244373
2              mesenchymal cell      68.072424

Bottom 5 cell types in AML:
            Level One Cell Type  mean_distance
3                   neural cell      79.843632
0  hematopoietic precursor cell      75.807458
1                   immune cell      72.244373
2              mesenchymal cell      68.072424

Top 5 cell types in NBM:
            Level One Cell Type  mean_distance
4                  unknown cell      91.914579
0  hematopoietic precursor cell      91.437465
1                   immune cell      89.656605
2              mesenchymal cell      82.079626
3                   neural cell      57.869702

Bottom 5 cell types in NBM:
            Level One Cell Type  mean_distance
4                  unknown cell      91.914579
0  hematopoietic precursor cell      91.437465
1                   immune cell      89.656605
2              mesenchymal cell      82.079626
3                   neural cell      57.869702</code></pre>
</div>
</div>
<div id="4b84ac88" class="cell" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top five and bottom five cell types with respect to median distance in each unique region separately.</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_top_bottom_cell_types_by_median(df, cell_type_level, unique_region, top_n<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the DataFrame for the specified unique region and cell type level</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    df_filtered <span class="op">=</span> df[df[<span class="st">'Unique Region'</span>] <span class="op">==</span> unique_region]</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by the specified cell type level and calculate median distance</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    df_grouped <span class="op">=</span> df_filtered.groupby(cell_type_level).agg(median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>)).reset_index()</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by median distance to get top and bottom cell types</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    df_sorted <span class="op">=</span> df_grouped.sort_values(by<span class="op">=</span><span class="st">'median_distance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get top N and bottom N cell types</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    top_cell_types <span class="op">=</span> df_sorted.head(top_n)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    bottom_cell_types <span class="op">=</span> df_sorted.tail(top_n)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> top_cell_types, bottom_cell_types</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_median(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in NSM:
            Level One Cell Type  median_distance
0  hematopoietic precursor cell        89.641506
1                   immune cell        87.175896
2              mesenchymal cell        69.671854

Bottom 5 cell types in NSM:
            Level One Cell Type  median_distance
0  hematopoietic precursor cell        89.641506
1                   immune cell        87.175896
2              mesenchymal cell        69.671854

Top 5 cell types in AML:
            Level One Cell Type  median_distance
3                   neural cell        79.843632
0  hematopoietic precursor cell        68.350787
1                   immune cell        64.713204
2              mesenchymal cell        59.045392

Bottom 5 cell types in AML:
            Level One Cell Type  median_distance
3                   neural cell        79.843632
0  hematopoietic precursor cell        68.350787
1                   immune cell        64.713204
2              mesenchymal cell        59.045392

Top 5 cell types in NBM:
            Level One Cell Type  median_distance
4                  unknown cell        87.038869
0  hematopoietic precursor cell        86.347062
1                   immune cell        84.596595
2              mesenchymal cell        75.429180
3                   neural cell        49.944344

Bottom 5 cell types in NBM:
            Level One Cell Type  median_distance
4                  unknown cell        87.038869
0  hematopoietic precursor cell        86.347062
1                   immune cell        84.596595
2              mesenchymal cell        75.429180
3                   neural cell        49.944344</code></pre>
</div>
</div>
<div id="b8dfbe69" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate regional variability</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_regional_variability(df_all_edges_with_cell_type_level, cell_type_level):</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""    Calculate regional variability for distances in the given DataFrame.</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    regional_variability <span class="op">=</span> df_all_edges_with_cell_type_level.groupby(<span class="st">'Unique Region'</span>)[<span class="st">'Distance'</span>].agg([</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'mean'</span>, <span class="st">'mean'</span>),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'std'</span>, <span class="st">'std'</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    ]).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add CV as percentage</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    regional_variability[<span class="st">'CV (%)'</span>] <span class="op">=</span> (regional_variability[<span class="st">'std'</span>] <span class="op">/</span> regional_variability[<span class="st">'mean'</span>] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Regional Variability Analysis:"</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Mean: Average distance in each region"</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Std: Standard deviation of distances"</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"CV: Coefficient of Variation (std/mean * 100%)"</span>)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(regional_variability)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate variability for each cell type</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    cell_type_variability <span class="op">=</span> df_all_edges_with_cell_type_level.groupby(cell_type_level)[<span class="st">'Distance'</span>].agg([</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'mean'</span>, <span class="st">'mean'</span>),</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'std'</span>, <span class="st">'std'</span>)</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    ]).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add CV as percentage</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>    cell_type_variability[<span class="st">'CV (%)'</span>] <span class="op">=</span> (cell_type_variability[<span class="st">'std'</span>] <span class="op">/</span> cell_type_variability[<span class="st">'mean'</span>] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Cell Type Variability Analysis (sorted by CV):"</span>)</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(cell_type_variability.sort_values(<span class="st">'CV (%)'</span>, ascending<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>calculate_regional_variability(df_all_edges_with_cell_type_level, cell_type_level)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regional Variability Analysis:
Mean: Average distance in each region
Std: Standard deviation of distances
CV: Coefficient of Variation (std/mean * 100%)
                mean    std  CV (%)
Unique Region                      
AML            74.38  42.82    57.6
NBM            90.32  48.07    53.2
NSM            93.84  50.99    54.3

Cell Type Variability Analysis (sorted by CV):
                               mean    std  CV (%)
Level One Cell Type                               
neural cell                   58.71  38.97    66.4
mesenchymal cell              79.84  49.34    61.8
immune cell                   88.12  48.41    54.9
hematopoietic precursor cell  88.63  47.43    53.5
unknown cell                  91.91  48.28    52.5</code></pre>
</div>
</div>
<div id="1a837cc8" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the standard region sequence for plots</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>regions <span class="op">=</span> [<span class="st">'NBM'</span>, <span class="st">'AML'</span>, <span class="st">'NSM'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="5f38c4c8" class="cell" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate Violin Plot</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_violin_cells_per_celltype(df_all_edges_with_cell_type_level, cell_type_level, output_dir, density_norm<span class="op">=</span><span class="st">'area'</span>):</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    sns.set_context(<span class="st">"notebook"</span>, rc<span class="op">=</span>{<span class="st">"grid.linewidth"</span>: <span class="dv">2</span>})</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    sns.violinplot(data<span class="op">=</span>df_all_edges_with_cell_type_level, x<span class="op">=</span>cell_type_level, y<span class="op">=</span><span class="st">"Distance"</span>, density_norm<span class="op">=</span>density_norm, common_norm<span class="op">=</span><span class="va">True</span>, cut<span class="op">=</span><span class="dv">0</span>, inner<span class="op">=</span><span class="st">"box"</span>, split<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span><span class="st">'Spectral'</span>, alpha<span class="op">=</span><span class="fl">.9</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    sns.set_theme(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    sns.set_context(<span class="st">"paper"</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    font_size <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    plt.legend(fontsize<span class="op">=</span>font_size)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Violin Plot of distances by </span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss"> (Density Normalization: </span><span class="sc">{</span>density_norm<span class="sc">}</span><span class="ss">)'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="ss">f'</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Distance (</span><span class="ch">\u03bc</span><span class="st">m)'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Increase font size for all text in the figure</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span>font_size)</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span>font_size)</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_violin_cells_per_celltype_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>                bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>                pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_violin_cells_per_celltype_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>                bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>                pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>plot_violin_cells_per_celltype(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">'area'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_distance_analysis__bonemarrow-codex-chop_files/figure-html/cell-31-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="108159d1" class="cell" data-execution_count="31">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplots of distribution of distances by cell type and region.</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_distance_distribution_boxplots_by_region(df_all_edges_with_cell_type_level, cell_type_level, output_dir):</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">8</span>))</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create categorical type with only the regions that exist in the data</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    available_regions <span class="op">=</span> [r <span class="cf">for</span> r <span class="kw">in</span> regions <span class="cf">if</span> r <span class="kw">in</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()]</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>] <span class="op">=</span> pd.Categorical(</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>        df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>],</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>        categories<span class="op">=</span>available_regions,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        ordered<span class="op">=</span><span class="va">True</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make box plot.</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(data<span class="op">=</span>df_all_edges_with_cell_type_level, x<span class="op">=</span>cell_type_level, y<span class="op">=</span><span class="st">'Distance'</span>, hue<span class="op">=</span><span class="st">'Unique Region'</span>, showfliers<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span><span class="st">'Spectral'</span>) <span class="co"># viridis or Spectral palette for better color distinction</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    font_size <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>, ha<span class="op">=</span><span class="st">'right'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span>font_size)</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Distribution of distances by </span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss"> and region'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="ss">f'</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Distance (</span><span class="ch">\u03bc</span><span class="st">m)'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_distance_distribution_boxplots_by_region_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_distance_distribution_boxplots_by_region_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_boxplots_by_region(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_distance_analysis__bonemarrow-codex-chop_files/figure-html/cell-32-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="3b13e3a2" class="cell" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplots of distribution of distances by cell type and region.</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_distance_distribution_heatmap(df_all_edges_with_cell_type_level, cell_type_level, output_dir):</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    pivot_data <span class="op">=</span> df_all_edges_with_cell_type_level.pivot_table(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">'Distance'</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>cell_type_level,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">'Unique Region'</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    aggfunc<span class="op">=</span><span class="st">'median'</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(pivot_data, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.1f'</span>, cmap<span class="op">=</span><span class="st">'Spectral'</span>)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Heatmap of median distances by </span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    font_size <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>, ha<span class="op">=</span><span class="st">'right'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span>font_size)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Unique Region'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="ss">f'</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_distance_distribution_heatmap_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_distance_distribution_heatmap_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_heatmap(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_distance_analysis__bonemarrow-codex-chop_files/figure-html/cell-33-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="242b6c5d" class="cell" data-execution_count="33">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate Violin Plot per unique region in both small intestine and large intestine. Create for all 8 regions as 8 subplots.</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_violin_plots_all_regions(df_all_edges_with_cell_type_level, cell_type_level, output_dir, density_norm<span class="op">=</span><span class="st">"area"</span>):</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    sns.set_context(<span class="st">"notebook"</span>, rc<span class="op">=</span>{<span class="st">"grid.linewidth"</span>: <span class="dv">1</span>})</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    font_size <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    fig, axs <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">15</span>)) <span class="co"># Adjusted figsize for horizontal layout</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(<span class="ss">f'Distance distribution per </span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss"> in `</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">` (density normalization = </span><span class="sc">{</span>density_norm<span class="sc">}</span><span class="ss">)'</span>, fontsize<span class="op">=</span>font_size, y<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep the sequence of Cell Types consistent across plots.</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    cell_types <span class="op">=</span> <span class="bu">sorted</span>(df_all_edges_with_cell_type_level[cell_type_level].unique())</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a color palette based on the number of unique classes</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    color_palette <span class="op">=</span> sns.color_palette(<span class="st">"Spectral"</span>, n_colors<span class="op">=</span><span class="bu">len</span>(cell_types))</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a dictionary mapping class to color</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    class_color_dict <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(cell_types, color_palette))</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, region <span class="kw">in</span> <span class="bu">enumerate</span>(regions):</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>        data_reg <span class="op">=</span> df_all_edges_with_cell_type_level[df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>] <span class="op">==</span> region]</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>        sns.violinplot(data<span class="op">=</span>data_reg, x<span class="op">=</span>cell_type_level, y<span class="op">=</span><span class="st">"Distance"</span>, density_norm<span class="op">=</span>density_norm, common_norm<span class="op">=</span><span class="va">True</span>, cut<span class="op">=</span><span class="dv">0</span>, inner<span class="op">=</span><span class="st">"box"</span>, split<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span>class_color_dict, alpha<span class="op">=</span><span class="fl">.9</span>, ax<span class="op">=</span>axs[i], hue<span class="op">=</span>cell_type_level, legend<span class="op">=</span><span class="va">False</span>, order<span class="op">=</span>cell_types, fill<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>        axs[i].set_title(region, fontsize<span class="op">=</span>font_size)</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>        axs[i].set_xlabel(<span class="st">''</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>        axs[i].set_ylabel(<span class="st">'Distance (</span><span class="ch">\u03bc</span><span class="st">m)'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axs[i].tick_params(axis='x', labelrotation=90, labelsize=font_size)</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># only show xtick labels for the last subplot</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(regions) <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>            axs[i].set_xticklabels([])</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>            axs[i].set_xticklabels(cell_types, fontsize<span class="op">=</span>font_size, rotation<span class="op">=</span><span class="dv">90</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axs[i].set_ylim(0, data_reg['Distance'].max() * 1.1)  # Set y-limits to be consistent across all plots</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>        axs[i].tick_params(axis<span class="op">=</span><span class="st">'both'</span>, labelsize<span class="op">=</span>font_size)</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use fig.text for precise label positioning</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>    fig.figure.text(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.02</span>, <span class="ss">f'</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_violin_plots_all_regions_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_violin_plots_all_regions_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>plot_violin_plots_all_regions(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">"count"</span>) <span class="co"># density_norm="count" or "area" can be used based on preference.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_distance_analysis__bonemarrow-codex-chop_files/figure-html/cell-34-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="level-two-cell-type-analysis" class="level3">
<h3 class="anchored" data-anchor-id="level-two-cell-type-analysis">Level Two Cell Type Analysis</h3>
<div id="870d1e61" class="cell" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get mean, median, minimum, maximum distance per cell type in all unique regions.</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>cell_type_level <span class="op">=</span> <span class="st">'Level Two Cell Type'</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_type_level <span class="op">=</span> df_all_edges_with_cell_types[(df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type Level'</span>] <span class="op">==</span> cell_type_level) <span class="op">&amp;</span> (df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type'</span>] <span class="op">==</span> anchor_cell_type_dict[cell_type_level])]</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level <span class="op">=</span> df_all_edges_with_cell_type_level.groupby([cell_type_level, <span class="st">'Unique Region'</span>]).agg(</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>),</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>),</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    min_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'min'</span>),</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    max_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'max'</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">mean_distance</th>
<th data-quarto-table-cell-role="th">median_distance</th>
<th data-quarto-table-cell-role="th">min_distance</th>
<th data-quarto-table-cell-role="th">max_distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>abnormal cell</td>
<td>AML</td>
<td>84.612826</td>
<td>78.755366</td>
<td>7.350124</td>
<td>199.982016</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>adipocyte</td>
<td>AML</td>
<td>72.044065</td>
<td>61.569803</td>
<td>9.299294</td>
<td>198.520789</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>adipocyte</td>
<td>NBM</td>
<td>92.656243</td>
<td>88.435461</td>
<td>8.040248</td>
<td>199.992343</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>adipocyte</td>
<td>NSM</td>
<td>84.007363</td>
<td>76.639037</td>
<td>8.344688</td>
<td>199.997910</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>b cell</td>
<td>AML</td>
<td>78.392682</td>
<td>71.243188</td>
<td>9.244128</td>
<td>199.966621</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>b cell</td>
<td>NBM</td>
<td>97.615652</td>
<td>95.012793</td>
<td>8.025751</td>
<td>199.996640</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>b cell</td>
<td>NSM</td>
<td>96.232882</td>
<td>91.578635</td>
<td>9.240345</td>
<td>199.991504</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>dendritic cell</td>
<td>AML</td>
<td>79.071847</td>
<td>72.219946</td>
<td>9.452268</td>
<td>199.541677</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>dendritic cell</td>
<td>NBM</td>
<td>94.921339</td>
<td>90.375897</td>
<td>8.032959</td>
<td>199.978479</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>dendritic cell</td>
<td>NSM</td>
<td>96.121120</td>
<td>90.482325</td>
<td>10.456776</td>
<td>199.356229</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>endothelial cell of artery</td>
<td>AML</td>
<td>66.552461</td>
<td>57.188080</td>
<td>9.598652</td>
<td>197.775548</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>endothelial cell of artery</td>
<td>NBM</td>
<td>80.875474</td>
<td>71.598061</td>
<td>7.165130</td>
<td>199.696671</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>endothelial cell of artery</td>
<td>NSM</td>
<td>65.333875</td>
<td>55.348929</td>
<td>8.340683</td>
<td>199.496217</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>erythroid precursor</td>
<td>AML</td>
<td>75.974098</td>
<td>67.872764</td>
<td>7.687746</td>
<td>199.911019</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>erythroid precursor</td>
<td>NBM</td>
<td>95.055450</td>
<td>90.578380</td>
<td>7.368943</td>
<td>199.990928</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>erythroid precursor</td>
<td>NSM</td>
<td>97.332711</td>
<td>92.296305</td>
<td>8.124669</td>
<td>199.985663</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>hematopoietic stem and progenitor cell</td>
<td>AML</td>
<td>54.563528</td>
<td>37.139774</td>
<td>9.123395</td>
<td>189.847535</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>hematopoietic stem and progenitor cell</td>
<td>NBM</td>
<td>95.280715</td>
<td>93.347852</td>
<td>9.670863</td>
<td>199.738928</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>hematopoietic stem and progenitor cell</td>
<td>NSM</td>
<td>104.959083</td>
<td>98.965058</td>
<td>13.524865</td>
<td>196.588555</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>macrophage</td>
<td>AML</td>
<td>73.826747</td>
<td>67.164529</td>
<td>9.347675</td>
<td>198.307993</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>macrophage</td>
<td>NBM</td>
<td>96.799495</td>
<td>91.931956</td>
<td>8.152219</td>
<td>199.997797</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>macrophage</td>
<td>NSM</td>
<td>90.324484</td>
<td>82.094705</td>
<td>9.073456</td>
<td>199.512374</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>megakaryocyte</td>
<td>AML</td>
<td>77.991861</td>
<td>68.126728</td>
<td>9.953335</td>
<td>199.430617</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>megakaryocyte</td>
<td>NBM</td>
<td>98.795997</td>
<td>94.345559</td>
<td>8.774989</td>
<td>199.937106</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">24</th>
<td>megakaryocyte</td>
<td>NSM</td>
<td>98.796581</td>
<td>92.705512</td>
<td>12.087462</td>
<td>199.884221</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">25</th>
<td>mesenchymal stem cell</td>
<td>AML</td>
<td>78.724108</td>
<td>71.696786</td>
<td>8.585049</td>
<td>198.703670</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">26</th>
<td>mesenchymal stem cell</td>
<td>NBM</td>
<td>91.666993</td>
<td>87.259370</td>
<td>9.507509</td>
<td>199.986823</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">27</th>
<td>mesenchymal stem cell</td>
<td>NSM</td>
<td>87.206186</td>
<td>83.498779</td>
<td>9.652741</td>
<td>199.570947</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">28</th>
<td>mesenchymal stem/stromal cell</td>
<td>AML</td>
<td>75.223250</td>
<td>65.025012</td>
<td>10.898685</td>
<td>199.967713</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">29</th>
<td>mesenchymal stem/stromal cell</td>
<td>NBM</td>
<td>91.820716</td>
<td>86.924087</td>
<td>7.572935</td>
<td>199.852192</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">30</th>
<td>mesenchymal stem/stromal cell</td>
<td>NSM</td>
<td>91.464706</td>
<td>80.083330</td>
<td>10.301344</td>
<td>199.472893</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">31</th>
<td>monocyte</td>
<td>AML</td>
<td>82.273906</td>
<td>76.137286</td>
<td>8.868460</td>
<td>199.876784</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">32</th>
<td>monocyte</td>
<td>NBM</td>
<td>91.519407</td>
<td>86.756461</td>
<td>7.351953</td>
<td>199.985575</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">33</th>
<td>monocyte</td>
<td>NSM</td>
<td>92.240440</td>
<td>85.765454</td>
<td>8.268363</td>
<td>199.934336</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">34</th>
<td>muscle cell</td>
<td>AML</td>
<td>69.735721</td>
<td>59.183423</td>
<td>10.271701</td>
<td>194.082988</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">35</th>
<td>muscle cell</td>
<td>NBM</td>
<td>94.216885</td>
<td>87.575318</td>
<td>9.427550</td>
<td>199.834792</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">36</th>
<td>muscle cell</td>
<td>NSM</td>
<td>55.313443</td>
<td>46.465657</td>
<td>10.248018</td>
<td>198.935026</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">37</th>
<td>myeloid cell</td>
<td>AML</td>
<td>76.635516</td>
<td>68.660555</td>
<td>8.373370</td>
<td>199.748940</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">38</th>
<td>myeloid cell</td>
<td>NBM</td>
<td>93.908272</td>
<td>89.618397</td>
<td>7.514845</td>
<td>199.998770</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">39</th>
<td>myeloid cell</td>
<td>NSM</td>
<td>95.283475</td>
<td>89.390289</td>
<td>7.675593</td>
<td>199.984961</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">40</th>
<td>myeloid precursor</td>
<td>AML</td>
<td>80.963771</td>
<td>73.387438</td>
<td>8.604672</td>
<td>199.919874</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">41</th>
<td>myeloid precursor</td>
<td>NBM</td>
<td>96.919348</td>
<td>93.418496</td>
<td>7.505009</td>
<td>199.999142</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">42</th>
<td>myeloid precursor</td>
<td>NSM</td>
<td>97.037575</td>
<td>92.060765</td>
<td>8.173025</td>
<td>199.969054</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">43</th>
<td>neuroglial cell</td>
<td>AML</td>
<td>128.321993</td>
<td>128.321993</td>
<td>128.321993</td>
<td>128.321993</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">44</th>
<td>neuroglial cell</td>
<td>NBM</td>
<td>86.411262</td>
<td>78.933059</td>
<td>17.934662</td>
<td>175.871271</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">45</th>
<td>progenitor cell</td>
<td>AML</td>
<td>78.395834</td>
<td>70.509229</td>
<td>6.056625</td>
<td>199.797032</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">46</th>
<td>progenitor cell</td>
<td>NBM</td>
<td>98.953368</td>
<td>96.413601</td>
<td>8.000469</td>
<td>199.988637</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">47</th>
<td>progenitor cell</td>
<td>NSM</td>
<td>97.117247</td>
<td>92.464861</td>
<td>9.423956</td>
<td>199.969595</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">48</th>
<td>skeletal stromal cell</td>
<td>AML</td>
<td>78.238144</td>
<td>65.728809</td>
<td>13.246899</td>
<td>195.060591</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">49</th>
<td>skeletal stromal cell</td>
<td>NBM</td>
<td>94.062042</td>
<td>88.538574</td>
<td>8.954561</td>
<td>199.829571</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">50</th>
<td>skeletal stromal cell</td>
<td>NSM</td>
<td>89.169229</td>
<td>77.967966</td>
<td>11.309889</td>
<td>198.710354</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">51</th>
<td>stem cell</td>
<td>AML</td>
<td>70.097786</td>
<td>59.523007</td>
<td>10.801688</td>
<td>193.191236</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">52</th>
<td>stem cell</td>
<td>NBM</td>
<td>96.060575</td>
<td>92.318654</td>
<td>9.741716</td>
<td>199.970348</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">53</th>
<td>stem cell</td>
<td>NSM</td>
<td>92.740997</td>
<td>90.714633</td>
<td>8.036234</td>
<td>199.237795</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">54</th>
<td>t cell</td>
<td>AML</td>
<td>80.957774</td>
<td>73.440678</td>
<td>8.247845</td>
<td>199.988548</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">55</th>
<td>t cell</td>
<td>NBM</td>
<td>94.412441</td>
<td>90.318472</td>
<td>8.190426</td>
<td>199.995542</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">56</th>
<td>t cell</td>
<td>NSM</td>
<td>94.730211</td>
<td>88.963905</td>
<td>9.018322</td>
<td>199.997383</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">57</th>
<td>unknown cell</td>
<td>NBM</td>
<td>96.310960</td>
<td>92.693095</td>
<td>8.043118</td>
<td>199.984452</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="5ac5fb33" class="cell" data-execution_count="35">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_mean(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in NSM:
                       Level Two Cell Type  mean_distance
5   hematopoietic stem and progenitor cell     104.959083
7                            megakaryocyte      98.796581
4                     erythroid precursor       97.332711
14                         progenitor cell      97.117247
13                       myeloid precursor      97.037575

Bottom 5 cell types in NSM:
           Level Two Cell Type  mean_distance
15       skeletal stromal cell      89.169229
8        mesenchymal stem cell      87.206186
0                    adipocyte      84.007363
3   endothelial cell of artery      65.333875
11                 muscle cell      55.313443

Top 5 cell types in AML:
   Level Two Cell Type  mean_distance
15     neuroglial cell     128.321993
0        abnormal cell      84.612826
11            monocyte      82.273906
14   myeloid precursor      80.963771
19              t cell      80.957774

Bottom 5 cell types in AML:
                       Level Two Cell Type  mean_distance
1                                adipocyte      72.044065
18                               stem cell      70.097786
12                             muscle cell      69.735721
4               endothelial cell of artery      66.552461
6   hematopoietic stem and progenitor cell      54.563528

Top 5 cell types in NBM:
   Level Two Cell Type  mean_distance
15     progenitor cell      98.953368
7        megakaryocyte      98.795997
1               b cell      97.615652
13   myeloid precursor      96.919348
6           macrophage      96.799495

Bottom 5 cell types in NBM:
              Level Two Cell Type  mean_distance
9   mesenchymal stem/stromal cell      91.820716
8           mesenchymal stem cell      91.666993
10                       monocyte      91.519407
14                neuroglial cell      86.411262
3      endothelial cell of artery      80.875474</code></pre>
</div>
</div>
<div id="2241c2ed" class="cell" data-execution_count="36">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_median(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in NSM:
                       Level Two Cell Type  median_distance
5   hematopoietic stem and progenitor cell        98.965058
7                            megakaryocyte        92.705512
14                         progenitor cell        92.464861
4                     erythroid precursor         92.296305
13                       myeloid precursor        92.060765

Bottom 5 cell types in NSM:
              Level Two Cell Type  median_distance
9   mesenchymal stem/stromal cell        80.083330
15          skeletal stromal cell        77.967966
0                       adipocyte        76.639037
3      endothelial cell of artery        55.348929
11                    muscle cell        46.465657

Top 5 cell types in AML:
   Level Two Cell Type  median_distance
15     neuroglial cell       128.321993
0        abnormal cell        78.755366
11            monocyte        76.137286
19              t cell        73.440678
14   myeloid precursor        73.387438

Bottom 5 cell types in AML:
                       Level Two Cell Type  median_distance
1                                adipocyte        61.569803
18                               stem cell        59.523007
12                             muscle cell        59.183423
4               endothelial cell of artery        57.188080
6   hematopoietic stem and progenitor cell        37.139774

Top 5 cell types in NBM:
                       Level Two Cell Type  median_distance
15                         progenitor cell        96.413601
1                                   b cell        95.012793
7                            megakaryocyte        94.345559
13                       myeloid precursor        93.418496
5   hematopoietic stem and progenitor cell        93.347852

Bottom 5 cell types in NBM:
              Level Two Cell Type  median_distance
8           mesenchymal stem cell        87.259370
9   mesenchymal stem/stromal cell        86.924087
10                       monocyte        86.756461
14                neuroglial cell        78.933059
3      endothelial cell of artery        71.598061</code></pre>
</div>
</div>
<div id="ca585eed" class="cell" data-execution_count="37">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>calculate_regional_variability(df_all_edges_with_cell_type_level, cell_type_level)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regional Variability Analysis:
Mean: Average distance in each region
Std: Standard deviation of distances
CV: Coefficient of Variation (std/mean * 100%)
                mean    std  CV (%)
Unique Region                      
AML            79.39  44.80    56.4
NBM            95.30  48.83    51.2
NSM            95.64  51.03    53.4

Cell Type Variability Analysis (sorted by CV):
                                         mean    std  CV (%)
Level Two Cell Type                                         
endothelial cell of artery              77.69  52.16    67.1
muscle cell                             87.24  50.87    58.3
skeletal stromal cell                   92.68  52.72    56.9
adipocyte                               89.36  50.19    56.2
monocyte                                89.60  49.68    55.4
mesenchymal stem cell                   87.59  48.55    55.4
mesenchymal stem/stromal cell           89.52  48.91    54.6
dendritic cell                          89.61  48.91    54.6
t cell                                  92.82  49.73    53.6
hematopoietic stem and progenitor cell  93.87  49.72    53.0
myeloid cell                            93.01  49.27    53.0
abnormal cell                           84.61  44.08    52.1
erythroid precursor                     92.48  48.09    52.0
myeloid precursor                       94.87  49.06    51.7
stem cell                               94.15  48.57    51.6
macrophage                              92.25  47.60    51.6
b cell                                  94.91  48.86    51.5
progenitor cell                         95.58  49.02    51.3
unknown cell                            96.31  48.92    50.8
neuroglial cell                         87.43  43.59    49.9
megakaryocyte                           94.69  47.09    49.7</code></pre>
</div>
</div>
<div id="71442535" class="cell" data-execution_count="38">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>plot_violin_cells_per_celltype(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">'area'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_distance_analysis__bonemarrow-codex-chop_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="79d534bf" class="cell" data-execution_count="39">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_boxplots_by_region(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_distance_analysis__bonemarrow-codex-chop_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="53c2434e" class="cell" data-execution_count="40">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_heatmap(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_distance_analysis__bonemarrow-codex-chop_files/figure-html/cell-41-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="870648d2" class="cell" data-execution_count="41">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>plot_violin_plots_all_regions(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">"count"</span>) <span class="co"># Or, density_norm="count" or "area" based on preference.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_distance_analysis__bonemarrow-codex-chop_files/figure-html/cell-42-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="level-three-cell-type-analysis" class="level3">
<h3 class="anchored" data-anchor-id="level-three-cell-type-analysis">Level Three Cell Type Analysis</h3>
<div id="5294f163" class="cell" data-execution_count="42">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get mean, median, minimum, maximum distance per cell type in all unique regions.</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>cell_type_level <span class="op">=</span> <span class="st">'Level Three Cell Type'</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_type_level <span class="op">=</span> df_all_edges_with_cell_types[(df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type Level'</span>] <span class="op">==</span> cell_type_level) <span class="op">&amp;</span> (df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type'</span>] <span class="op">==</span> anchor_cell_type_dict[cell_type_level])]</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level <span class="op">=</span> df_all_edges_with_cell_type_level.groupby([cell_type_level, <span class="st">'Unique Region'</span>]).agg(</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>),</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>),</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    min_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'min'</span>),</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    max_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'max'</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">mean_distance</th>
<th data-quarto-table-cell-role="th">median_distance</th>
<th data-quarto-table-cell-role="th">min_distance</th>
<th data-quarto-table-cell-role="th">max_distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>adipocyte</td>
<td>AML</td>
<td>72.044065</td>
<td>61.569803</td>
<td>9.299294</td>
<td>198.520789</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>adipocyte</td>
<td>NBM</td>
<td>92.656243</td>
<td>88.435461</td>
<td>8.040248</td>
<td>199.992343</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>adipocyte</td>
<td>NSM</td>
<td>84.007363</td>
<td>76.639037</td>
<td>8.344688</td>
<td>199.997910</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>b cell</td>
<td>AML</td>
<td>76.143453</td>
<td>68.752778</td>
<td>9.244128</td>
<td>199.966621</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>b cell</td>
<td>NBM</td>
<td>96.138631</td>
<td>92.508923</td>
<td>8.025751</td>
<td>199.972480</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>b cell</td>
<td>NSM</td>
<td>94.707460</td>
<td>89.148689</td>
<td>9.240345</td>
<td>199.991504</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>b cell:immature</td>
<td>AML</td>
<td>82.461384</td>
<td>75.703532</td>
<td>10.072227</td>
<td>199.483659</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>b cell:immature</td>
<td>NBM</td>
<td>99.501175</td>
<td>96.731118</td>
<td>8.874948</td>
<td>199.954603</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>b cell:immature</td>
<td>NSM</td>
<td>97.478212</td>
<td>92.747527</td>
<td>9.555029</td>
<td>199.569086</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>cell:cd34+ cd61+</td>
<td>AML</td>
<td>74.287460</td>
<td>57.285741</td>
<td>11.620897</td>
<td>170.297284</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>cell:cd34+ cd61+</td>
<td>NBM</td>
<td>97.082979</td>
<td>99.005114</td>
<td>9.337088</td>
<td>198.401642</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>cell:cd34+ cd61+</td>
<td>NSM</td>
<td>54.635086</td>
<td>52.248486</td>
<td>48.701567</td>
<td>67.252810</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>dendritic cell:plasmacytoid</td>
<td>AML</td>
<td>79.071847</td>
<td>72.219946</td>
<td>9.452268</td>
<td>199.541677</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>dendritic cell:plasmacytoid</td>
<td>NBM</td>
<td>94.921339</td>
<td>90.375897</td>
<td>8.032959</td>
<td>199.978479</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>dendritic cell:plasmacytoid</td>
<td>NSM</td>
<td>96.121120</td>
<td>90.482325</td>
<td>10.456776</td>
<td>199.356229</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>endosteal cell</td>
<td>AML</td>
<td>78.238144</td>
<td>65.728809</td>
<td>13.246899</td>
<td>195.060591</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>endosteal cell</td>
<td>NBM</td>
<td>94.062042</td>
<td>88.538574</td>
<td>8.954561</td>
<td>199.829571</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>endosteal cell</td>
<td>NSM</td>
<td>89.169229</td>
<td>77.967966</td>
<td>11.309889</td>
<td>198.710354</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>endothelial cell of artery</td>
<td>AML</td>
<td>66.552461</td>
<td>57.188080</td>
<td>9.598652</td>
<td>197.775548</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>endothelial cell of artery</td>
<td>NBM</td>
<td>80.875474</td>
<td>71.598061</td>
<td>7.165130</td>
<td>199.696671</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>endothelial cell of artery</td>
<td>NSM</td>
<td>65.333875</td>
<td>55.348929</td>
<td>8.340683</td>
<td>199.496217</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>erythroblast</td>
<td>AML</td>
<td>74.204032</td>
<td>67.595458</td>
<td>9.345520</td>
<td>199.710488</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>erythroblast</td>
<td>NBM</td>
<td>97.493233</td>
<td>93.445013</td>
<td>9.438919</td>
<td>199.976653</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>erythroblast</td>
<td>NSM</td>
<td>99.975515</td>
<td>94.923044</td>
<td>10.526460</td>
<td>199.917168</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">24</th>
<td>erythroblast:basophilic</td>
<td>AML</td>
<td>52.951975</td>
<td>49.722590</td>
<td>12.385871</td>
<td>159.571485</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">25</th>
<td>erythroblast:basophilic</td>
<td>NBM</td>
<td>93.121025</td>
<td>93.171093</td>
<td>9.946056</td>
<td>199.013021</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">26</th>
<td>erythroblast:basophilic</td>
<td>NSM</td>
<td>69.175800</td>
<td>50.068324</td>
<td>21.363562</td>
<td>131.777261</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">27</th>
<td>erythroid lineage cell</td>
<td>AML</td>
<td>76.378711</td>
<td>67.967844</td>
<td>7.687746</td>
<td>199.911019</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">28</th>
<td>erythroid lineage cell</td>
<td>NBM</td>
<td>94.931105</td>
<td>90.427830</td>
<td>7.368943</td>
<td>199.990928</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">29</th>
<td>erythroid lineage cell</td>
<td>NSM</td>
<td>96.871888</td>
<td>91.762574</td>
<td>8.124669</td>
<td>199.985663</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">30</th>
<td>granulocyte monocyte progenitor cell</td>
<td>AML</td>
<td>70.212475</td>
<td>62.399469</td>
<td>8.821407</td>
<td>193.766544</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">31</th>
<td>granulocyte monocyte progenitor cell</td>
<td>NBM</td>
<td>99.994036</td>
<td>96.974877</td>
<td>10.086847</td>
<td>199.377339</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">32</th>
<td>granulocyte monocyte progenitor cell</td>
<td>NSM</td>
<td>113.471237</td>
<td>118.935939</td>
<td>24.621301</td>
<td>195.612217</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">33</th>
<td>granulocyte monocyte progenitor cell/myeloblast</td>
<td>AML</td>
<td>72.415964</td>
<td>63.423578</td>
<td>10.196329</td>
<td>190.981269</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">34</th>
<td>granulocyte monocyte progenitor cell/myeloblast</td>
<td>NBM</td>
<td>96.890873</td>
<td>95.757879</td>
<td>10.523154</td>
<td>199.686919</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">35</th>
<td>granulocyte monocyte progenitor cell/myeloblast</td>
<td>NSM</td>
<td>94.198042</td>
<td>90.199936</td>
<td>12.603882</td>
<td>198.890799</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">36</th>
<td>hematopoietic stem and progenitor cell:spink2+</td>
<td>AML</td>
<td>54.563528</td>
<td>37.139774</td>
<td>9.123395</td>
<td>189.847535</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">37</th>
<td>hematopoietic stem and progenitor cell:spink2+</td>
<td>NBM</td>
<td>95.280715</td>
<td>93.347852</td>
<td>9.670863</td>
<td>199.738928</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">38</th>
<td>hematopoietic stem and progenitor cell:spink2+</td>
<td>NSM</td>
<td>104.959083</td>
<td>98.965058</td>
<td>13.524865</td>
<td>196.588555</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">39</th>
<td>hematopoietic stem cell</td>
<td>AML</td>
<td>70.097786</td>
<td>59.523007</td>
<td>10.801688</td>
<td>193.191236</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">40</th>
<td>hematopoietic stem cell</td>
<td>NBM</td>
<td>96.060575</td>
<td>92.318654</td>
<td>9.741716</td>
<td>199.970348</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">41</th>
<td>hematopoietic stem cell</td>
<td>NSM</td>
<td>92.740997</td>
<td>90.714633</td>
<td>8.036234</td>
<td>199.237795</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">42</th>
<td>lymphoid progenitor cell:common</td>
<td>AML</td>
<td>70.369095</td>
<td>33.321110</td>
<td>11.891835</td>
<td>184.838570</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">43</th>
<td>lymphoid progenitor cell:common</td>
<td>NBM</td>
<td>101.297912</td>
<td>103.775147</td>
<td>8.703396</td>
<td>198.679098</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">44</th>
<td>lymphoid progenitor cell:common</td>
<td>NSM</td>
<td>48.644547</td>
<td>48.644547</td>
<td>40.392837</td>
<td>56.896257</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">45</th>
<td>macrophage</td>
<td>AML</td>
<td>73.826747</td>
<td>67.164529</td>
<td>9.347675</td>
<td>198.307993</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">46</th>
<td>macrophage</td>
<td>NBM</td>
<td>96.799495</td>
<td>91.931956</td>
<td>8.152219</td>
<td>199.997797</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">47</th>
<td>macrophage</td>
<td>NSM</td>
<td>90.324484</td>
<td>82.094705</td>
<td>9.073456</td>
<td>199.512374</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">48</th>
<td>megakaryocyte:gata1+</td>
<td>AML</td>
<td>76.859027</td>
<td>67.759673</td>
<td>11.187479</td>
<td>199.345585</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">49</th>
<td>megakaryocyte:gata1+</td>
<td>NBM</td>
<td>96.565594</td>
<td>89.912296</td>
<td>15.171096</td>
<td>199.835750</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">50</th>
<td>megakaryocyte:gata1+</td>
<td>NSM</td>
<td>99.813171</td>
<td>94.046165</td>
<td>12.087462</td>
<td>199.884221</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">51</th>
<td>megakaryocyte:gata1-</td>
<td>AML</td>
<td>81.549157</td>
<td>71.445335</td>
<td>9.953335</td>
<td>199.430617</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">52</th>
<td>megakaryocyte:gata1-</td>
<td>NBM</td>
<td>99.683106</td>
<td>95.220876</td>
<td>8.774989</td>
<td>199.937106</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">53</th>
<td>megakaryocyte:gata1-</td>
<td>NSM</td>
<td>96.343558</td>
<td>87.702763</td>
<td>14.433768</td>
<td>198.666219</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">54</th>
<td>mesenchymal stem cell of adipose tissue</td>
<td>AML</td>
<td>78.724108</td>
<td>71.696786</td>
<td>8.585049</td>
<td>198.703670</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">55</th>
<td>mesenchymal stem cell of adipose tissue</td>
<td>NBM</td>
<td>91.666993</td>
<td>87.259370</td>
<td>9.507509</td>
<td>199.986823</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">56</th>
<td>mesenchymal stem cell of adipose tissue</td>
<td>NSM</td>
<td>87.206186</td>
<td>83.498779</td>
<td>9.652741</td>
<td>199.570947</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">57</th>
<td>mesenchymal stem/stromal cell:thy1+</td>
<td>AML</td>
<td>75.223250</td>
<td>65.025012</td>
<td>10.898685</td>
<td>199.967713</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">58</th>
<td>mesenchymal stem/stromal cell:thy1+</td>
<td>NBM</td>
<td>91.820716</td>
<td>86.924087</td>
<td>7.572935</td>
<td>199.852192</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">59</th>
<td>mesenchymal stem/stromal cell:thy1+</td>
<td>NSM</td>
<td>91.464706</td>
<td>80.083330</td>
<td>10.301344</td>
<td>199.472893</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">60</th>
<td>monocyte</td>
<td>AML</td>
<td>81.998821</td>
<td>75.975206</td>
<td>8.868460</td>
<td>199.876784</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">61</th>
<td>monocyte</td>
<td>NBM</td>
<td>91.803183</td>
<td>87.198437</td>
<td>7.351953</td>
<td>199.985575</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">62</th>
<td>monocyte</td>
<td>NSM</td>
<td>91.957353</td>
<td>85.202021</td>
<td>8.268363</td>
<td>199.934336</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">63</th>
<td>monocyte:non-classical</td>
<td>AML</td>
<td>84.404224</td>
<td>77.154945</td>
<td>10.042509</td>
<td>199.557398</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">64</th>
<td>monocyte:non-classical</td>
<td>NBM</td>
<td>89.394134</td>
<td>83.017617</td>
<td>8.634223</td>
<td>199.962583</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">65</th>
<td>monocyte:non-classical</td>
<td>NSM</td>
<td>94.928483</td>
<td>89.610892</td>
<td>10.244014</td>
<td>199.859496</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">66</th>
<td>muscle cell:smooth</td>
<td>AML</td>
<td>69.735721</td>
<td>59.183423</td>
<td>10.271701</td>
<td>194.082988</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">67</th>
<td>muscle cell:smooth</td>
<td>NBM</td>
<td>94.216885</td>
<td>87.575318</td>
<td>9.427550</td>
<td>199.834792</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">68</th>
<td>muscle cell:smooth</td>
<td>NSM</td>
<td>55.313443</td>
<td>46.465657</td>
<td>10.248018</td>
<td>198.935026</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">69</th>
<td>mutant blast:npm1</td>
<td>AML</td>
<td>84.612826</td>
<td>78.755366</td>
<td>7.350124</td>
<td>199.982016</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">70</th>
<td>myeloid cell:intermediate</td>
<td>AML</td>
<td>81.373170</td>
<td>73.925935</td>
<td>8.604672</td>
<td>199.919874</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">71</th>
<td>myeloid cell:intermediate</td>
<td>NBM</td>
<td>96.900964</td>
<td>93.360407</td>
<td>7.505009</td>
<td>199.999142</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">72</th>
<td>myeloid cell:intermediate</td>
<td>NSM</td>
<td>97.020277</td>
<td>92.018090</td>
<td>8.173025</td>
<td>199.969054</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">73</th>
<td>myeloid cell:mature</td>
<td>AML</td>
<td>76.635516</td>
<td>68.660555</td>
<td>8.373370</td>
<td>199.748940</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">74</th>
<td>myeloid cell:mature</td>
<td>NBM</td>
<td>93.908272</td>
<td>89.618397</td>
<td>7.514845</td>
<td>199.998770</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">75</th>
<td>myeloid cell:mature</td>
<td>NSM</td>
<td>95.283475</td>
<td>89.390289</td>
<td>7.675593</td>
<td>199.984961</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">76</th>
<td>myeloid progenitor cell:common</td>
<td>AML</td>
<td>78.406261</td>
<td>70.510293</td>
<td>6.056625</td>
<td>199.797032</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">77</th>
<td>myeloid progenitor cell:common</td>
<td>NBM</td>
<td>98.947282</td>
<td>96.400048</td>
<td>8.000469</td>
<td>199.988637</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">78</th>
<td>myeloid progenitor cell:common</td>
<td>NSM</td>
<td>97.127281</td>
<td>92.476823</td>
<td>9.423956</td>
<td>199.969595</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">79</th>
<td>plasma cell</td>
<td>AML</td>
<td>79.030258</td>
<td>71.973497</td>
<td>9.340869</td>
<td>199.876610</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">80</th>
<td>plasma cell</td>
<td>NBM</td>
<td>100.456866</td>
<td>99.888396</td>
<td>8.273445</td>
<td>199.996640</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">81</th>
<td>plasma cell</td>
<td>NSM</td>
<td>96.900720</td>
<td>93.114820</td>
<td>10.602960</td>
<td>199.657054</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">82</th>
<td>schwann cell</td>
<td>AML</td>
<td>128.321993</td>
<td>128.321993</td>
<td>128.321993</td>
<td>128.321993</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">83</th>
<td>schwann cell</td>
<td>NBM</td>
<td>86.411262</td>
<td>78.933059</td>
<td>17.934662</td>
<td>175.871271</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">84</th>
<td>t cell:cd4+ alpha-beta</td>
<td>AML</td>
<td>82.044430</td>
<td>74.457114</td>
<td>8.247845</td>
<td>199.988548</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">85</th>
<td>t cell:cd4+ alpha-beta</td>
<td>NBM</td>
<td>94.775404</td>
<td>90.768274</td>
<td>8.443550</td>
<td>199.987582</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">86</th>
<td>t cell:cd4+ alpha-beta</td>
<td>NSM</td>
<td>92.912509</td>
<td>87.549465</td>
<td>9.815604</td>
<td>199.997383</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">87</th>
<td>t cell:cd8+ alpha-beta regulatory</td>
<td>AML</td>
<td>78.082735</td>
<td>70.753019</td>
<td>10.387187</td>
<td>199.927831</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">88</th>
<td>t cell:cd8+ alpha-beta regulatory</td>
<td>NBM</td>
<td>93.990508</td>
<td>89.772743</td>
<td>8.190426</td>
<td>199.995542</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">89</th>
<td>t cell:cd8+ alpha-beta regulatory</td>
<td>NSM</td>
<td>95.344181</td>
<td>89.646218</td>
<td>9.018322</td>
<td>199.899349</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">90</th>
<td>unknown cell</td>
<td>NBM</td>
<td>96.310960</td>
<td>92.693095</td>
<td>8.043118</td>
<td>199.984452</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="e6d69315" class="cell" data-execution_count="43">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_mean(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in NSM:
                             Level Three Cell Type  mean_distance
10            granulocyte monocyte progenitor cell     113.471237
12  hematopoietic stem and progenitor cell:spink2+     104.959083
7                                     erythroblast      99.975515
16                            megakaryocyte:gata1+      99.813171
2                                  b cell:immature      97.478212

Bottom 5 cell types in NSM:
              Level Three Cell Type  mean_distance
8           erythroblast:basophilic      69.175800
6        endothelial cell of artery      65.333875
22               muscle cell:smooth      55.313443
3                  cell:cd34+ cd61+      54.635086
14  lymphoid progenitor cell:common      48.644547

Top 5 cell types in AML:
     Level Three Cell Type  mean_distance
28            schwann cell     128.321993
23       mutant blast:npm1      84.612826
21  monocyte:non-classical      84.404224
2          b cell:immature      82.461384
29  t cell:cd4+ alpha-beta      82.044430

Bottom 5 cell types in AML:
                             Level Three Cell Type  mean_distance
13                         hematopoietic stem cell      70.097786
22                              muscle cell:smooth      69.735721
6                       endothelial cell of artery      66.552461
12  hematopoietic stem and progenitor cell:spink2+      54.563528
8                          erythroblast:basophilic      52.951975

Top 5 cell types in NBM:
                   Level Three Cell Type  mean_distance
14       lymphoid progenitor cell:common     101.297912
26                           plasma cell     100.456866
10  granulocyte monocyte progenitor cell      99.994036
17                  megakaryocyte:gata1-      99.683106
2                        b cell:immature      99.501175

Bottom 5 cell types in NBM:
                      Level Three Cell Type  mean_distance
20                                 monocyte      91.803183
18  mesenchymal stem cell of adipose tissue      91.666993
21                   monocyte:non-classical      89.394134
27                             schwann cell      86.411262
6                endothelial cell of artery      80.875474</code></pre>
</div>
</div>
<div id="c232dfa3" class="cell" data-execution_count="44">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_median(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in NSM:
                             Level Three Cell Type  median_distance
10            granulocyte monocyte progenitor cell       118.935939
12  hematopoietic stem and progenitor cell:spink2+        98.965058
7                                     erythroblast        94.923044
16                            megakaryocyte:gata1+        94.046165
26                                     plasma cell        93.114820

Bottom 5 cell types in NSM:
              Level Three Cell Type  median_distance
6        endothelial cell of artery        55.348929
3                  cell:cd34+ cd61+        52.248486
8           erythroblast:basophilic        50.068324
14  lymphoid progenitor cell:common        48.644547
22               muscle cell:smooth        46.465657

Top 5 cell types in AML:
     Level Three Cell Type  median_distance
28            schwann cell       128.321993
23       mutant blast:npm1        78.755366
21  monocyte:non-classical        77.154945
20                monocyte        75.975206
2          b cell:immature        75.703532

Bottom 5 cell types in AML:
                             Level Three Cell Type  median_distance
3                                 cell:cd34+ cd61+        57.285741
6                       endothelial cell of artery        57.188080
8                          erythroblast:basophilic        49.722590
12  hematopoietic stem and progenitor cell:spink2+        37.139774
14                 lymphoid progenitor cell:common        33.321110

Top 5 cell types in NBM:
                   Level Three Cell Type  median_distance
14       lymphoid progenitor cell:common       103.775147
26                           plasma cell        99.888396
3                       cell:cd34+ cd61+        99.005114
10  granulocyte monocyte progenitor cell        96.974877
2                        b cell:immature        96.731118

Bottom 5 cell types in NBM:
                  Level Three Cell Type  median_distance
20                             monocyte        87.198437
19  mesenchymal stem/stromal cell:thy1+        86.924087
21               monocyte:non-classical        83.017617
27                         schwann cell        78.933059
6            endothelial cell of artery        71.598061</code></pre>
</div>
</div>
<div id="b22b0717" class="cell" data-execution_count="45">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>calculate_regional_variability(df_all_edges_with_cell_type_level, cell_type_level)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regional Variability Analysis:
Mean: Average distance in each region
Std: Standard deviation of distances
CV: Coefficient of Variation (std/mean * 100%)
                mean    std  CV (%)
Unique Region                      
AML            79.39  44.80    56.4
NBM            95.30  48.83    51.2
NSM            95.64  51.03    53.4

Cell Type Variability Analysis (sorted by CV):
                                                  mean    std  CV (%)
Level Three Cell Type                                                
endothelial cell of artery                       77.69  52.16    67.1
muscle cell:smooth                               87.24  50.87    58.3
endosteal cell                                   92.68  52.72    56.9
monocyte:non-classical                           88.77  50.37    56.7
adipocyte                                        89.36  50.19    56.2
mesenchymal stem cell of adipose tissue          87.59  48.55    55.4
monocyte                                         89.70  49.59    55.3
lymphoid progenitor cell:common                  97.64  53.83    55.1
dendritic cell:plasmacytoid                      89.61  48.91    54.6
mesenchymal stem/stromal cell:thy1+              89.52  48.91    54.6
erythroblast:basophilic                          92.10  49.70    54.0
t cell:cd4+ alpha-beta                           92.64  49.75    53.7
granulocyte monocyte progenitor cell             87.89  47.14    53.6
t cell:cd8+ alpha-beta regulatory                93.04  49.71    53.4
myeloid cell:mature                              93.01  49.27    53.0
hematopoietic stem and progenitor cell:spink2+   93.87  49.72    53.0
cell:cd34+ cd61+                                 95.01  49.89    52.5
mutant blast:npm1                                84.61  44.08    52.1
erythroblast                                     90.48  47.17    52.1
erythroid lineage cell                           92.67  48.17    52.0
granulocyte monocyte progenitor cell/myeloblast  94.91  49.05    51.7
myeloid cell:intermediate                        94.93  49.07    51.7
b cell:immature                                  96.95  50.01    51.6
b cell                                           94.57  48.82    51.6
macrophage                                       92.25  47.60    51.6
hematopoietic stem cell                          94.15  48.57    51.6
megakaryocyte:gata1+                             90.24  46.49    51.5
myeloid progenitor cell:common                   95.58  49.01    51.3
plasma cell                                      94.90  48.57    51.2
unknown cell                                     96.31  48.92    50.8
schwann cell                                     87.43  43.59    49.9
megakaryocyte:gata1-                             97.85  46.95    48.0</code></pre>
</div>
</div>
<div id="47ab10e0" class="cell" data-execution_count="46">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>plot_violin_cells_per_celltype(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">'area'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_distance_analysis__bonemarrow-codex-chop_files/figure-html/cell-47-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="144bac62" class="cell" data-execution_count="47">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_boxplots_by_region(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_distance_analysis__bonemarrow-codex-chop_files/figure-html/cell-48-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="205fe8f9" class="cell" data-execution_count="48">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_heatmap(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_distance_analysis__bonemarrow-codex-chop_files/figure-html/cell-49-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="02803c6e" class="cell" data-execution_count="49">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>plot_violin_plots_all_regions(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">"count"</span>) <span class="co"># Or, density_norm="count" or "area" based on preference.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="09_distance_analysis__bonemarrow-codex-chop_files/figure-html/cell-50-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/cns-iu\.github\.io\/hra-cell-distance-analysis");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/cns-iu/hra-cell-distance-analysis/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>