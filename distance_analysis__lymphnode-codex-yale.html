<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Analyze and visualize cell-to-nearest-endothelial-cell distance distributions for the lymphnode-codex-yale dataset.">

<title>Distance Analysis: lymphnode-codex-yale – HRA: Cell Distance Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-000f0825b9c55ed21d14970d810c14a9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Distance Analysis: lymphnode-codex-yale – HRA: Cell Distance Analysis">
<meta property="og:description" content="Analyze and visualize cell-to-nearest-endothelial-cell distance distributions for the lymphnode-codex-yale dataset.">
<meta property="og:image" content="https://cns-iu.github.io/hra-cell-distance-analysis/11_distance_analysis__lymphnode-codex-yale_files/figure-html/cell-22-output-1.png">
<meta property="og:site_name" content="HRA: Cell Distance Analysis">
<meta property="og:image:height" content="790">
<meta property="og:image:width" content="1990">
<meta name="twitter:title" content="Distance Analysis: lymphnode-codex-yale – HRA: Cell Distance Analysis">
<meta name="twitter:description" content="Analyze and visualize cell-to-nearest-endothelial-cell distance distributions for the lymphnode-codex-yale dataset.">
<meta name="twitter:image" content="https://cns-iu.github.io/hra-cell-distance-analysis/11_distance_analysis__lymphnode-codex-yale_files/figure-html/cell-22-output-1.png">
<meta name="twitter:image-height" content="790">
<meta name="twitter:image-width" content="1990">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">HRA: Cell Distance Analysis</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./distance_analysis__lymphnode-codex-yale.html">Distance Analysis: lymphnode-codex-yale</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cell Distance Analysis for Spatial Omics Datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_processing__convert_to_cde_format.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Processing: Convert to CDE Format</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_processing__crosswalk_cell_type_names.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Processing: Harmonize Cell Types</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_analysis__cell_distribution_across_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Analysis: Call Distribution Across Datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_processing__distance_computation_for_all_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Processing: Cell Distance Computation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__intestine-codex-stanford.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: codex-intestine-stanford</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__pancreas-geomx-ufl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: pancreas-geomx-ufl</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__oralcavity-codex-czi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: oralcavity-codex-czi</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__lung-codex-urmc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: lung-codex-urmc</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__skin-confocal-sorgerlab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: skin-confocal-sorgerlab</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__bonemarrow-codex-chop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: bonemarrow-codex-chop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__colon-cycif-sorgerlab-colon-xenium-stanford.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: colon-xenium-stanford and colon-cycif-sorgerlab</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__lymphnode-codex-yale.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Distance Analysis: lymphnode-codex-yale</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__spleen-codex-ufl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: spleen-codex-ufl</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__tonsil-codex-stanford-esophagus-codex-stanford.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: tonsil-codex-stanford and esophagus-codex-stanford</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__skin-celldive-ge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: skin-celldive-ge</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__maternalfetalinterface-mibitof-stanford.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: maternalfetalinterface-mibitof-stanford</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset." id="toc-get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset." class="nav-link active" data-scroll-target="#get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset.">Get initial statistics and identify endothelial cell categories for dataset.</a></li>
  <li><a href="#process-datasets-to-add-region-information-to-nodes-files." id="toc-process-datasets-to-add-region-information-to-nodes-files." class="nav-link" data-scroll-target="#process-datasets-to-add-region-information-to-nodes-files.">Process datasets to add region information to Nodes files.</a></li>
  <li><a href="#process-datasets-to-add-region-information-to-edges-files." id="toc-process-datasets-to-add-region-information-to-edges-files." class="nav-link" data-scroll-target="#process-datasets-to-add-region-information-to-edges-files.">Process datasets to add region information to Edges files.</a></li>
  <li><a href="#node-analysis" id="toc-node-analysis" class="nav-link" data-scroll-target="#node-analysis">Node Analysis</a></li>
  <li><a href="#distance-analysis" id="toc-distance-analysis" class="nav-link" data-scroll-target="#distance-analysis">Distance Analysis</a>
  <ul class="collapse">
  <li><a href="#level-one-cell-type-analysis" id="toc-level-one-cell-type-analysis" class="nav-link" data-scroll-target="#level-one-cell-type-analysis">Level One Cell Type Analysis</a></li>
  <li><a href="#level-two-cell-type-analysis" id="toc-level-two-cell-type-analysis" class="nav-link" data-scroll-target="#level-two-cell-type-analysis">Level Two Cell Type Analysis</a></li>
  <li><a href="#level-three-cell-type-analysis" id="toc-level-three-cell-type-analysis" class="nav-link" data-scroll-target="#level-three-cell-type-analysis">Level Three Cell Type Analysis</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/cns-iu/hra-cell-distance-analysis/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="distance_analysis__lymphnode-codex-yale.html.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Distance Analysis: lymphnode-codex-yale</h1>
</div>

<div>
  <div class="description">
    Analyze and visualize cell-to-nearest-endothelial-cell distance distributions for the <code>lymphnode-codex-yale</code> dataset.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div id="cell-2" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> normalize</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> _cde_compute_edges_from_nodes <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="va">None</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="va">None</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># suppress warnings</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-3" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>basepath <span class="op">=</span> <span class="st">"/u/yashjain/hra-cell-distance-analysis/data"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dataset_dir <span class="op">=</span> <span class="st">"lymphnode-codex-yale"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>data_filedir <span class="op">=</span> os.path.join(<span class="st">"data-processed-nodes-with-harmonized-cell-types"</span>, dataset_dir)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>output_edge_dir <span class="op">=</span> os.path.join(<span class="st">"data-processed-edges"</span>, dataset_dir)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>figures_output_dir <span class="op">=</span> <span class="st">"generated-figures"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-4" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to load your data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_data(path, edges<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> edges:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        column_names <span class="op">=</span> [<span class="st">'cell_id'</span>, <span class="st">'x1'</span>, <span class="st">'y1'</span>, <span class="st">'z1'</span>, <span class="st">'x2'</span>, <span class="st">'y2'</span>, <span class="st">'z2'</span>]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> pd.read_csv(path, header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>column_names)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> pd.read_csv(path)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-5" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to read all files ending with "-nodes.csv" in the `data_filedir` directory into a single DataFrame. </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Another additional column `Dataset` is added to identify the dataset name which comes from the filename before the `-nodes.csv` suffix.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Additionally, function reads all files ending with "-edges.csv" in the `output_edge_dir` directory into a single DataFrame. </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Three additional columns are added "Dataset", "Anchor Cell Type", and "Anchor Cell Type Level" to identify the dataset name, anchor cell type, and anchor cell type level respectively which come from the filename before the `.csv` suffix.</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The three additional columns are created by splitting the filename on the `-` character, and extracting the relevant parts.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># On splitting, the first part is the dataset name, second part is the anchor cell type level, and third part is the anchor cell type, and last part is the `edges` suffix.</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># When reading files, check if the file has the correct format (i.e., ends with `-edges.csv`).</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Additionally, the function merges the edges DataFrame with the nodes DataFrame to get the cell type information for the anchor cells.</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># This is done by reading the corresponding nodes file from the `data_filedir` directory for each edges file, and merging it with the edges DataFrame on the `cell_id` column.</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># The merged DataFrame contains the edges with additional columns for the cell type information.</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># The function returns three DataFrames:</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. `merged_nodes`: DataFrame containing all nodes with an additional column `Dataset`.</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. `merged_edges`: DataFrame containing all edges with additional columns `Dataset`, `Anchor Cell Type`, and `Anchor Cell Type Level`.</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. `merged_nodes_for_all_edges`: DataFrame containing all edges with additional columns `Dataset`, `Anchor Cell Type`, `Anchor Cell Type Level`, and the cell type information for cells.</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_all_edge_datasets(basepath, data_filedir, output_edge_dir):</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    all_nodes_files <span class="op">=</span> []</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    all_edges_files <span class="op">=</span> []</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    all_nodes_edges_files <span class="op">=</span> []</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir(os.path.join(basepath, output_edge_dir)):</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">"-edges.csv"</span>):</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            file_path <span class="op">=</span> os.path.join(basepath, output_edge_dir, <span class="bu">file</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>            dataset_name, anchor_cell_type_level, anchor_cell_type <span class="op">=</span> <span class="bu">file</span>.replace(<span class="st">"-edges.csv"</span>, <span class="st">""</span>).split(<span class="st">'-'</span>)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            edges_df <span class="op">=</span> load_data(file_path, edges<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>            edges_df[<span class="st">'Dataset'</span>] <span class="op">=</span> dataset_name</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            edges_df[<span class="st">'Anchor Cell Type'</span>] <span class="op">=</span> anchor_cell_type</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>            edges_df[<span class="st">'Anchor Cell Type Level'</span>] <span class="op">=</span> anchor_cell_type_level</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>            edges_df.rename(columns<span class="op">=</span>{<span class="st">"distance"</span>: <span class="st">"Distance"</span>}, inplace<span class="op">=</span><span class="va">True</span>) <span class="co"># Rename column "distance" to "Distance".</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>            all_edges_files.append(edges_df)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Read the corresponding nodes file from data_filedir to get the cell type information</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>            nodes_file_path <span class="op">=</span> os.path.join(basepath, data_filedir, <span class="ss">f"</span><span class="sc">{</span>dataset_name<span class="sc">}</span><span class="ss">-nodes.csv"</span>)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>            nodes_df <span class="op">=</span> load_data(nodes_file_path)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>            nodes_df[<span class="st">'Dataset'</span>] <span class="op">=</span> dataset_name</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>            all_nodes_files.append(nodes_df)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a new 'cell_id' column to nodes_df</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>            nodes_df[<span class="st">'cell_id'</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(nodes_df))</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Set 'cell_id' column as index for nodes_df</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>            nodes_df.set_index(<span class="st">'cell_id'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Merge edges_df with nodes_df to get the cell type information for the anchor cells</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>            edges_nodes_df <span class="op">=</span> pd.merge(edges_df, nodes_df[[<span class="st">'Level Three Cell Type'</span>, <span class="st">'Level Two Cell Type'</span>, <span class="st">'Level One Cell Type'</span>]], how<span class="op">=</span><span class="st">'left'</span>, left_on<span class="op">=</span><span class="st">'cell_id'</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>            all_nodes_edges_files.append(edges_nodes_df)</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    merged_edges <span class="op">=</span> pd.concat(all_edges_files, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    merged_nodes <span class="op">=</span> pd.concat(all_nodes_files, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    merged_nodes_for_all_edges <span class="op">=</span> pd.concat(all_nodes_edges_files, ignore_index<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merged_nodes, merged_edges, merged_nodes_for_all_edges</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-6" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_directory(directory):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(directory):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        os.makedirs(directory)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Directory '</span><span class="sc">{</span>directory<span class="sc">}</span><span class="ss">' created successfully."</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Directory '</span><span class="sc">{</span>directory<span class="sc">}</span><span class="ss">' already exists."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset." class="level2">
<h2 class="anchored" data-anchor-id="get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset.">Get initial statistics and identify endothelial cell categories for dataset.</h2>
<div id="cell-8" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_all_nodes, df_all_edges, df_all_edges_with_cell_types <span class="op">=</span> read_all_edge_datasets(basepath, data_filedir, output_edge_dir)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-9" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df_all_nodes.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">Original Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three CL Label</th>
<th data-quarto-table-cell-role="th">Level Three CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/3</th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Level Two CL Label</th>
<th data-quarto-table-cell-role="th">Level Two CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/2</th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Level One CL Label</th>
<th data-quarto-table-cell-role="th">Level One CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/1</th>
<th data-quarto-table-cell-role="th">Dataset</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>26180.447514</td>
<td>8865.939227</td>
<td>FDC</td>
<td>dendritic cell:follicular</td>
<td>follicular dendritic cell</td>
<td>CL:0000442</td>
<td>skos:exactMatch</td>
<td>dendritic cell</td>
<td>dendritic cell</td>
<td>CL:0000451</td>
<td>skos:exactMatch</td>
<td>mesenchymal cell</td>
<td>mesenchymal cell</td>
<td>CL:0008019</td>
<td>skos:exactMatch</td>
<td>LN00560</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>15214.596774</td>
<td>11441.217742</td>
<td>FDC</td>
<td>dendritic cell:follicular</td>
<td>follicular dendritic cell</td>
<td>CL:0000442</td>
<td>skos:exactMatch</td>
<td>dendritic cell</td>
<td>dendritic cell</td>
<td>CL:0000451</td>
<td>skos:exactMatch</td>
<td>mesenchymal cell</td>
<td>mesenchymal cell</td>
<td>CL:0008019</td>
<td>skos:exactMatch</td>
<td>LN00560</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>7498.846154</td>
<td>12306.583333</td>
<td>FDC</td>
<td>dendritic cell:follicular</td>
<td>follicular dendritic cell</td>
<td>CL:0000442</td>
<td>skos:exactMatch</td>
<td>dendritic cell</td>
<td>dendritic cell</td>
<td>CL:0000451</td>
<td>skos:exactMatch</td>
<td>mesenchymal cell</td>
<td>mesenchymal cell</td>
<td>CL:0008019</td>
<td>skos:exactMatch</td>
<td>LN00560</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>26618.031142</td>
<td>18349.024221</td>
<td>FDC</td>
<td>dendritic cell:follicular</td>
<td>follicular dendritic cell</td>
<td>CL:0000442</td>
<td>skos:exactMatch</td>
<td>dendritic cell</td>
<td>dendritic cell</td>
<td>CL:0000451</td>
<td>skos:exactMatch</td>
<td>mesenchymal cell</td>
<td>mesenchymal cell</td>
<td>CL:0008019</td>
<td>skos:exactMatch</td>
<td>LN00560</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>8325.500000</td>
<td>12150.222222</td>
<td>FDC</td>
<td>dendritic cell:follicular</td>
<td>follicular dendritic cell</td>
<td>CL:0000442</td>
<td>skos:exactMatch</td>
<td>dendritic cell</td>
<td>dendritic cell</td>
<td>CL:0000451</td>
<td>skos:exactMatch</td>
<td>mesenchymal cell</td>
<td>mesenchymal cell</td>
<td>CL:0008019</td>
<td>skos:exactMatch</td>
<td>LN00560</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-10" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the total number of unique cell types per dataset. Compute separately for each cell type column (Level One Cell Type, Level Two Cell Type, Level Three Cell Type, Original Cell Type).</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Total number of unique cell types per cell type annnotation level:"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>unique_cell_types <span class="op">=</span> {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Original Cell Type'</span>: df_all_nodes[<span class="st">'Original Cell Type'</span>].nunique(),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Three Cell Type'</span>: df_all_nodes[<span class="st">'Level Three Cell Type'</span>].nunique(),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Two Cell Type'</span>: df_all_nodes[<span class="st">'Level Two Cell Type'</span>].nunique(),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level One Cell Type'</span>: df_all_nodes[<span class="st">'Level One Cell Type'</span>].nunique()</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cell_type, count <span class="kw">in</span> unique_cell_types.items():</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>cell_type<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total number of unique cell types per cell type annnotation level:
Original Cell Type: 34
Level Three Cell Type: 29
Level Two Cell Type: 10
Level One Cell Type: 3</code></pre>
</div>
</div>
<div id="cell-11" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the unique cell types containing "endothelial" in name per cell type column (Level One Cell Type, Level Two Cell Type, Level Three Cell Type, Original Cell Type) to a dictionary where the key is the level and the value is a list of unique cell types.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>endothelial_cell_types <span class="op">=</span> {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Original Cell Type'</span>: df_all_nodes[df_all_nodes[<span class="st">'Original Cell Type'</span>].<span class="bu">str</span>.contains(<span class="st">"endothelial"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)][<span class="st">'Original Cell Type'</span>].unique().tolist(),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Three Cell Type'</span>: df_all_nodes[df_all_nodes[<span class="st">'Level Three Cell Type'</span>].<span class="bu">str</span>.contains(<span class="st">"endothelial"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)][<span class="st">'Level Three Cell Type'</span>].unique().tolist(),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Two Cell Type'</span>: df_all_nodes[df_all_nodes[<span class="st">'Level Two Cell Type'</span>].<span class="bu">str</span>.contains(<span class="st">"endothelial"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)][<span class="st">'Level Two Cell Type'</span>].unique().tolist(),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level One Cell Type'</span>: df_all_nodes[df_all_nodes[<span class="st">'Level One Cell Type'</span>].<span class="bu">str</span>.contains(<span class="st">"endothelial"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)][<span class="st">'Level One Cell Type'</span>].unique().tolist()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Endothelial cell types per cell type annotation level:"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> level, cell_types <span class="kw">in</span> endothelial_cell_types.items():</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cell <span class="kw">in</span> cell_types:</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  - </span><span class="sc">{</span>cell<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Endothelial cell types per cell type annotation level:

Original Cell Type:
  - Endothelial

Level Three Cell Type:
  - endothelial cell

Level Two Cell Type:
  - endothelial cell

Level One Cell Type:
  - endothelial cell</code></pre>
</div>
</div>
<div id="cell-12" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>type_field_list <span class="op">=</span> [<span class="st">"Level Three Cell Type"</span>, <span class="st">"Level Two Cell Type"</span>, <span class="st">"Level One Cell Type"</span>] <span class="co"># Skipping Original Cell Type as it is not a hierarchical level.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the anchor cell type (type of endothelial cell) for each level in type_field_list based on available categories in the previous cell. The distance analysis at all three levels will be limited to the specified anchor cell type.</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>anchor_cell_type_dict <span class="op">=</span> {</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Three Cell Type'</span>: <span class="st">'endothelial cell'</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Two Cell Type'</span>: <span class="st">'endothelial cell'</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level One Cell Type'</span>: <span class="st">'endothelial cell'</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="process-datasets-to-add-region-information-to-nodes-files." class="level2">
<h2 class="anchored" data-anchor-id="process-datasets-to-add-region-information-to-nodes-files.">Process datasets to add region information to Nodes files.</h2>
<div id="cell-14" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df_all_nodes.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">Original Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three CL Label</th>
<th data-quarto-table-cell-role="th">Level Three CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/3</th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Level Two CL Label</th>
<th data-quarto-table-cell-role="th">Level Two CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/2</th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Level One CL Label</th>
<th data-quarto-table-cell-role="th">Level One CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/1</th>
<th data-quarto-table-cell-role="th">Dataset</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>26180.447514</td>
<td>8865.939227</td>
<td>FDC</td>
<td>dendritic cell:follicular</td>
<td>follicular dendritic cell</td>
<td>CL:0000442</td>
<td>skos:exactMatch</td>
<td>dendritic cell</td>
<td>dendritic cell</td>
<td>CL:0000451</td>
<td>skos:exactMatch</td>
<td>mesenchymal cell</td>
<td>mesenchymal cell</td>
<td>CL:0008019</td>
<td>skos:exactMatch</td>
<td>LN00560</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>15214.596774</td>
<td>11441.217742</td>
<td>FDC</td>
<td>dendritic cell:follicular</td>
<td>follicular dendritic cell</td>
<td>CL:0000442</td>
<td>skos:exactMatch</td>
<td>dendritic cell</td>
<td>dendritic cell</td>
<td>CL:0000451</td>
<td>skos:exactMatch</td>
<td>mesenchymal cell</td>
<td>mesenchymal cell</td>
<td>CL:0008019</td>
<td>skos:exactMatch</td>
<td>LN00560</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>7498.846154</td>
<td>12306.583333</td>
<td>FDC</td>
<td>dendritic cell:follicular</td>
<td>follicular dendritic cell</td>
<td>CL:0000442</td>
<td>skos:exactMatch</td>
<td>dendritic cell</td>
<td>dendritic cell</td>
<td>CL:0000451</td>
<td>skos:exactMatch</td>
<td>mesenchymal cell</td>
<td>mesenchymal cell</td>
<td>CL:0008019</td>
<td>skos:exactMatch</td>
<td>LN00560</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>26618.031142</td>
<td>18349.024221</td>
<td>FDC</td>
<td>dendritic cell:follicular</td>
<td>follicular dendritic cell</td>
<td>CL:0000442</td>
<td>skos:exactMatch</td>
<td>dendritic cell</td>
<td>dendritic cell</td>
<td>CL:0000451</td>
<td>skos:exactMatch</td>
<td>mesenchymal cell</td>
<td>mesenchymal cell</td>
<td>CL:0008019</td>
<td>skos:exactMatch</td>
<td>LN00560</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>8325.500000</td>
<td>12150.222222</td>
<td>FDC</td>
<td>dendritic cell:follicular</td>
<td>follicular dendritic cell</td>
<td>CL:0000442</td>
<td>skos:exactMatch</td>
<td>dendritic cell</td>
<td>dendritic cell</td>
<td>CL:0000451</td>
<td>skos:exactMatch</td>
<td>mesenchymal cell</td>
<td>mesenchymal cell</td>
<td>CL:0008019</td>
<td>skos:exactMatch</td>
<td>LN00560</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-15" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through the df_all_data dataframe to create new column "Unique Region" based on the "Dataset" column.</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The "Unique Region" column is created by mapping the region names based on the full dataset name.</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>df_all_nodes[<span class="st">'Unique Region'</span>] <span class="op">=</span> df_all_nodes[<span class="st">'Dataset'</span>]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># df_all_nodes['Unique Region'] = df_all_nodes['Dataset'].map(region_map)</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># df_all_nodes['Unique Region'] = df_all_nodes['Dataset'].str.split('-').str[1].map(region_map)</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the new columns are created correctly.</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>df_all_nodes[[<span class="st">'Dataset'</span>, <span class="st">'Unique Region'</span>]].head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>LN00560</td>
<td>LN00560</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>LN00560</td>
<td>LN00560</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>LN00560</td>
<td>LN00560</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>LN00560</td>
<td>LN00560</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>LN00560</td>
<td>LN00560</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-16" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print all unique regions in the data.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Unique Regions in the data:"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_all_nodes[<span class="st">'Unique Region'</span>].unique())</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the total number of unique regions.</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total number of unique regions: </span><span class="sc">{</span>df_all_nodes[<span class="st">'Unique Region'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print number of unique datasets per unique region.</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Number of unique datasets per unique region:"</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> df_all_nodes[<span class="st">'Unique Region'</span>].unique():</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    num_datasets <span class="op">=</span> df_all_nodes[df_all_nodes[<span class="st">'Unique Region'</span>] <span class="op">==</span> region][<span class="st">'Dataset'</span>].nunique()</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>num_datasets<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Unique Regions in the data:
['LN00560' 'LN00837' 'LN22921' 'LN24336' 'LN27766']
Total number of unique regions: 5

Number of unique datasets per unique region:
LN00560: 1
LN00837: 1
LN22921: 1
LN24336: 1
LN27766: 1</code></pre>
</div>
</div>
</section>
<section id="process-datasets-to-add-region-information-to-edges-files." class="level2">
<h2 class="anchored" data-anchor-id="process-datasets-to-add-region-information-to-edges-files.">Process datasets to add region information to Edges files.</h2>
<div id="cell-18" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df_all_edges.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cell_id</th>
<th data-quarto-table-cell-role="th">x1</th>
<th data-quarto-table-cell-role="th">y1</th>
<th data-quarto-table-cell-role="th">z1</th>
<th data-quarto-table-cell-role="th">x2</th>
<th data-quarto-table-cell-role="th">y2</th>
<th data-quarto-table-cell-role="th">z2</th>
<th data-quarto-table-cell-role="th">Distance</th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type Level</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>26180.447514</td>
<td>8865.939227</td>
<td>0</td>
<td>26183.569536</td>
<td>8838.370861</td>
<td>0</td>
<td>27.744582</td>
<td>LN00560</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1297</td>
<td>26171.400000</td>
<td>8972.626667</td>
<td>0</td>
<td>26264.875000</td>
<td>8904.781250</td>
<td>0</td>
<td>115.501412</td>
<td>LN00560</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>3106</td>
<td>26140.166667</td>
<td>8974.675000</td>
<td>0</td>
<td>26054.031088</td>
<td>8889.103627</td>
<td>0</td>
<td>121.415805</td>
<td>LN00560</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>3497</td>
<td>26051.509259</td>
<td>8961.282407</td>
<td>0</td>
<td>26054.031088</td>
<td>8889.103627</td>
<td>0</td>
<td>72.222822</td>
<td>LN00560</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>49397</td>
<td>26015.800000</td>
<td>8832.882759</td>
<td>0</td>
<td>26054.031088</td>
<td>8889.103627</td>
<td>0</td>
<td>67.988250</td>
<td>LN00560</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-19" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Process the edge data to create new columns "Unique Region" based on the "Dataset" column, similar to how it was done for the node data.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df_all_edges[<span class="st">'Unique Region'</span>] <span class="op">=</span> df_all_edges[<span class="st">'Dataset'</span>]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># df_all_edges['Unique Region'] = df_all_edges['Dataset'].map(region_map)</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the new columns are created correctly.</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>df_all_edges[[<span class="st">'Dataset'</span>, <span class="st">'Unique Region'</span>]].head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>LN00560</td>
<td>LN00560</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>LN00560</td>
<td>LN00560</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>LN00560</td>
<td>LN00560</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>LN00560</td>
<td>LN00560</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>LN00560</td>
<td>LN00560</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-20" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print all unique regions in the data.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Unique Regions in the data:"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_all_edges[<span class="st">'Unique Region'</span>].unique())</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the total number of unique regions.</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total number of unique regions: </span><span class="sc">{</span>df_all_edges[<span class="st">'Unique Region'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print number of unique datasets per unique region.</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Number of unique datasets per unique region:"</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> df_all_edges[<span class="st">'Unique Region'</span>].unique():</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    num_datasets <span class="op">=</span> df_all_edges[df_all_edges[<span class="st">'Unique Region'</span>] <span class="op">==</span> region][<span class="st">'Dataset'</span>].nunique()</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>num_datasets<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Unique Regions in the data:
['LN00560' 'LN00837' 'LN22921' 'LN24336' 'LN27766']
Total number of unique regions: 5

Number of unique datasets per unique region:
LN00560: 1
LN00837: 1
LN22921: 1
LN24336: 1
LN27766: 1</code></pre>
</div>
</div>
<div id="cell-21" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_types[<span class="st">'Unique Region'</span>] <span class="op">=</span> df_all_edges_with_cell_types[<span class="st">'Dataset'</span>]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># df_all_edges_with_cell_types['Unique Region'] = df_all_edges_with_cell_types['Dataset'].map(region_map)</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the new columns are created correctly.</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_types[[<span class="st">'Dataset'</span>, <span class="st">'Unique Region'</span>]].head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>LN00560</td>
<td>LN00560</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>LN00560</td>
<td>LN00560</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>LN00560</td>
<td>LN00560</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>LN00560</td>
<td>LN00560</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>LN00560</td>
<td>LN00560</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-22" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df_all_nodes.head(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">Original Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three CL Label</th>
<th data-quarto-table-cell-role="th">Level Three CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/3</th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Level Two CL Label</th>
<th data-quarto-table-cell-role="th">Level Two CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/2</th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Level One CL Label</th>
<th data-quarto-table-cell-role="th">Level One CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/1</th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>26180.447514</td>
<td>8865.939227</td>
<td>FDC</td>
<td>dendritic cell:follicular</td>
<td>follicular dendritic cell</td>
<td>CL:0000442</td>
<td>skos:exactMatch</td>
<td>dendritic cell</td>
<td>dendritic cell</td>
<td>CL:0000451</td>
<td>skos:exactMatch</td>
<td>mesenchymal cell</td>
<td>mesenchymal cell</td>
<td>CL:0008019</td>
<td>skos:exactMatch</td>
<td>LN00560</td>
<td>LN00560</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-23" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_all_edges.head(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cell_id</th>
<th data-quarto-table-cell-role="th">x1</th>
<th data-quarto-table-cell-role="th">y1</th>
<th data-quarto-table-cell-role="th">z1</th>
<th data-quarto-table-cell-role="th">x2</th>
<th data-quarto-table-cell-role="th">y2</th>
<th data-quarto-table-cell-role="th">z2</th>
<th data-quarto-table-cell-role="th">Distance</th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type Level</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>26180.447514</td>
<td>8865.939227</td>
<td>0</td>
<td>26183.569536</td>
<td>8838.370861</td>
<td>0</td>
<td>27.744582</td>
<td>LN00560</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
<td>LN00560</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-24" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_types.head(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cell_id</th>
<th data-quarto-table-cell-role="th">x1</th>
<th data-quarto-table-cell-role="th">y1</th>
<th data-quarto-table-cell-role="th">z1</th>
<th data-quarto-table-cell-role="th">x2</th>
<th data-quarto-table-cell-role="th">y2</th>
<th data-quarto-table-cell-role="th">z2</th>
<th data-quarto-table-cell-role="th">Distance</th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type Level</th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>26180.447514</td>
<td>8865.939227</td>
<td>0</td>
<td>26183.569536</td>
<td>8838.370861</td>
<td>0</td>
<td>27.744582</td>
<td>LN00560</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
<td>dendritic cell:follicular</td>
<td>dendritic cell</td>
<td>mesenchymal cell</td>
<td>LN00560</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="node-analysis" class="level2">
<h2 class="anchored" data-anchor-id="node-analysis">Node Analysis</h2>
<div id="cell-26" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot number of cells per cell type in the same plot. Color by cell type and unique region. Output figure saved in existing `figures_output_dir`.</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_cells_per_celltype(df, type_field, output_dir):</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">8</span>))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    sns.countplot(data<span class="op">=</span>df, x<span class="op">=</span>type_field, palette<span class="op">=</span><span class="st">'Spectral'</span>, hue<span class="op">=</span><span class="st">'Unique Region'</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Number of Cells per </span><span class="sc">{</span>type_field<span class="sc">}</span><span class="ss"> in `</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">`'</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_cells_per_celltype_</span><span class="sc">{</span>type_field<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>                pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_cells_per_celltype_</span><span class="sc">{</span>type_field<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>                bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>                pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    plt.legend(title<span class="op">=</span><span class="st">'Unique Region'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.85</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(type_field)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For numbers on y-axis, do not use scientific notation.</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    plt.ticklabel_format(style<span class="op">=</span><span class="st">'plain'</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set y-axis label</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Number of Cells'</span>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the plot</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> type_field <span class="kw">in</span> type_field_list:</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    plot_cells_per_celltype(df_all_nodes, type_field, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="11_distance_analysis__lymphnode-codex-yale_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="11_distance_analysis__lymphnode-codex-yale_files/figure-html/cell-22-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="11_distance_analysis__lymphnode-codex-yale_files/figure-html/cell-22-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="distance-analysis" class="level2">
<h2 class="anchored" data-anchor-id="distance-analysis">Distance Analysis</h2>
<div id="cell-28" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get mean, median, minimum, maximum distance per unique region per anchor cell type.</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df_distance_stats <span class="op">=</span> df_all_edges_with_cell_types.groupby([<span class="st">'Unique Region'</span>, <span class="st">'Anchor Cell Type'</span>, <span class="st">'Anchor Cell Type Level'</span>]).agg(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    min_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'min'</span>),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    max_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'max'</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the first few rows of the distance statistics DataFrame.</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>df_distance_stats</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type Level</th>
<th data-quarto-table-cell-role="th">mean_distance</th>
<th data-quarto-table-cell-role="th">median_distance</th>
<th data-quarto-table-cell-role="th">min_distance</th>
<th data-quarto-table-cell-role="th">max_distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>LN00560</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>86.248270</td>
<td>78.322089</td>
<td>4.875021</td>
<td>199.999931</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>LN00560</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
<td>86.248270</td>
<td>78.322089</td>
<td>4.875021</td>
<td>199.999931</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>LN00560</td>
<td>endothelial cell</td>
<td>Level Two Cell Type</td>
<td>86.248270</td>
<td>78.322089</td>
<td>4.875021</td>
<td>199.999931</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>LN00837</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>65.648760</td>
<td>55.365786</td>
<td>6.102839</td>
<td>199.990502</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>LN00837</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
<td>65.648760</td>
<td>55.365786</td>
<td>6.102839</td>
<td>199.990502</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>LN00837</td>
<td>endothelial cell</td>
<td>Level Two Cell Type</td>
<td>65.648760</td>
<td>55.365786</td>
<td>6.102839</td>
<td>199.990502</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>LN22921</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>69.028245</td>
<td>58.886066</td>
<td>4.797734</td>
<td>199.999849</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>LN22921</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
<td>69.028245</td>
<td>58.886066</td>
<td>4.797734</td>
<td>199.999849</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>LN22921</td>
<td>endothelial cell</td>
<td>Level Two Cell Type</td>
<td>69.028245</td>
<td>58.886066</td>
<td>4.797734</td>
<td>199.999849</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>LN24336</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>62.287459</td>
<td>51.618910</td>
<td>4.235994</td>
<td>199.999774</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>LN24336</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
<td>62.287459</td>
<td>51.618910</td>
<td>4.235994</td>
<td>199.999774</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>LN24336</td>
<td>endothelial cell</td>
<td>Level Two Cell Type</td>
<td>62.287459</td>
<td>51.618910</td>
<td>4.235994</td>
<td>199.999774</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>LN27766</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>48.661838</td>
<td>37.794400</td>
<td>5.664908</td>
<td>199.999790</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>LN27766</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
<td>48.661838</td>
<td>37.794400</td>
<td>5.664908</td>
<td>199.999790</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>LN27766</td>
<td>endothelial cell</td>
<td>Level Two Cell Type</td>
<td>48.661838</td>
<td>37.794400</td>
<td>5.664908</td>
<td>199.999790</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="level-one-cell-type-analysis" class="level3">
<h3 class="anchored" data-anchor-id="level-one-cell-type-analysis">Level One Cell Type Analysis</h3>
<div id="cell-30" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get mean, median, minimum, maximum distance per cell type in all unique regions.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>cell_type_level <span class="op">=</span> <span class="st">'Level One Cell Type'</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_type_level <span class="op">=</span> df_all_edges_with_cell_types[(df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type Level'</span>] <span class="op">==</span> cell_type_level) <span class="op">&amp;</span> (df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type'</span>] <span class="op">==</span> anchor_cell_type_dict[cell_type_level])]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level <span class="op">=</span> df_all_edges_with_cell_type_level.groupby([cell_type_level, <span class="st">'Unique Region'</span>]).agg(</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    min_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'min'</span>),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    max_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'max'</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">mean_distance</th>
<th data-quarto-table-cell-role="th">median_distance</th>
<th data-quarto-table-cell-role="th">min_distance</th>
<th data-quarto-table-cell-role="th">max_distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>immune cell</td>
<td>LN00560</td>
<td>86.230167</td>
<td>78.283379</td>
<td>4.875021</td>
<td>199.999931</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>immune cell</td>
<td>LN00837</td>
<td>65.658556</td>
<td>55.426203</td>
<td>6.102839</td>
<td>199.990502</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>immune cell</td>
<td>LN22921</td>
<td>69.098860</td>
<td>58.969275</td>
<td>4.797734</td>
<td>199.999849</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>immune cell</td>
<td>LN24336</td>
<td>62.325526</td>
<td>51.657698</td>
<td>4.235994</td>
<td>199.999774</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>immune cell</td>
<td>LN27766</td>
<td>48.323776</td>
<td>37.625713</td>
<td>5.664908</td>
<td>199.999790</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>mesenchymal cell</td>
<td>LN00560</td>
<td>88.029798</td>
<td>81.864293</td>
<td>6.239511</td>
<td>199.836667</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>mesenchymal cell</td>
<td>LN00837</td>
<td>64.156297</td>
<td>47.402660</td>
<td>9.376279</td>
<td>199.972438</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>mesenchymal cell</td>
<td>LN22921</td>
<td>42.860136</td>
<td>30.269759</td>
<td>6.260871</td>
<td>199.945312</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>mesenchymal cell</td>
<td>LN24336</td>
<td>45.284939</td>
<td>34.253833</td>
<td>7.974461</td>
<td>199.351793</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>mesenchymal cell</td>
<td>LN27766</td>
<td>63.171914</td>
<td>49.198156</td>
<td>6.110041</td>
<td>199.979704</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-31" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top five and bottom five cell types with respect to mean distance in each unique region separately.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_top_bottom_cell_types_by_mean(df, cell_type_level, unique_region, top_n<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the DataFrame for the specified unique region and cell type level</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    df_filtered <span class="op">=</span> df[df[<span class="st">'Unique Region'</span>] <span class="op">==</span> unique_region]</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by the specified cell type level and calculate mean distance</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    df_grouped <span class="op">=</span> df_filtered.groupby(cell_type_level).agg(mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>)).reset_index()</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by mean distance to get top and bottom cell types</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    df_sorted <span class="op">=</span> df_grouped.sort_values(by<span class="op">=</span><span class="st">'mean_distance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get top N and bottom N cell types</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    top_cell_types <span class="op">=</span> df_sorted.head(top_n)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    bottom_cell_types <span class="op">=</span> df_sorted.tail(top_n)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> top_cell_types, bottom_cell_types</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_mean(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in LN00560:
  Level One Cell Type  mean_distance
1    mesenchymal cell      88.029798
0         immune cell      86.230167

Bottom 5 cell types in LN00560:
  Level One Cell Type  mean_distance
1    mesenchymal cell      88.029798
0         immune cell      86.230167

Top 5 cell types in LN00837:
  Level One Cell Type  mean_distance
0         immune cell      65.658556
1    mesenchymal cell      64.156297

Bottom 5 cell types in LN00837:
  Level One Cell Type  mean_distance
0         immune cell      65.658556
1    mesenchymal cell      64.156297

Top 5 cell types in LN22921:
  Level One Cell Type  mean_distance
0         immune cell      69.098860
1    mesenchymal cell      42.860136

Bottom 5 cell types in LN22921:
  Level One Cell Type  mean_distance
0         immune cell      69.098860
1    mesenchymal cell      42.860136

Top 5 cell types in LN24336:
  Level One Cell Type  mean_distance
0         immune cell      62.325526
1    mesenchymal cell      45.284939

Bottom 5 cell types in LN24336:
  Level One Cell Type  mean_distance
0         immune cell      62.325526
1    mesenchymal cell      45.284939

Top 5 cell types in LN27766:
  Level One Cell Type  mean_distance
1    mesenchymal cell      63.171914
0         immune cell      48.323776

Bottom 5 cell types in LN27766:
  Level One Cell Type  mean_distance
1    mesenchymal cell      63.171914
0         immune cell      48.323776</code></pre>
</div>
</div>
<div id="cell-32" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top five and bottom five cell types with respect to median distance in each unique region separately.</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_top_bottom_cell_types_by_median(df, cell_type_level, unique_region, top_n<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the DataFrame for the specified unique region and cell type level</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    df_filtered <span class="op">=</span> df[df[<span class="st">'Unique Region'</span>] <span class="op">==</span> unique_region]</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by the specified cell type level and calculate median distance</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    df_grouped <span class="op">=</span> df_filtered.groupby(cell_type_level).agg(median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>)).reset_index()</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by median distance to get top and bottom cell types</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    df_sorted <span class="op">=</span> df_grouped.sort_values(by<span class="op">=</span><span class="st">'median_distance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get top N and bottom N cell types</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    top_cell_types <span class="op">=</span> df_sorted.head(top_n)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    bottom_cell_types <span class="op">=</span> df_sorted.tail(top_n)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> top_cell_types, bottom_cell_types</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_median(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in LN00560:
  Level One Cell Type  median_distance
1    mesenchymal cell        81.864293
0         immune cell        78.283379

Bottom 5 cell types in LN00560:
  Level One Cell Type  median_distance
1    mesenchymal cell        81.864293
0         immune cell        78.283379

Top 5 cell types in LN00837:
  Level One Cell Type  median_distance
0         immune cell        55.426203
1    mesenchymal cell        47.402660

Bottom 5 cell types in LN00837:
  Level One Cell Type  median_distance
0         immune cell        55.426203
1    mesenchymal cell        47.402660

Top 5 cell types in LN22921:
  Level One Cell Type  median_distance
0         immune cell        58.969275
1    mesenchymal cell        30.269759

Bottom 5 cell types in LN22921:
  Level One Cell Type  median_distance
0         immune cell        58.969275
1    mesenchymal cell        30.269759

Top 5 cell types in LN24336:
  Level One Cell Type  median_distance
0         immune cell        51.657698
1    mesenchymal cell        34.253833

Bottom 5 cell types in LN24336:
  Level One Cell Type  median_distance
0         immune cell        51.657698
1    mesenchymal cell        34.253833

Top 5 cell types in LN27766:
  Level One Cell Type  median_distance
1    mesenchymal cell        49.198156
0         immune cell        37.625713

Bottom 5 cell types in LN27766:
  Level One Cell Type  median_distance
1    mesenchymal cell        49.198156
0         immune cell        37.625713</code></pre>
</div>
</div>
<div id="cell-33" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate regional variability</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_regional_variability(df_all_edges_with_cell_type_level, cell_type_level):</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""    Calculate regional variability for distances in the given DataFrame.</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    regional_variability <span class="op">=</span> df_all_edges_with_cell_type_level.groupby(<span class="st">'Unique Region'</span>)[<span class="st">'Distance'</span>].agg([</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'mean'</span>, <span class="st">'mean'</span>),</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'std'</span>, <span class="st">'std'</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    ]).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add CV as percentage</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    regional_variability[<span class="st">'CV (%)'</span>] <span class="op">=</span> (regional_variability[<span class="st">'std'</span>] <span class="op">/</span> regional_variability[<span class="st">'mean'</span>] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Regional Variability Analysis:"</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Mean: Average distance in each region"</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Std: Standard deviation of distances"</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"CV: Coefficient of Variation (std/mean * 100%)"</span>)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(regional_variability)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate variability for each cell type</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    cell_type_variability <span class="op">=</span> df_all_edges_with_cell_type_level.groupby(cell_type_level)[<span class="st">'Distance'</span>].agg([</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'mean'</span>, <span class="st">'mean'</span>),</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'std'</span>, <span class="st">'std'</span>)</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    ]).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add CV as percentage</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    cell_type_variability[<span class="st">'CV (%)'</span>] <span class="op">=</span> (cell_type_variability[<span class="st">'std'</span>] <span class="op">/</span> cell_type_variability[<span class="st">'mean'</span>] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Cell Type Variability Analysis (sorted by CV):"</span>)</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(cell_type_variability.sort_values(<span class="st">'CV (%)'</span>, ascending<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>calculate_regional_variability(df_all_edges_with_cell_type_level, cell_type_level)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regional Variability Analysis:
Mean: Average distance in each region
Std: Standard deviation of distances
CV: Coefficient of Variation (std/mean * 100%)
                mean    std  CV (%)
Unique Region                      
LN00560        86.25  50.97    59.1
LN00837        65.65  42.86    65.3
LN22921        69.03  43.55    63.1
LN24336        62.29  41.07    65.9
LN27766        48.66  35.83    73.6

Cell Type Variability Analysis (sorted by CV):
                      mean    std  CV (%)
Level One Cell Type                      
mesenchymal cell     65.39  48.18    73.7
immune cell          67.80  44.76    66.0</code></pre>
</div>
</div>
<div id="cell-34" class="cell" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the standard region sequence for plots (Get all unique values in Unique Region column as a list.)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>regions <span class="op">=</span> df_all_edges_with_cell_types[<span class="st">'Unique Region'</span>].unique().tolist()</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Regions in the data:"</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(regions)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regions in the data:
['LN00560', 'LN00837', 'LN22921', 'LN24336', 'LN27766']</code></pre>
</div>
</div>
<div id="cell-35" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate Violin Plot</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_violin_cells_per_celltype(df_all_edges_with_cell_type_level, cell_type_level, output_dir, density_norm<span class="op">=</span><span class="st">'area'</span>):</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    sns.set_context(<span class="st">"notebook"</span>, rc<span class="op">=</span>{<span class="st">"grid.linewidth"</span>: <span class="dv">2</span>})</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    sns.violinplot(data<span class="op">=</span>df_all_edges_with_cell_type_level, x<span class="op">=</span>cell_type_level, y<span class="op">=</span><span class="st">"Distance"</span>, density_norm<span class="op">=</span>density_norm, common_norm<span class="op">=</span><span class="va">True</span>, cut<span class="op">=</span><span class="dv">0</span>, inner<span class="op">=</span><span class="st">"box"</span>, split<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span><span class="st">'Spectral'</span>, alpha<span class="op">=</span><span class="fl">.9</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    sns.set_theme(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    sns.set_context(<span class="st">"paper"</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    font_size <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    plt.legend(fontsize<span class="op">=</span>font_size)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Violin Plot of distances by </span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss"> (Density Normalization: </span><span class="sc">{</span>density_norm<span class="sc">}</span><span class="ss">)'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="ss">f'</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Distance (</span><span class="ch">\u03bc</span><span class="st">m)'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Increase font size for all text in the figure</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span>font_size)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span>font_size)</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_violin_cells_per_celltype_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>                bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>                pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_violin_cells_per_celltype_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>                bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>                pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>plot_violin_cells_per_celltype(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">'area'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="11_distance_analysis__lymphnode-codex-yale_files/figure-html/cell-29-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-36" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplots of distribution of distances by cell type and region.</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_distance_distribution_boxplots_by_region(df_all_edges_with_cell_type_level, cell_type_level, output_dir):</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">8</span>))</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create categorical type with only the regions that exist in the data</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    available_regions <span class="op">=</span> [r <span class="cf">for</span> r <span class="kw">in</span> regions <span class="cf">if</span> r <span class="kw">in</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()]</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>] <span class="op">=</span> pd.Categorical(</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>],</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>        categories<span class="op">=</span>available_regions,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>        ordered<span class="op">=</span><span class="va">True</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make box plot.</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(data<span class="op">=</span>df_all_edges_with_cell_type_level, x<span class="op">=</span>cell_type_level, y<span class="op">=</span><span class="st">'Distance'</span>, hue<span class="op">=</span><span class="st">'Unique Region'</span>, showfliers<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span><span class="st">'Spectral'</span>) <span class="co"># viridis or Spectral palette for better color distinction</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    font_size <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>, ha<span class="op">=</span><span class="st">'right'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span>font_size)</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Distribution of distances by </span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss"> and region'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="ss">f'</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Distance (</span><span class="ch">\u03bc</span><span class="st">m)'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_distance_distribution_boxplots_by_region_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_distance_distribution_boxplots_by_region_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_boxplots_by_region(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="11_distance_analysis__lymphnode-codex-yale_files/figure-html/cell-30-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-37" class="cell" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplots of distribution of distances by cell type and region.</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_distance_distribution_heatmap(df_all_edges_with_cell_type_level, cell_type_level, output_dir):</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    pivot_data <span class="op">=</span> df_all_edges_with_cell_type_level.pivot_table(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">'Distance'</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>cell_type_level,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">'Unique Region'</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    aggfunc<span class="op">=</span><span class="st">'median'</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(pivot_data, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.1f'</span>, cmap<span class="op">=</span><span class="st">'Spectral'</span>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Heatmap of median distances by </span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    font_size <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>, ha<span class="op">=</span><span class="st">'right'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span>font_size)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Unique Region'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="ss">f'</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_distance_distribution_heatmap_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_distance_distribution_heatmap_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_heatmap(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="11_distance_analysis__lymphnode-codex-yale_files/figure-html/cell-31-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-38" class="cell" data-execution_count="31">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate Violin Plot per unique region.</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_violin_plots_all_regions(df_all_edges_with_cell_type_level, cell_type_level, output_dir, density_norm<span class="op">=</span><span class="st">"area"</span>):</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    sns.set_context(<span class="st">"notebook"</span>, rc<span class="op">=</span>{<span class="st">"grid.linewidth"</span>: <span class="dv">1</span>})</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    font_size <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    fig, axs <span class="op">=</span> plt.subplots(<span class="dv">5</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">20</span>)) <span class="co"># Adjusted figsize for horizontal layout</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(<span class="ss">f'Distance distribution per </span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss"> in `</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">` (density normalization = </span><span class="sc">{</span>density_norm<span class="sc">}</span><span class="ss">)'</span>, fontsize<span class="op">=</span>font_size, y<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep the sequence of Cell Types consistent across plots.</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    cell_types <span class="op">=</span> <span class="bu">sorted</span>(df_all_edges_with_cell_type_level[cell_type_level].unique())</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a color palette based on the number of unique classes</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    color_palette <span class="op">=</span> sns.color_palette(<span class="st">"Spectral"</span>, n_colors<span class="op">=</span><span class="bu">len</span>(cell_types))</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a dictionary mapping class to color</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    class_color_dict <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(cell_types, color_palette))</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, region <span class="kw">in</span> <span class="bu">enumerate</span>(regions):</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>        data_reg <span class="op">=</span> df_all_edges_with_cell_type_level[df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>] <span class="op">==</span> region]</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>        sns.violinplot(data<span class="op">=</span>data_reg, x<span class="op">=</span>cell_type_level, y<span class="op">=</span><span class="st">"Distance"</span>, density_norm<span class="op">=</span>density_norm, common_norm<span class="op">=</span><span class="va">True</span>, cut<span class="op">=</span><span class="dv">0</span>, inner<span class="op">=</span><span class="st">"box"</span>, split<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span>class_color_dict, alpha<span class="op">=</span><span class="fl">.9</span>, ax<span class="op">=</span>axs[i], hue<span class="op">=</span>cell_type_level, legend<span class="op">=</span><span class="va">False</span>, order<span class="op">=</span>cell_types, fill<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>        axs[i].set_title(region, fontsize<span class="op">=</span>font_size)</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>        axs[i].set_xlabel(<span class="st">''</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>        axs[i].set_ylabel(<span class="st">'Distance (</span><span class="ch">\u03bc</span><span class="st">m)'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axs[i].tick_params(axis='x', labelrotation=90, labelsize=font_size)</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># only show xtick labels for the last subplot</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(regions) <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>            axs[i].set_xticklabels([])</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>            axs[i].set_xticklabels(cell_types, fontsize<span class="op">=</span>font_size, rotation<span class="op">=</span><span class="dv">90</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axs[i].set_ylim(0, data_reg['Distance'].max() * 1.1)  # Set y-limits to be consistent across all plots</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>        axs[i].tick_params(axis<span class="op">=</span><span class="st">'both'</span>, labelsize<span class="op">=</span>font_size)</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use fig.text for precise label positioning</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    fig.figure.text(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.02</span>, <span class="ss">f'</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_violin_plots_all_regions_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_violin_plots_all_regions_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>plot_violin_plots_all_regions(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">"count"</span>) <span class="co"># density_norm="count" or "area" can be used based on preference.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="11_distance_analysis__lymphnode-codex-yale_files/figure-html/cell-32-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="level-two-cell-type-analysis" class="level3">
<h3 class="anchored" data-anchor-id="level-two-cell-type-analysis">Level Two Cell Type Analysis</h3>
<div id="cell-40" class="cell" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get mean, median, minimum, maximum distance per cell type in all unique regions.</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>cell_type_level <span class="op">=</span> <span class="st">'Level Two Cell Type'</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_type_level <span class="op">=</span> df_all_edges_with_cell_types[(df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type Level'</span>] <span class="op">==</span> cell_type_level) <span class="op">&amp;</span> (df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type'</span>] <span class="op">==</span> anchor_cell_type_dict[cell_type_level])]</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level <span class="op">=</span> df_all_edges_with_cell_type_level.groupby([cell_type_level, <span class="st">'Unique Region'</span>]).agg(</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>),</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>),</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    min_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'min'</span>),</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    max_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'max'</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">mean_distance</th>
<th data-quarto-table-cell-role="th">median_distance</th>
<th data-quarto-table-cell-role="th">min_distance</th>
<th data-quarto-table-cell-role="th">max_distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>b cell</td>
<td>LN00560</td>
<td>88.672883</td>
<td>81.031234</td>
<td>4.875021</td>
<td>199.999931</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>b cell</td>
<td>LN00837</td>
<td>71.823837</td>
<td>61.529348</td>
<td>6.638355</td>
<td>199.990502</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>b cell</td>
<td>LN22921</td>
<td>82.039046</td>
<td>72.283854</td>
<td>4.797734</td>
<td>199.999849</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>b cell</td>
<td>LN24336</td>
<td>64.496210</td>
<td>53.491989</td>
<td>5.385425</td>
<td>199.999276</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>b cell</td>
<td>LN27766</td>
<td>58.734683</td>
<td>45.181006</td>
<td>6.945505</td>
<td>199.999790</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>dendritic cell</td>
<td>LN00560</td>
<td>69.328460</td>
<td>57.716266</td>
<td>6.239511</td>
<td>199.990815</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>dendritic cell</td>
<td>LN00837</td>
<td>56.462073</td>
<td>48.013498</td>
<td>6.578968</td>
<td>199.972438</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>dendritic cell</td>
<td>LN22921</td>
<td>73.651623</td>
<td>60.772678</td>
<td>7.006536</td>
<td>199.967413</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>dendritic cell</td>
<td>LN24336</td>
<td>59.716750</td>
<td>50.896772</td>
<td>7.264940</td>
<td>199.995753</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>dendritic cell</td>
<td>LN27766</td>
<td>40.751088</td>
<td>31.531565</td>
<td>7.060869</td>
<td>199.936083</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>lymphoid cell</td>
<td>LN00560</td>
<td>87.916868</td>
<td>81.987260</td>
<td>6.472932</td>
<td>199.985560</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>lymphoid cell</td>
<td>LN00837</td>
<td>47.074148</td>
<td>39.426220</td>
<td>6.102839</td>
<td>199.566202</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>lymphoid cell</td>
<td>LN22921</td>
<td>66.159509</td>
<td>52.261744</td>
<td>5.680996</td>
<td>199.945578</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>lymphoid cell</td>
<td>LN24336</td>
<td>71.342591</td>
<td>58.007388</td>
<td>6.837350</td>
<td>199.999774</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>lymphoid cell</td>
<td>LN27766</td>
<td>52.863464</td>
<td>34.486844</td>
<td>6.130197</td>
<td>199.989882</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>macrophage</td>
<td>LN00560</td>
<td>78.607505</td>
<td>68.799241</td>
<td>7.336973</td>
<td>199.994850</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>macrophage</td>
<td>LN00837</td>
<td>56.992624</td>
<td>50.840886</td>
<td>9.008524</td>
<td>199.753164</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>macrophage</td>
<td>LN22921</td>
<td>54.901756</td>
<td>47.901377</td>
<td>6.583548</td>
<td>199.929894</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>macrophage</td>
<td>LN24336</td>
<td>79.116158</td>
<td>67.811076</td>
<td>7.957836</td>
<td>199.937893</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>macrophage</td>
<td>LN27766</td>
<td>51.519747</td>
<td>48.035642</td>
<td>7.765481</td>
<td>197.595104</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>mast cell</td>
<td>LN00560</td>
<td>99.372310</td>
<td>96.167629</td>
<td>10.595659</td>
<td>199.849460</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>mast cell</td>
<td>LN00837</td>
<td>65.670488</td>
<td>55.672843</td>
<td>10.448412</td>
<td>197.309722</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>mast cell</td>
<td>LN22921</td>
<td>52.593234</td>
<td>44.533122</td>
<td>5.595661</td>
<td>198.746019</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>mast cell</td>
<td>LN24336</td>
<td>85.567104</td>
<td>74.870233</td>
<td>9.498461</td>
<td>199.956401</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">24</th>
<td>mast cell</td>
<td>LN27766</td>
<td>43.276579</td>
<td>33.640270</td>
<td>8.008464</td>
<td>199.891157</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">25</th>
<td>monocyte</td>
<td>LN00560</td>
<td>89.144747</td>
<td>82.996331</td>
<td>7.532715</td>
<td>199.991027</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">26</th>
<td>monocyte</td>
<td>LN00837</td>
<td>55.526799</td>
<td>45.104939</td>
<td>8.037716</td>
<td>199.980528</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">27</th>
<td>monocyte</td>
<td>LN22921</td>
<td>50.021763</td>
<td>40.595156</td>
<td>5.302953</td>
<td>199.957450</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">28</th>
<td>monocyte</td>
<td>LN24336</td>
<td>60.846991</td>
<td>44.274679</td>
<td>7.100671</td>
<td>199.964176</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">29</th>
<td>monocyte</td>
<td>LN27766</td>
<td>49.144810</td>
<td>45.352857</td>
<td>7.274465</td>
<td>199.927731</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">30</th>
<td>muscle cell</td>
<td>LN00560</td>
<td>86.522830</td>
<td>80.072416</td>
<td>7.366499</td>
<td>199.827904</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">31</th>
<td>muscle cell</td>
<td>LN00837</td>
<td>59.032529</td>
<td>44.506487</td>
<td>9.537860</td>
<td>196.964611</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">32</th>
<td>muscle cell</td>
<td>LN22921</td>
<td>39.150671</td>
<td>28.447433</td>
<td>6.260871</td>
<td>199.593551</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">33</th>
<td>muscle cell</td>
<td>LN24336</td>
<td>43.536294</td>
<td>30.191094</td>
<td>7.974461</td>
<td>199.351793</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">34</th>
<td>muscle cell</td>
<td>LN27766</td>
<td>62.912204</td>
<td>48.334648</td>
<td>6.110041</td>
<td>199.979704</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">35</th>
<td>natural killer cell</td>
<td>LN00560</td>
<td>86.771851</td>
<td>79.778126</td>
<td>6.896002</td>
<td>199.981161</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">36</th>
<td>natural killer cell</td>
<td>LN00837</td>
<td>57.099449</td>
<td>50.561814</td>
<td>7.570372</td>
<td>199.852375</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">37</th>
<td>natural killer cell</td>
<td>LN22921</td>
<td>57.361924</td>
<td>51.657575</td>
<td>6.314864</td>
<td>199.963468</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">38</th>
<td>natural killer cell</td>
<td>LN24336</td>
<td>85.475053</td>
<td>75.480916</td>
<td>6.704395</td>
<td>199.995869</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">39</th>
<td>natural killer cell</td>
<td>LN27766</td>
<td>35.518688</td>
<td>30.995884</td>
<td>5.664908</td>
<td>199.029670</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">40</th>
<td>t cell</td>
<td>LN00560</td>
<td>86.289131</td>
<td>78.881215</td>
<td>5.603447</td>
<td>199.999549</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">41</th>
<td>t cell</td>
<td>LN00837</td>
<td>64.029926</td>
<td>54.434361</td>
<td>6.556713</td>
<td>199.971033</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">42</th>
<td>t cell</td>
<td>LN22921</td>
<td>60.493650</td>
<td>53.470688</td>
<td>5.481371</td>
<td>199.996959</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">43</th>
<td>t cell</td>
<td>LN24336</td>
<td>56.612429</td>
<td>47.942598</td>
<td>4.235994</td>
<td>199.997767</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">44</th>
<td>t cell</td>
<td>LN27766</td>
<td>40.031514</td>
<td>32.772272</td>
<td>5.864464</td>
<td>199.874886</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-41" class="cell" data-execution_count="33">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_mean(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in LN00560:
   Level Two Cell Type  mean_distance
4            mast cell      99.372310
5             monocyte      89.144747
0               b cell      88.672883
2        lymphoid cell      87.916868
7  natural killer cell      86.771851

Bottom 5 cell types in LN00560:
   Level Two Cell Type  mean_distance
7  natural killer cell      86.771851
6          muscle cell      86.522830
8               t cell      86.289131
3           macrophage      78.607505
1       dendritic cell      69.328460

Top 5 cell types in LN00837:
   Level Two Cell Type  mean_distance
0               b cell      71.823837
4            mast cell      65.670488
8               t cell      64.029926
6          muscle cell      59.032529
7  natural killer cell      57.099449

Bottom 5 cell types in LN00837:
   Level Two Cell Type  mean_distance
7  natural killer cell      57.099449
3           macrophage      56.992624
1       dendritic cell      56.462073
5             monocyte      55.526799
2        lymphoid cell      47.074148

Top 5 cell types in LN22921:
   Level Two Cell Type  mean_distance
0               b cell      82.039046
1       dendritic cell      73.651623
2        lymphoid cell      66.159509
8               t cell      60.493650
7  natural killer cell      57.361924

Bottom 5 cell types in LN22921:
   Level Two Cell Type  mean_distance
7  natural killer cell      57.361924
3           macrophage      54.901756
4            mast cell      52.593234
5             monocyte      50.021763
6          muscle cell      39.150671

Top 5 cell types in LN24336:
   Level Two Cell Type  mean_distance
4            mast cell      85.567104
7  natural killer cell      85.475053
3           macrophage      79.116158
2        lymphoid cell      71.342591
0               b cell      64.496210

Bottom 5 cell types in LN24336:
  Level Two Cell Type  mean_distance
0              b cell      64.496210
5            monocyte      60.846991
1      dendritic cell      59.716750
8              t cell      56.612429
6         muscle cell      43.536294

Top 5 cell types in LN27766:
  Level Two Cell Type  mean_distance
6         muscle cell      62.912204
0              b cell      58.734683
2       lymphoid cell      52.863464
3          macrophage      51.519747
5            monocyte      49.144810

Bottom 5 cell types in LN27766:
   Level Two Cell Type  mean_distance
5             monocyte      49.144810
4            mast cell      43.276579
1       dendritic cell      40.751088
8               t cell      40.031514
7  natural killer cell      35.518688</code></pre>
</div>
</div>
<div id="cell-42" class="cell" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_median(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in LN00560:
  Level Two Cell Type  median_distance
4           mast cell        96.167629
5            monocyte        82.996331
2       lymphoid cell        81.987260
0              b cell        81.031234
6         muscle cell        80.072416

Bottom 5 cell types in LN00560:
   Level Two Cell Type  median_distance
6          muscle cell        80.072416
7  natural killer cell        79.778126
8               t cell        78.881215
3           macrophage        68.799241
1       dendritic cell        57.716266

Top 5 cell types in LN00837:
   Level Two Cell Type  median_distance
0               b cell        61.529348
4            mast cell        55.672843
8               t cell        54.434361
3           macrophage        50.840886
7  natural killer cell        50.561814

Bottom 5 cell types in LN00837:
   Level Two Cell Type  median_distance
7  natural killer cell        50.561814
1       dendritic cell        48.013498
5             monocyte        45.104939
6          muscle cell        44.506487
2        lymphoid cell        39.426220

Top 5 cell types in LN22921:
   Level Two Cell Type  median_distance
0               b cell        72.283854
1       dendritic cell        60.772678
8               t cell        53.470688
2        lymphoid cell        52.261744
7  natural killer cell        51.657575

Bottom 5 cell types in LN22921:
   Level Two Cell Type  median_distance
7  natural killer cell        51.657575
3           macrophage        47.901377
4            mast cell        44.533122
5             monocyte        40.595156
6          muscle cell        28.447433

Top 5 cell types in LN24336:
   Level Two Cell Type  median_distance
7  natural killer cell        75.480916
4            mast cell        74.870233
3           macrophage        67.811076
2        lymphoid cell        58.007388
0               b cell        53.491989

Bottom 5 cell types in LN24336:
  Level Two Cell Type  median_distance
0              b cell        53.491989
1      dendritic cell        50.896772
8              t cell        47.942598
5            monocyte        44.274679
6         muscle cell        30.191094

Top 5 cell types in LN27766:
  Level Two Cell Type  median_distance
6         muscle cell        48.334648
3          macrophage        48.035642
5            monocyte        45.352857
0              b cell        45.181006
2       lymphoid cell        34.486844

Bottom 5 cell types in LN27766:
   Level Two Cell Type  median_distance
2        lymphoid cell        34.486844
4            mast cell        33.640270
8               t cell        32.772272
1       dendritic cell        31.531565
7  natural killer cell        30.995884</code></pre>
</div>
</div>
<div id="cell-43" class="cell" data-execution_count="35">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>calculate_regional_variability(df_all_edges_with_cell_type_level, cell_type_level)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regional Variability Analysis:
Mean: Average distance in each region
Std: Standard deviation of distances
CV: Coefficient of Variation (std/mean * 100%)
                mean    std  CV (%)
Unique Region                      
LN00560        86.25  50.97    59.1
LN00837        65.65  42.86    65.3
LN22921        69.03  43.55    63.1
LN24336        62.29  41.07    65.9
LN27766        48.66  35.83    73.6

Cell Type Variability Analysis (sorted by CV):
                      mean    std  CV (%)
Level Two Cell Type                      
muscle cell          65.17  48.20    74.0
mast cell            54.53  40.09    73.5
lymphoid cell        69.90  50.05    71.6
monocyte             57.09  39.95    70.0
dendritic cell       62.58  43.15    69.0
t cell               62.64  40.69    65.0
b cell               74.12  47.83    64.5
natural killer cell  60.56  38.98    64.4
macrophage           60.91  38.83    63.7</code></pre>
</div>
</div>
<div id="cell-44" class="cell" data-execution_count="36">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>plot_violin_cells_per_celltype(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">'area'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="11_distance_analysis__lymphnode-codex-yale_files/figure-html/cell-37-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-45" class="cell" data-execution_count="37">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_boxplots_by_region(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="11_distance_analysis__lymphnode-codex-yale_files/figure-html/cell-38-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-46" class="cell" data-execution_count="38">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_heatmap(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="11_distance_analysis__lymphnode-codex-yale_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-47" class="cell" data-execution_count="39">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>plot_violin_plots_all_regions(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">"count"</span>) <span class="co"># Or, density_norm="count" or "area" based on preference.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="11_distance_analysis__lymphnode-codex-yale_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="level-three-cell-type-analysis" class="level3">
<h3 class="anchored" data-anchor-id="level-three-cell-type-analysis">Level Three Cell Type Analysis</h3>
<div id="cell-49" class="cell" data-execution_count="40">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get mean, median, minimum, maximum distance per cell type in all unique regions.</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>cell_type_level <span class="op">=</span> <span class="st">'Level Three Cell Type'</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_type_level <span class="op">=</span> df_all_edges_with_cell_types[(df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type Level'</span>] <span class="op">==</span> cell_type_level) <span class="op">&amp;</span> (df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type'</span>] <span class="op">==</span> anchor_cell_type_dict[cell_type_level])]</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level <span class="op">=</span> df_all_edges_with_cell_type_level.groupby([cell_type_level, <span class="st">'Unique Region'</span>]).agg(</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>),</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>),</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    min_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'min'</span>),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    max_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'max'</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">mean_distance</th>
<th data-quarto-table-cell-role="th">median_distance</th>
<th data-quarto-table-cell-role="th">min_distance</th>
<th data-quarto-table-cell-role="th">max_distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>b cell:activated</td>
<td>LN00560</td>
<td>89.268466</td>
<td>82.035282</td>
<td>8.847019</td>
<td>199.985969</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>b cell:activated</td>
<td>LN00837</td>
<td>103.892159</td>
<td>103.148832</td>
<td>10.202282</td>
<td>199.981139</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>b cell:activated</td>
<td>LN22921</td>
<td>109.313037</td>
<td>109.134587</td>
<td>8.085613</td>
<td>199.973049</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>b cell:activated</td>
<td>LN24336</td>
<td>78.439047</td>
<td>66.929947</td>
<td>7.599001</td>
<td>199.996026</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>b cell:activated</td>
<td>LN27766</td>
<td>78.187423</td>
<td>70.452448</td>
<td>8.815551</td>
<td>199.923293</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>b cell:germinal center</td>
<td>LN00560</td>
<td>110.025798</td>
<td>109.326467</td>
<td>8.953891</td>
<td>199.992071</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>b cell:germinal center</td>
<td>LN00837</td>
<td>78.530974</td>
<td>70.589407</td>
<td>6.764925</td>
<td>199.948612</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>b cell:germinal center</td>
<td>LN22921</td>
<td>126.062410</td>
<td>132.087548</td>
<td>8.704566</td>
<td>199.997308</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>b cell:germinal center</td>
<td>LN24336</td>
<td>55.226407</td>
<td>46.745157</td>
<td>6.177177</td>
<td>199.984885</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>b cell:germinal center</td>
<td>LN27766</td>
<td>38.146639</td>
<td>31.915673</td>
<td>6.971266</td>
<td>199.976434</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>b cell:germinal center pre-plasmablast</td>
<td>LN00560</td>
<td>108.711157</td>
<td>108.905779</td>
<td>10.916243</td>
<td>199.885291</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>b cell:germinal center pre-plasmablast</td>
<td>LN00837</td>
<td>83.001064</td>
<td>73.750379</td>
<td>10.423996</td>
<td>198.874785</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>b cell:germinal center pre-plasmablast</td>
<td>LN22921</td>
<td>124.921662</td>
<td>129.269694</td>
<td>21.259508</td>
<td>199.839116</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>b cell:germinal center pre-plasmablast</td>
<td>LN24336</td>
<td>49.903464</td>
<td>44.611971</td>
<td>9.241914</td>
<td>199.310578</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>b cell:germinal center pre-plasmablast</td>
<td>LN27766</td>
<td>35.862025</td>
<td>30.864602</td>
<td>9.355446</td>
<td>185.874318</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>b cell:interferon</td>
<td>LN00560</td>
<td>102.444714</td>
<td>99.240528</td>
<td>12.591493</td>
<td>199.567126</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>b cell:interferon</td>
<td>LN00837</td>
<td>114.785742</td>
<td>112.568316</td>
<td>11.572951</td>
<td>199.377967</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>b cell:interferon</td>
<td>LN22921</td>
<td>131.162456</td>
<td>139.595461</td>
<td>10.238354</td>
<td>199.992291</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>b cell:interferon</td>
<td>LN24336</td>
<td>110.398002</td>
<td>112.429843</td>
<td>9.327697</td>
<td>199.967757</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>b cell:interferon</td>
<td>LN27766</td>
<td>105.614725</td>
<td>104.382767</td>
<td>10.816878</td>
<td>197.792760</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>b cell:memory</td>
<td>LN00560</td>
<td>102.444467</td>
<td>100.377290</td>
<td>4.875021</td>
<td>199.999560</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>b cell:memory</td>
<td>LN00837</td>
<td>78.391621</td>
<td>70.584824</td>
<td>6.930883</td>
<td>199.990502</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>b cell:memory</td>
<td>LN22921</td>
<td>79.602200</td>
<td>69.989911</td>
<td>4.797734</td>
<td>199.999849</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>b cell:memory</td>
<td>LN24336</td>
<td>80.076569</td>
<td>70.279767</td>
<td>5.385425</td>
<td>199.999276</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">24</th>
<td>b cell:memory</td>
<td>LN27766</td>
<td>63.402763</td>
<td>51.599412</td>
<td>7.332202</td>
<td>199.999790</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">25</th>
<td>b cell:naive</td>
<td>LN00560</td>
<td>69.258328</td>
<td>54.441120</td>
<td>6.145788</td>
<td>199.999931</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">26</th>
<td>b cell:naive</td>
<td>LN00837</td>
<td>76.218061</td>
<td>67.309817</td>
<td>8.581020</td>
<td>199.947632</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">27</th>
<td>b cell:naive</td>
<td>LN22921</td>
<td>92.860766</td>
<td>88.747737</td>
<td>7.604196</td>
<td>199.990872</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">28</th>
<td>b cell:naive</td>
<td>LN24336</td>
<td>59.469003</td>
<td>50.735010</td>
<td>6.191827</td>
<td>199.997376</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">29</th>
<td>b cell:naive</td>
<td>LN27766</td>
<td>75.836945</td>
<td>66.107927</td>
<td>8.170217</td>
<td>199.982514</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">30</th>
<td>b cell:pre-germinal center</td>
<td>LN00560</td>
<td>125.145570</td>
<td>131.985475</td>
<td>10.090936</td>
<td>199.946647</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">31</th>
<td>b cell:pre-germinal center</td>
<td>LN00837</td>
<td>91.106536</td>
<td>86.702315</td>
<td>11.493943</td>
<td>199.388265</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">32</th>
<td>b cell:pre-germinal center</td>
<td>LN22921</td>
<td>132.997491</td>
<td>140.357258</td>
<td>9.438865</td>
<td>199.996039</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">33</th>
<td>b cell:pre-germinal center</td>
<td>LN24336</td>
<td>105.067771</td>
<td>103.209786</td>
<td>9.577587</td>
<td>199.794374</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">34</th>
<td>b cell:pre-germinal center</td>
<td>LN27766</td>
<td>106.766845</td>
<td>109.227324</td>
<td>10.393205</td>
<td>199.091629</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">35</th>
<td>b cell:proliferating</td>
<td>LN00560</td>
<td>74.076170</td>
<td>61.983066</td>
<td>6.553306</td>
<td>199.999329</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">36</th>
<td>b cell:proliferating</td>
<td>LN00837</td>
<td>51.889082</td>
<td>42.257876</td>
<td>6.638355</td>
<td>199.729762</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">37</th>
<td>b cell:proliferating</td>
<td>LN22921</td>
<td>85.020031</td>
<td>73.684262</td>
<td>5.545646</td>
<td>199.994709</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">38</th>
<td>b cell:proliferating</td>
<td>LN24336</td>
<td>51.541644</td>
<td>44.761244</td>
<td>6.192560</td>
<td>199.986801</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">39</th>
<td>b cell:proliferating</td>
<td>LN27766</td>
<td>37.535815</td>
<td>31.282443</td>
<td>6.945505</td>
<td>199.958507</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">40</th>
<td>dendritic cell:conventional 1</td>
<td>LN00560</td>
<td>74.747687</td>
<td>65.742189</td>
<td>8.728357</td>
<td>199.915652</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">41</th>
<td>dendritic cell:conventional 1</td>
<td>LN00837</td>
<td>56.373332</td>
<td>49.048383</td>
<td>10.157812</td>
<td>195.342718</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">42</th>
<td>dendritic cell:conventional 1</td>
<td>LN22921</td>
<td>54.710012</td>
<td>47.481574</td>
<td>7.840607</td>
<td>199.269117</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">43</th>
<td>dendritic cell:conventional 1</td>
<td>LN24336</td>
<td>120.905504</td>
<td>124.830580</td>
<td>9.217633</td>
<td>199.995753</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">44</th>
<td>dendritic cell:conventional 1</td>
<td>LN27766</td>
<td>38.420549</td>
<td>34.650392</td>
<td>9.251431</td>
<td>198.827691</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">45</th>
<td>dendritic cell:conventional 2</td>
<td>LN00560</td>
<td>68.057708</td>
<td>57.691652</td>
<td>7.978659</td>
<td>199.949543</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">46</th>
<td>dendritic cell:conventional 2</td>
<td>LN00837</td>
<td>54.012741</td>
<td>45.497958</td>
<td>6.952205</td>
<td>199.902788</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">47</th>
<td>dendritic cell:conventional 2</td>
<td>LN22921</td>
<td>48.714428</td>
<td>41.297008</td>
<td>7.880744</td>
<td>199.807328</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">48</th>
<td>dendritic cell:conventional 2</td>
<td>LN24336</td>
<td>129.199183</td>
<td>136.077984</td>
<td>8.925008</td>
<td>199.994250</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">49</th>
<td>dendritic cell:conventional 2</td>
<td>LN27766</td>
<td>50.585663</td>
<td>45.848785</td>
<td>9.638823</td>
<td>196.531393</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">50</th>
<td>dendritic cell:follicular</td>
<td>LN00560</td>
<td>90.484649</td>
<td>85.545859</td>
<td>6.239511</td>
<td>199.836667</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">51</th>
<td>dendritic cell:follicular</td>
<td>LN00837</td>
<td>68.051364</td>
<td>50.274675</td>
<td>9.376279</td>
<td>199.972438</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">52</th>
<td>dendritic cell:follicular</td>
<td>LN22921</td>
<td>46.702944</td>
<td>32.311309</td>
<td>7.006536</td>
<td>199.945312</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">53</th>
<td>dendritic cell:follicular</td>
<td>LN24336</td>
<td>46.933889</td>
<td>37.744882</td>
<td>8.222905</td>
<td>198.852000</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">54</th>
<td>dendritic cell:follicular</td>
<td>LN27766</td>
<td>63.576654</td>
<td>50.547417</td>
<td>7.463081</td>
<td>199.936083</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">55</th>
<td>dendritic cell:migratory</td>
<td>LN00560</td>
<td>74.874860</td>
<td>65.090342</td>
<td>8.664038</td>
<td>199.904567</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">56</th>
<td>dendritic cell:migratory</td>
<td>LN00837</td>
<td>67.620372</td>
<td>61.629700</td>
<td>10.996842</td>
<td>199.452052</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">57</th>
<td>dendritic cell:migratory</td>
<td>LN22921</td>
<td>63.298214</td>
<td>56.380191</td>
<td>10.370947</td>
<td>194.049890</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">58</th>
<td>dendritic cell:migratory</td>
<td>LN24336</td>
<td>120.640773</td>
<td>127.698045</td>
<td>9.189187</td>
<td>199.945018</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">59</th>
<td>dendritic cell:migratory</td>
<td>LN27766</td>
<td>43.524350</td>
<td>37.308495</td>
<td>10.455990</td>
<td>163.623264</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">60</th>
<td>dendritic cell:plasmacytoid</td>
<td>LN00560</td>
<td>65.255968</td>
<td>51.800420</td>
<td>6.239585</td>
<td>199.990815</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">61</th>
<td>dendritic cell:plasmacytoid</td>
<td>LN00837</td>
<td>54.379345</td>
<td>47.567074</td>
<td>6.578968</td>
<td>198.465924</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">62</th>
<td>dendritic cell:plasmacytoid</td>
<td>LN22921</td>
<td>98.059750</td>
<td>93.010721</td>
<td>8.675605</td>
<td>199.967413</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">63</th>
<td>dendritic cell:plasmacytoid</td>
<td>LN24336</td>
<td>53.708142</td>
<td>48.208903</td>
<td>7.264940</td>
<td>199.760738</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">64</th>
<td>dendritic cell:plasmacytoid</td>
<td>LN27766</td>
<td>31.272411</td>
<td>27.099603</td>
<td>7.060869</td>
<td>199.496027</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">65</th>
<td>lymphoid cell:innate</td>
<td>LN00560</td>
<td>87.916868</td>
<td>81.987260</td>
<td>6.472932</td>
<td>199.985560</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">66</th>
<td>lymphoid cell:innate</td>
<td>LN00837</td>
<td>47.074148</td>
<td>39.426220</td>
<td>6.102839</td>
<td>199.566202</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">67</th>
<td>lymphoid cell:innate</td>
<td>LN22921</td>
<td>66.159509</td>
<td>52.261744</td>
<td>5.680996</td>
<td>199.945578</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">68</th>
<td>lymphoid cell:innate</td>
<td>LN24336</td>
<td>71.342591</td>
<td>58.007388</td>
<td>6.837350</td>
<td>199.999774</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">69</th>
<td>lymphoid cell:innate</td>
<td>LN27766</td>
<td>52.863464</td>
<td>34.486844</td>
<td>6.130197</td>
<td>199.989882</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">70</th>
<td>macrophage</td>
<td>LN00560</td>
<td>78.607505</td>
<td>68.799241</td>
<td>7.336973</td>
<td>199.994850</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">71</th>
<td>macrophage</td>
<td>LN00837</td>
<td>56.992624</td>
<td>50.840886</td>
<td>9.008524</td>
<td>199.753164</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">72</th>
<td>macrophage</td>
<td>LN22921</td>
<td>54.901756</td>
<td>47.901377</td>
<td>6.583548</td>
<td>199.929894</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">73</th>
<td>macrophage</td>
<td>LN24336</td>
<td>79.116158</td>
<td>67.811076</td>
<td>7.957836</td>
<td>199.937893</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">74</th>
<td>macrophage</td>
<td>LN27766</td>
<td>51.519747</td>
<td>48.035642</td>
<td>7.765481</td>
<td>197.595104</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">75</th>
<td>mast cell</td>
<td>LN00560</td>
<td>99.372310</td>
<td>96.167629</td>
<td>10.595659</td>
<td>199.849460</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">76</th>
<td>mast cell</td>
<td>LN00837</td>
<td>65.670488</td>
<td>55.672843</td>
<td>10.448412</td>
<td>197.309722</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">77</th>
<td>mast cell</td>
<td>LN22921</td>
<td>52.593234</td>
<td>44.533122</td>
<td>5.595661</td>
<td>198.746019</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">78</th>
<td>mast cell</td>
<td>LN24336</td>
<td>85.567104</td>
<td>74.870233</td>
<td>9.498461</td>
<td>199.956401</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">79</th>
<td>mast cell</td>
<td>LN27766</td>
<td>43.276579</td>
<td>33.640270</td>
<td>8.008464</td>
<td>199.891157</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">80</th>
<td>monocyte</td>
<td>LN00560</td>
<td>89.144747</td>
<td>82.996331</td>
<td>7.532715</td>
<td>199.991027</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">81</th>
<td>monocyte</td>
<td>LN00837</td>
<td>55.526799</td>
<td>45.104939</td>
<td>8.037716</td>
<td>199.980528</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">82</th>
<td>monocyte</td>
<td>LN22921</td>
<td>50.021763</td>
<td>40.595156</td>
<td>5.302953</td>
<td>199.957450</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">83</th>
<td>monocyte</td>
<td>LN24336</td>
<td>60.846991</td>
<td>44.274679</td>
<td>7.100671</td>
<td>199.964176</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">84</th>
<td>monocyte</td>
<td>LN27766</td>
<td>49.144810</td>
<td>45.352857</td>
<td>7.274465</td>
<td>199.927731</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">85</th>
<td>muscle cell:smooth</td>
<td>LN00560</td>
<td>86.522830</td>
<td>80.072416</td>
<td>7.366499</td>
<td>199.827904</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">86</th>
<td>muscle cell:smooth</td>
<td>LN00837</td>
<td>59.032529</td>
<td>44.506487</td>
<td>9.537860</td>
<td>196.964611</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">87</th>
<td>muscle cell:smooth</td>
<td>LN22921</td>
<td>39.150671</td>
<td>28.447433</td>
<td>6.260871</td>
<td>199.593551</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">88</th>
<td>muscle cell:smooth</td>
<td>LN24336</td>
<td>43.536294</td>
<td>30.191094</td>
<td>7.974461</td>
<td>199.351793</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">89</th>
<td>muscle cell:smooth</td>
<td>LN27766</td>
<td>62.912204</td>
<td>48.334648</td>
<td>6.110041</td>
<td>199.979704</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">90</th>
<td>natural killer cell</td>
<td>LN00560</td>
<td>86.771851</td>
<td>79.778126</td>
<td>6.896002</td>
<td>199.981161</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">91</th>
<td>natural killer cell</td>
<td>LN00837</td>
<td>57.099449</td>
<td>50.561814</td>
<td>7.570372</td>
<td>199.852375</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">92</th>
<td>natural killer cell</td>
<td>LN22921</td>
<td>57.361924</td>
<td>51.657575</td>
<td>6.314864</td>
<td>199.963468</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">93</th>
<td>natural killer cell</td>
<td>LN24336</td>
<td>85.475053</td>
<td>75.480916</td>
<td>6.704395</td>
<td>199.995869</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">94</th>
<td>natural killer cell</td>
<td>LN27766</td>
<td>35.518688</td>
<td>30.995884</td>
<td>5.664908</td>
<td>199.029670</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">95</th>
<td>plasma cell</td>
<td>LN00560</td>
<td>72.331097</td>
<td>59.404645</td>
<td>7.521666</td>
<td>199.951464</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">96</th>
<td>plasma cell</td>
<td>LN00837</td>
<td>44.038633</td>
<td>35.479895</td>
<td>6.715191</td>
<td>199.593083</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">97</th>
<td>plasma cell</td>
<td>LN22921</td>
<td>57.740290</td>
<td>52.704438</td>
<td>6.326851</td>
<td>199.734748</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">98</th>
<td>plasma cell</td>
<td>LN24336</td>
<td>46.465649</td>
<td>41.440832</td>
<td>6.788876</td>
<td>199.974351</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">99</th>
<td>plasma cell</td>
<td>LN27766</td>
<td>71.756242</td>
<td>57.171075</td>
<td>7.824266</td>
<td>199.998972</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">100</th>
<td>t cell:cd4+ alpha-beta effector</td>
<td>LN00560</td>
<td>95.993355</td>
<td>91.765471</td>
<td>6.121488</td>
<td>199.999549</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">101</th>
<td>t cell:cd4+ alpha-beta effector</td>
<td>LN00837</td>
<td>84.232618</td>
<td>72.495092</td>
<td>9.560197</td>
<td>199.960420</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">102</th>
<td>t cell:cd4+ alpha-beta effector</td>
<td>LN22921</td>
<td>59.880497</td>
<td>51.975392</td>
<td>5.481371</td>
<td>199.966756</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">103</th>
<td>t cell:cd4+ alpha-beta effector</td>
<td>LN24336</td>
<td>49.530880</td>
<td>41.003228</td>
<td>4.235994</td>
<td>199.994424</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">104</th>
<td>t cell:cd4+ alpha-beta effector</td>
<td>LN27766</td>
<td>38.377382</td>
<td>30.867354</td>
<td>7.735967</td>
<td>199.330477</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">105</th>
<td>t cell:cd4+ alpha-beta naive thymus-derived</td>
<td>LN00560</td>
<td>78.090613</td>
<td>68.183839</td>
<td>6.663214</td>
<td>199.996131</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">106</th>
<td>t cell:cd4+ alpha-beta naive thymus-derived</td>
<td>LN00837</td>
<td>65.922173</td>
<td>58.227278</td>
<td>7.790914</td>
<td>199.942717</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">107</th>
<td>t cell:cd4+ alpha-beta naive thymus-derived</td>
<td>LN22921</td>
<td>65.158677</td>
<td>57.901879</td>
<td>6.411245</td>
<td>199.952146</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">108</th>
<td>t cell:cd4+ alpha-beta naive thymus-derived</td>
<td>LN24336</td>
<td>63.160522</td>
<td>53.431121</td>
<td>6.536176</td>
<td>199.997767</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">109</th>
<td>t cell:cd4+ alpha-beta naive thymus-derived</td>
<td>LN27766</td>
<td>51.208692</td>
<td>41.425802</td>
<td>8.157567</td>
<td>199.874886</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">110</th>
<td>t cell:cd8+</td>
<td>LN00560</td>
<td>86.615013</td>
<td>79.180151</td>
<td>7.102615</td>
<td>199.996365</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">111</th>
<td>t cell:cd8+</td>
<td>LN00837</td>
<td>55.437898</td>
<td>46.240026</td>
<td>6.556713</td>
<td>199.971033</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">112</th>
<td>t cell:cd8+</td>
<td>LN22921</td>
<td>56.181049</td>
<td>49.659042</td>
<td>6.259795</td>
<td>199.940448</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">113</th>
<td>t cell:cd8+</td>
<td>LN24336</td>
<td>55.152276</td>
<td>48.343775</td>
<td>6.651539</td>
<td>199.966610</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">114</th>
<td>t cell:cd8+</td>
<td>LN27766</td>
<td>35.375142</td>
<td>30.384688</td>
<td>7.360558</td>
<td>198.852391</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">115</th>
<td>t cell:cd8+ cd161+</td>
<td>LN00560</td>
<td>90.056320</td>
<td>84.555500</td>
<td>7.182956</td>
<td>199.994788</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">116</th>
<td>t cell:cd8+ cd161+</td>
<td>LN00837</td>
<td>59.376177</td>
<td>44.384574</td>
<td>9.255595</td>
<td>199.566477</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">117</th>
<td>t cell:cd8+ cd161+</td>
<td>LN22921</td>
<td>66.069266</td>
<td>59.345402</td>
<td>6.111516</td>
<td>199.991352</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">118</th>
<td>t cell:cd8+ cd161+</td>
<td>LN24336</td>
<td>48.486466</td>
<td>40.243374</td>
<td>7.509943</td>
<td>198.654975</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">119</th>
<td>t cell:cd8+ cd161+</td>
<td>LN27766</td>
<td>37.296980</td>
<td>29.442390</td>
<td>8.137273</td>
<td>199.500140</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">120</th>
<td>t cell:follicular helper</td>
<td>LN00560</td>
<td>82.058488</td>
<td>73.460999</td>
<td>5.603447</td>
<td>199.999450</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">121</th>
<td>t cell:follicular helper</td>
<td>LN00837</td>
<td>61.714580</td>
<td>51.712027</td>
<td>7.083180</td>
<td>199.822547</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">122</th>
<td>t cell:follicular helper</td>
<td>LN22921</td>
<td>63.786746</td>
<td>57.161618</td>
<td>6.077661</td>
<td>199.989836</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">123</th>
<td>t cell:follicular helper</td>
<td>LN24336</td>
<td>54.536331</td>
<td>46.164723</td>
<td>6.099143</td>
<td>199.990253</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">124</th>
<td>t cell:follicular helper</td>
<td>LN27766</td>
<td>42.271050</td>
<td>35.354972</td>
<td>7.276333</td>
<td>199.864371</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">125</th>
<td>t cell:mature natural killer</td>
<td>LN00560</td>
<td>96.336149</td>
<td>93.203428</td>
<td>9.809964</td>
<td>199.942835</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">126</th>
<td>t cell:mature natural killer</td>
<td>LN00837</td>
<td>67.373921</td>
<td>52.184751</td>
<td>8.295802</td>
<td>199.948155</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">127</th>
<td>t cell:mature natural killer</td>
<td>LN22921</td>
<td>54.308640</td>
<td>46.321960</td>
<td>7.835377</td>
<td>199.907410</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">128</th>
<td>t cell:mature natural killer</td>
<td>LN24336</td>
<td>47.357061</td>
<td>39.144706</td>
<td>6.153474</td>
<td>199.952564</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">129</th>
<td>t cell:mature natural killer</td>
<td>LN27766</td>
<td>44.643981</td>
<td>32.162381</td>
<td>7.923749</td>
<td>199.151376</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">130</th>
<td>t cell:regulatory</td>
<td>LN00560</td>
<td>100.303430</td>
<td>96.757788</td>
<td>9.233340</td>
<td>199.998294</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">131</th>
<td>t cell:regulatory</td>
<td>LN00837</td>
<td>77.401648</td>
<td>68.048508</td>
<td>8.143654</td>
<td>199.771234</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">132</th>
<td>t cell:regulatory</td>
<td>LN22921</td>
<td>52.599146</td>
<td>45.693505</td>
<td>5.852943</td>
<td>199.996959</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">133</th>
<td>t cell:regulatory</td>
<td>LN24336</td>
<td>56.138669</td>
<td>47.849818</td>
<td>7.000655</td>
<td>199.993808</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">134</th>
<td>t cell:regulatory</td>
<td>LN27766</td>
<td>31.841954</td>
<td>26.530015</td>
<td>5.864464</td>
<td>199.380478</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">135</th>
<td>t cell:tim3+</td>
<td>LN00560</td>
<td>90.805956</td>
<td>84.536161</td>
<td>7.447616</td>
<td>199.922781</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">136</th>
<td>t cell:tim3+</td>
<td>LN00837</td>
<td>65.234680</td>
<td>60.787009</td>
<td>13.362004</td>
<td>175.288619</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">137</th>
<td>t cell:tim3+</td>
<td>LN22921</td>
<td>51.362474</td>
<td>44.746693</td>
<td>8.064281</td>
<td>197.946082</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">138</th>
<td>t cell:tim3+</td>
<td>LN24336</td>
<td>59.124041</td>
<td>50.708968</td>
<td>7.018645</td>
<td>199.806968</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">139</th>
<td>t cell:tim3+</td>
<td>LN27766</td>
<td>29.328329</td>
<td>24.992139</td>
<td>8.628643</td>
<td>169.319098</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-50" class="cell" data-execution_count="41">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_mean(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in LN00560:
                    Level Three Cell Type  mean_distance
6              b cell:pre-germinal center     125.145570
1                  b cell:germinal center     110.025798
2  b cell:germinal center pre-plasmablast     108.711157
3                       b cell:interferon     102.444714
4                           b cell:memory     102.444467

Bottom 5 cell types in LN00560:
            Level Three Cell Type  mean_distance
7            b cell:proliferating      74.076170
19                    plasma cell      72.331097
5                    b cell:naive      69.258328
9   dendritic cell:conventional 2      68.057708
12    dendritic cell:plasmacytoid      65.255968

Top 5 cell types in LN00837:
                     Level Three Cell Type  mean_distance
3                        b cell:interferon     114.785742
0                         b cell:activated     103.892159
6               b cell:pre-germinal center      91.106536
20         t cell:cd4+ alpha-beta effector      84.232618
2   b cell:germinal center pre-plasmablast      83.001064

Bottom 5 cell types in LN00837:
            Level Three Cell Type  mean_distance
12    dendritic cell:plasmacytoid      54.379345
9   dendritic cell:conventional 2      54.012741
7            b cell:proliferating      51.889082
13           lymphoid cell:innate      47.074148
19                    plasma cell      44.038633

Top 5 cell types in LN22921:
                    Level Three Cell Type  mean_distance
6              b cell:pre-germinal center     132.997491
3                       b cell:interferon     131.162456
1                  b cell:germinal center     126.062410
2  b cell:germinal center pre-plasmablast     124.921662
0                        b cell:activated     109.313037

Bottom 5 cell types in LN22921:
            Level Three Cell Type  mean_distance
27                   t cell:tim3+      51.362474
16                       monocyte      50.021763
9   dendritic cell:conventional 2      48.714428
10      dendritic cell:follicular      46.702944
17             muscle cell:smooth      39.150671

Top 5 cell types in LN24336:
            Level Three Cell Type  mean_distance
9   dendritic cell:conventional 2     129.199183
8   dendritic cell:conventional 1     120.905504
11       dendritic cell:migratory     120.640773
3               b cell:interferon     110.398002
6      b cell:pre-germinal center     105.067771

Bottom 5 cell types in LN24336:
            Level Three Cell Type  mean_distance
23             t cell:cd8+ cd161+      48.486466
25  t cell:mature natural killer       47.357061
10      dendritic cell:follicular      46.933889
19                    plasma cell      46.465649
17             muscle cell:smooth      43.536294

Top 5 cell types in LN27766:
         Level Three Cell Type  mean_distance
6   b cell:pre-germinal center     106.766845
3            b cell:interferon     105.614725
0             b cell:activated      78.187423
5                 b cell:naive      75.836945
19                 plasma cell      71.756242

Bottom 5 cell types in LN27766:
          Level Three Cell Type  mean_distance
18          natural killer cell      35.518688
22                  t cell:cd8+      35.375142
26            t cell:regulatory      31.841954
12  dendritic cell:plasmacytoid      31.272411
27                 t cell:tim3+      29.328329</code></pre>
</div>
</div>
<div id="cell-51" class="cell" data-execution_count="42">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_median(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in LN00560:
                    Level Three Cell Type  median_distance
6              b cell:pre-germinal center       131.985475
1                  b cell:germinal center       109.326467
2  b cell:germinal center pre-plasmablast       108.905779
4                           b cell:memory       100.377290
3                       b cell:interferon        99.240528

Bottom 5 cell types in LN00560:
            Level Three Cell Type  median_distance
7            b cell:proliferating        61.983066
19                    plasma cell        59.404645
9   dendritic cell:conventional 2        57.691652
5                    b cell:naive        54.441120
12    dendritic cell:plasmacytoid        51.800420

Top 5 cell types in LN00837:
                     Level Three Cell Type  median_distance
3                        b cell:interferon       112.568316
0                         b cell:activated       103.148832
6               b cell:pre-germinal center        86.702315
2   b cell:germinal center pre-plasmablast        73.750379
20         t cell:cd4+ alpha-beta effector        72.495092

Bottom 5 cell types in LN00837:
   Level Three Cell Type  median_distance
17    muscle cell:smooth        44.506487
23    t cell:cd8+ cd161+        44.384574
7   b cell:proliferating        42.257876
13  lymphoid cell:innate        39.426220
19           plasma cell        35.479895

Top 5 cell types in LN22921:
                    Level Three Cell Type  median_distance
6              b cell:pre-germinal center       140.357258
3                       b cell:interferon       139.595461
1                  b cell:germinal center       132.087548
2  b cell:germinal center pre-plasmablast       129.269694
0                        b cell:activated       109.134587

Bottom 5 cell types in LN22921:
            Level Three Cell Type  median_distance
15                      mast cell        44.533122
9   dendritic cell:conventional 2        41.297008
16                       monocyte        40.595156
10      dendritic cell:follicular        32.311309
17             muscle cell:smooth        28.447433

Top 5 cell types in LN24336:
            Level Three Cell Type  median_distance
9   dendritic cell:conventional 2       136.077984
11       dendritic cell:migratory       127.698045
8   dendritic cell:conventional 1       124.830580
3               b cell:interferon       112.429843
6      b cell:pre-germinal center       103.209786

Bottom 5 cell types in LN24336:
              Level Three Cell Type  median_distance
20  t cell:cd4+ alpha-beta effector        41.003228
23               t cell:cd8+ cd161+        40.243374
25    t cell:mature natural killer         39.144706
10        dendritic cell:follicular        37.744882
17               muscle cell:smooth        30.191094

Top 5 cell types in LN27766:
         Level Three Cell Type  median_distance
6   b cell:pre-germinal center       109.227324
3            b cell:interferon       104.382767
0             b cell:activated        70.452448
5                 b cell:naive        66.107927
19                 plasma cell        57.171075

Bottom 5 cell types in LN27766:
          Level Three Cell Type  median_distance
22                  t cell:cd8+        30.384688
23           t cell:cd8+ cd161+        29.442390
12  dendritic cell:plasmacytoid        27.099603
26            t cell:regulatory        26.530015
27                 t cell:tim3+        24.992139</code></pre>
</div>
</div>
<div id="cell-52" class="cell" data-execution_count="43">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>calculate_regional_variability(df_all_edges_with_cell_type_level, cell_type_level)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regional Variability Analysis:
Mean: Average distance in each region
Std: Standard deviation of distances
CV: Coefficient of Variation (std/mean * 100%)
                mean    std  CV (%)
Unique Region                      
LN00560        86.25  50.97    59.1
LN00837        65.65  42.86    65.3
LN22921        69.03  43.55    63.1
LN24336        62.29  41.07    65.9
LN27766        48.66  35.83    73.6

Cell Type Variability Analysis (sorted by CV):
                                               mean    std  CV (%)
Level Three Cell Type                                             
muscle cell:smooth                            65.17  48.20    74.0
mast cell                                     54.53  40.09    73.5
dendritic cell:follicular                     65.68  48.16    73.3
lymphoid cell:innate                          69.90  50.05    71.6
t cell:mature natural killer                  54.65  39.02    71.4
t cell:regulatory                             55.45  39.00    70.3
b cell:germinal center                        70.57  49.44    70.1
monocyte                                      57.09  39.95    70.0
b cell:proliferating                          65.55  45.77    69.8
dendritic cell:conventional 2                 66.62  45.99    69.0
dendritic cell:plasmacytoid                   59.26  40.45    68.3
t cell:cd4+ alpha-beta effector               68.30  45.44    66.5
t cell:cd8+                                   61.29  40.36    65.9
t cell:cd8+ cd161+                            66.32  42.96    64.8
natural killer cell                           60.56  38.98    64.4
dendritic cell:conventional 1                 74.03  47.68    64.4
t cell:tim3+                                  69.06  44.31    64.2
b cell:naive                                  71.23  45.65    64.1
macrophage                                    60.91  38.83    63.7
b cell:germinal center pre-plasmablast        52.90  33.19    62.7
dendritic cell:migratory                      80.92  50.55    62.5
t cell:follicular helper                      63.41  39.65    62.5
t cell:cd4+ alpha-beta naive thymus-derived   64.99  40.45    62.2
plasma cell                                   54.58  33.43    61.2
b cell:memory                                 82.07  49.33    60.1
b cell:activated                              87.40  49.44    56.6
b cell:interferon                            115.91  51.01    44.0
b cell:pre-germinal center                   124.16  48.98    39.4</code></pre>
</div>
</div>
<div id="cell-53" class="cell" data-execution_count="44">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>plot_violin_cells_per_celltype(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">'area'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="11_distance_analysis__lymphnode-codex-yale_files/figure-html/cell-45-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-54" class="cell" data-execution_count="45">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_boxplots_by_region(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="11_distance_analysis__lymphnode-codex-yale_files/figure-html/cell-46-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-55" class="cell" data-execution_count="46">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_heatmap(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="11_distance_analysis__lymphnode-codex-yale_files/figure-html/cell-47-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-56" class="cell" data-execution_count="47">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>plot_violin_plots_all_regions(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">"count"</span>) <span class="co"># Or, density_norm="count" or "area" based on preference.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="11_distance_analysis__lymphnode-codex-yale_files/figure-html/cell-48-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/cns-iu\.github\.io\/hra-cell-distance-analysis");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/cns-iu/hra-cell-distance-analysis/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>