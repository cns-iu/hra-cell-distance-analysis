<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Analyze and visualize cell-to-nearest-endothelial-cell distance distributions for the oralcavity-codex-czi dataset.">

<title>Distance Analysis: oralcavity-codex-czi – HRA: Cell Distance Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-000f0825b9c55ed21d14970d810c14a9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Distance Analysis: oralcavity-codex-czi – HRA: Cell Distance Analysis">
<meta property="og:description" content="Analyze and visualize cell-to-nearest-endothelial-cell distance distributions for the oralcavity-codex-czi dataset.">
<meta property="og:image" content="https://cns-iu.github.io/hra-cell-distance-analysis/06_distance_analysis__oralcavity-codex-czi_files/figure-html/cell-23-output-1.png">
<meta property="og:site_name" content="HRA: Cell Distance Analysis">
<meta property="og:image:height" content="790">
<meta property="og:image:width" content="2004">
<meta name="twitter:title" content="Distance Analysis: oralcavity-codex-czi – HRA: Cell Distance Analysis">
<meta name="twitter:description" content="Analyze and visualize cell-to-nearest-endothelial-cell distance distributions for the oralcavity-codex-czi dataset.">
<meta name="twitter:image" content="https://cns-iu.github.io/hra-cell-distance-analysis/06_distance_analysis__oralcavity-codex-czi_files/figure-html/cell-23-output-1.png">
<meta name="twitter:image-height" content="790">
<meta name="twitter:image-width" content="2004">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">HRA: Cell Distance Analysis</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./distance_analysis__oralcavity-codex-czi.html">Distance Analysis: oralcavity-codex-czi</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cell Distance Analysis for Spatial Omics Datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_processing__convert_to_cde_format.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Processing: Convert to CDE Format</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_processing__crosswalk_cell_type_names.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Processing: Harmonize Cell Types</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_analysis__cell_distribution_across_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Analysis: Call Distribution Across Datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_processing__distance_computation_for_all_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Processing: Cell Distance Computation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__intestine-codex-stanford.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: codex-intestine-stanford</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__pancreas-geomx-ufl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: pancreas-geomx-ufl</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__oralcavity-codex-czi.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Distance Analysis: oralcavity-codex-czi</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__lung-codex-urmc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: lung-codex-urmc</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__skin-confocal-sorgerlab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: skin-confocal-sorgerlab</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__bonemarrow-codex-chop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: bonemarrow-codex-chop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__colon-cycif-sorgerlab-colon-xenium-stanford.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: colon-xenium-stanford and colon-cycif-sorgerlab</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__lymphnode-codex-yale.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: lymphnode-codex-yale</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__spleen-codex-ufl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: spleen-codex-ufl</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__tonsil-codex-stanford-esophagus-codex-stanford.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: tonsil-codex-stanford and esophagus-codex-stanford</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__skin-celldive-ge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: skin-celldive-ge</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__maternalfetalinterface-mibitof-stanford.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: maternalfetalinterface-mibitof-stanford</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset." id="toc-get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset." class="nav-link active" data-scroll-target="#get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset.">Get initial statistics and identify endothelial cell categories for dataset.</a></li>
  <li><a href="#process-datasets-to-add-region-information-to-nodes-files." id="toc-process-datasets-to-add-region-information-to-nodes-files." class="nav-link" data-scroll-target="#process-datasets-to-add-region-information-to-nodes-files.">Process datasets to add region information to Nodes files.</a></li>
  <li><a href="#process-datasets-to-add-region-information-to-edges-files." id="toc-process-datasets-to-add-region-information-to-edges-files." class="nav-link" data-scroll-target="#process-datasets-to-add-region-information-to-edges-files.">Process datasets to add region information to Edges files.</a></li>
  <li><a href="#node-analysis" id="toc-node-analysis" class="nav-link" data-scroll-target="#node-analysis">Node Analysis</a></li>
  <li><a href="#distance-analysis" id="toc-distance-analysis" class="nav-link" data-scroll-target="#distance-analysis">Distance Analysis</a>
  <ul class="collapse">
  <li><a href="#level-one-cell-type-analysis" id="toc-level-one-cell-type-analysis" class="nav-link" data-scroll-target="#level-one-cell-type-analysis">Level One Cell Type Analysis</a></li>
  <li><a href="#level-two-cell-type-analysis" id="toc-level-two-cell-type-analysis" class="nav-link" data-scroll-target="#level-two-cell-type-analysis">Level Two Cell Type Analysis</a></li>
  <li><a href="#level-three-cell-type-analysis" id="toc-level-three-cell-type-analysis" class="nav-link" data-scroll-target="#level-three-cell-type-analysis">Level Three Cell Type Analysis</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/cns-iu/hra-cell-distance-analysis/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="distance_analysis__oralcavity-codex-czi.html.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Distance Analysis: oralcavity-codex-czi</h1>
</div>

<div>
  <div class="description">
    Analyze and visualize cell-to-nearest-endothelial-cell distance distributions for the <code>oralcavity-codex-czi</code> dataset.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div id="cell-2" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> normalize</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> _cde_compute_edges_from_nodes <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="va">None</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="va">None</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># suppress warnings</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-3" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>basepath <span class="op">=</span> <span class="st">"/u/yashjain/hra-cell-distance-analysis/data"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dataset_dir <span class="op">=</span> <span class="st">"oralcavity-codex-czi"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>data_filedir <span class="op">=</span> os.path.join(<span class="st">"data-processed-nodes-with-harmonized-cell-types"</span>, dataset_dir)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>output_edge_dir <span class="op">=</span> os.path.join(<span class="st">"data-processed-edges"</span>, dataset_dir)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>figures_output_dir <span class="op">=</span> <span class="st">"generated-figures"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-4" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to load your data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_data(path, edges<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> edges:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        column_names <span class="op">=</span> [<span class="st">'cell_id'</span>, <span class="st">'x1'</span>, <span class="st">'y1'</span>, <span class="st">'z1'</span>, <span class="st">'x2'</span>, <span class="st">'y2'</span>, <span class="st">'z2'</span>]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> pd.read_csv(path, header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>column_names)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> pd.read_csv(path)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-5" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to read all files ending with "-nodes.csv" in the `data_filedir` directory into a single DataFrame. </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Another additional column `Dataset` is added to identify the dataset name which comes from the filename before the `-nodes.csv` suffix.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Additionally, function reads all files ending with "-edges.csv" in the `output_edge_dir` directory into a single DataFrame. </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Three additional columns are added "Dataset", "Anchor Cell Type", and "Anchor Cell Type Level" to identify the dataset name, anchor cell type, and anchor cell type level respectively which come from the filename before the `.csv` suffix.</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The three additional columns are created by splitting the filename on the `-` character, and extracting the relevant parts.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># On splitting, the first part is the dataset name, second part is the anchor cell type level, and third part is the anchor cell type, and last part is the `edges` suffix.</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># When reading files, check if the file has the correct format (i.e., ends with `-edges.csv`).</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Additionally, the function merges the edges DataFrame with the nodes DataFrame to get the cell type information for the anchor cells.</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># This is done by reading the corresponding nodes file from the `data_filedir` directory for each edges file, and merging it with the edges DataFrame on the `cell_id` column.</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># The merged DataFrame contains the edges with additional columns for the cell type information.</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># The function returns three DataFrames:</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. `merged_nodes`: DataFrame containing all nodes with an additional column `Dataset`.</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. `merged_edges`: DataFrame containing all edges with additional columns `Dataset`, `Anchor Cell Type`, and `Anchor Cell Type Level`.</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. `merged_nodes_for_all_edges`: DataFrame containing all edges with additional columns `Dataset`, `Anchor Cell Type`, `Anchor Cell Type Level`, and the cell type information for cells.</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_all_edge_datasets(basepath, data_filedir, output_edge_dir):</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    all_nodes_files <span class="op">=</span> []</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    all_edges_files <span class="op">=</span> []</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    all_nodes_edges_files <span class="op">=</span> []</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir(os.path.join(basepath, output_edge_dir)):</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">"-edges.csv"</span>):</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            file_path <span class="op">=</span> os.path.join(basepath, output_edge_dir, <span class="bu">file</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>            dataset_name, anchor_cell_type_level, anchor_cell_type <span class="op">=</span> <span class="bu">file</span>.replace(<span class="st">"-edges.csv"</span>, <span class="st">""</span>).split(<span class="st">'-'</span>)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            edges_df <span class="op">=</span> load_data(file_path, edges<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>            edges_df[<span class="st">'Dataset'</span>] <span class="op">=</span> dataset_name</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            edges_df[<span class="st">'Anchor Cell Type'</span>] <span class="op">=</span> anchor_cell_type</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>            edges_df[<span class="st">'Anchor Cell Type Level'</span>] <span class="op">=</span> anchor_cell_type_level</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>            edges_df.rename(columns<span class="op">=</span>{<span class="st">"distance"</span>: <span class="st">"Distance"</span>}, inplace<span class="op">=</span><span class="va">True</span>) <span class="co"># Rename column "distance" to "Distance".</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>            all_edges_files.append(edges_df)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Read the corresponding nodes file from data_filedir to get the cell type information</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>            nodes_file_path <span class="op">=</span> os.path.join(basepath, data_filedir, <span class="ss">f"</span><span class="sc">{</span>dataset_name<span class="sc">}</span><span class="ss">-nodes.csv"</span>)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>            nodes_df <span class="op">=</span> load_data(nodes_file_path)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>            nodes_df[<span class="st">'Dataset'</span>] <span class="op">=</span> dataset_name</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>            all_nodes_files.append(nodes_df)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a new 'cell_id' column to nodes_df</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>            nodes_df[<span class="st">'cell_id'</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(nodes_df))</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Set 'cell_id' column as index for nodes_df</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>            nodes_df.set_index(<span class="st">'cell_id'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Merge edges_df with nodes_df to get the cell type information for the anchor cells</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>            edges_nodes_df <span class="op">=</span> pd.merge(edges_df, nodes_df[[<span class="st">'Level Three Cell Type'</span>, <span class="st">'Level Two Cell Type'</span>, <span class="st">'Level One Cell Type'</span>]], how<span class="op">=</span><span class="st">'left'</span>, left_on<span class="op">=</span><span class="st">'cell_id'</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>            all_nodes_edges_files.append(edges_nodes_df)</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    merged_edges <span class="op">=</span> pd.concat(all_edges_files, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    merged_nodes <span class="op">=</span> pd.concat(all_nodes_files, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    merged_nodes_for_all_edges <span class="op">=</span> pd.concat(all_nodes_edges_files, ignore_index<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merged_nodes, merged_edges, merged_nodes_for_all_edges</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-6" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_directory(directory):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(directory):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        os.makedirs(directory)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Directory '</span><span class="sc">{</span>directory<span class="sc">}</span><span class="ss">' created successfully."</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Directory '</span><span class="sc">{</span>directory<span class="sc">}</span><span class="ss">' already exists."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset." class="level2">
<h2 class="anchored" data-anchor-id="get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset.">Get initial statistics and identify endothelial cell categories for dataset.</h2>
<div id="cell-8" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_all_nodes, df_all_edges, df_all_edges_with_cell_types <span class="op">=</span> read_all_edge_datasets(basepath, data_filedir, output_edge_dir)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-9" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df_all_nodes.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">Original Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three CL Label</th>
<th data-quarto-table-cell-role="th">Level Three CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/3</th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Level Two CL Label</th>
<th data-quarto-table-cell-role="th">Level Two CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/2</th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Level One CL Label</th>
<th data-quarto-table-cell-role="th">Level One CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/1</th>
<th data-quarto-table-cell-role="th">Dataset</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>2466.85</td>
<td>580.95</td>
<td>Others</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2421.30</td>
<td>629.05</td>
<td>Others</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>2459.00</td>
<td>681.80</td>
<td>Others</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>2418.20</td>
<td>700.00</td>
<td>Others</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>2444.70</td>
<td>768.30</td>
<td>Treg</td>
<td>t cell:regulatory</td>
<td>regulatory T cell</td>
<td>CL:0000815</td>
<td>skos:exactMatch</td>
<td>t cell</td>
<td>T cell</td>
<td>CL:0000084</td>
<td>skos:exactMatch</td>
<td>immune cell</td>
<td>leukocyte</td>
<td>CL:0000738</td>
<td>skos:exactMatch</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-10" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the total number of unique cell types per dataset. Compute separately for each cell type column (Level One Cell Type, Level Two Cell Type, Level Three Cell Type, Original Cell Type).</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Total number of unique cell types per cell type annnotation level:"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>unique_cell_types <span class="op">=</span> {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Original Cell Type'</span>: df_all_nodes[<span class="st">'Original Cell Type'</span>].nunique(),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Three Cell Type'</span>: df_all_nodes[<span class="st">'Level Three Cell Type'</span>].nunique(),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Two Cell Type'</span>: df_all_nodes[<span class="st">'Level Two Cell Type'</span>].nunique(),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level One Cell Type'</span>: df_all_nodes[<span class="st">'Level One Cell Type'</span>].nunique()</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cell_type, count <span class="kw">in</span> unique_cell_types.items():</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>cell_type<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total number of unique cell types per cell type annnotation level:
Original Cell Type: 39
Level Three Cell Type: 28
Level Two Cell Type: 20
Level One Cell Type: 6</code></pre>
</div>
</div>
<div id="cell-11" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the unique cell types containing "endothelial" in name per cell type column (Level One Cell Type, Level Two Cell Type, Level Three Cell Type, Original Cell Type) to a dictionary where the key is the level and the value is a list of unique cell types.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>endothelial_cell_types <span class="op">=</span> {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Original Cell Type'</span>: df_all_nodes[df_all_nodes[<span class="st">'Original Cell Type'</span>].<span class="bu">str</span>.contains(<span class="st">"endothelial"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)][<span class="st">'Original Cell Type'</span>].unique().tolist(),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Three Cell Type'</span>: df_all_nodes[df_all_nodes[<span class="st">'Level Three Cell Type'</span>].<span class="bu">str</span>.contains(<span class="st">"endothelial"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)][<span class="st">'Level Three Cell Type'</span>].unique().tolist(),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Two Cell Type'</span>: df_all_nodes[df_all_nodes[<span class="st">'Level Two Cell Type'</span>].<span class="bu">str</span>.contains(<span class="st">"endothelial"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)][<span class="st">'Level Two Cell Type'</span>].unique().tolist(),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level One Cell Type'</span>: df_all_nodes[df_all_nodes[<span class="st">'Level One Cell Type'</span>].<span class="bu">str</span>.contains(<span class="st">"endothelial"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)][<span class="st">'Level One Cell Type'</span>].unique().tolist()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Endothelial cell types per cell type annotation level:"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> level, cell_types <span class="kw">in</span> endothelial_cell_types.items():</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cell <span class="kw">in</span> cell_types:</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  - </span><span class="sc">{</span>cell<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Endothelial cell types per cell type annotation level:

Original Cell Type:
  - Vascular Endothelial Cells
  - Lymphatic Endothelial Cells

Level Three Cell Type:
  - endothelial cell of vascular tree
  - endothelial cell of lymphatic vessel

Level Two Cell Type:
  - endothelial cell of vascular tree
  - endothelial cell of lymphatic vessel

Level One Cell Type:
  - endothelial cell</code></pre>
</div>
</div>
<div id="cell-12" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>type_field_list <span class="op">=</span> [<span class="st">"Level Three Cell Type"</span>, <span class="st">"Level Two Cell Type"</span>, <span class="st">"Level One Cell Type"</span>] <span class="co"># Skipping Original Cell Type as it is not a hierarchical level.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the anchor cell type (type of endothelial cell) for each level in type_field_list based on available categories in the previous cell. The distance analysis at all three levels will be limited to the specified anchor cell type.</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>anchor_cell_type_dict <span class="op">=</span> {</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Three Cell Type'</span>: <span class="st">'endothelial cell of vascular tree'</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Two Cell Type'</span>: <span class="st">'endothelial cell of vascular tree'</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level One Cell Type'</span>: <span class="st">'endothelial cell'</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="process-datasets-to-add-region-information-to-nodes-files." class="level2">
<h2 class="anchored" data-anchor-id="process-datasets-to-add-region-information-to-nodes-files.">Process datasets to add region information to Nodes files.</h2>
<div id="cell-14" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dictionary to map oral cavity regions to correct region names.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>region_map <span class="op">=</span> {<span class="st">'Buccal_Mucosa_And_Minor_Salivary_Glands_1'</span>:<span class="st">'Buccal Mucosa And Minor Salivary Glands'</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'Buccal_Mucosa_And_Minor_Salivary_Glands_2'</span>:<span class="st">'Buccal Mucosa And Minor Salivary Glands'</span>, </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'Gingiva_ID1_shiny'</span>:<span class="st">'Gingiva'</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'Gingiva_ID5_shiny'</span>:<span class="st">'Gingiva'</span>, </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'Parotid_1'</span>:<span class="st">'Parotid'</span>, </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'Parotid_2'</span>:<span class="st">'Parotid'</span>, </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'Parotid_3'</span>:<span class="st">'Parotid'</span>, </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'Parotid_4'</span>:<span class="st">'Parotid'</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'Submandibular_1'</span>:<span class="st">'Submandibular'</span>, </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'Submandibular_2'</span>:<span class="st">'Submandibular'</span>, </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'Tongue_3'</span>:<span class="st">'Tongue'</span>, </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'Tongue__1'</span>:<span class="st">'Tongue'</span>, </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'Tongue__2'</span>:<span class="st">'Tongue'</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-15" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df_all_nodes.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">Original Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three CL Label</th>
<th data-quarto-table-cell-role="th">Level Three CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/3</th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Level Two CL Label</th>
<th data-quarto-table-cell-role="th">Level Two CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/2</th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Level One CL Label</th>
<th data-quarto-table-cell-role="th">Level One CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/1</th>
<th data-quarto-table-cell-role="th">Dataset</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>2466.85</td>
<td>580.95</td>
<td>Others</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2421.30</td>
<td>629.05</td>
<td>Others</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>2459.00</td>
<td>681.80</td>
<td>Others</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>2418.20</td>
<td>700.00</td>
<td>Others</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>2444.70</td>
<td>768.30</td>
<td>Treg</td>
<td>t cell:regulatory</td>
<td>regulatory T cell</td>
<td>CL:0000815</td>
<td>skos:exactMatch</td>
<td>t cell</td>
<td>T cell</td>
<td>CL:0000084</td>
<td>skos:exactMatch</td>
<td>immune cell</td>
<td>leukocyte</td>
<td>CL:0000738</td>
<td>skos:exactMatch</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-16" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through the df_all_data dataframe to create new column "Unique Region" based on the "Dataset" column.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The "Unique Region" column is created by mapping the region names based on the full dataset name.</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>df_all_nodes[<span class="st">'Unique Region'</span>] <span class="op">=</span> df_all_nodes[<span class="st">'Dataset'</span>].<span class="bu">map</span>(region_map)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># df_all_nodes['Unique Region'] = df_all_nodes['Dataset'].str.split('-').str[1].map(region_map)</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the new columns are created correctly.</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>df_all_nodes[[<span class="st">'Dataset'</span>, <span class="st">'Unique Region'</span>]].head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-17" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print all unique regions in the data.</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Unique Regions in the data:"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_all_nodes[<span class="st">'Unique Region'</span>].unique())</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the total number of unique regions.</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total number of unique regions: </span><span class="sc">{</span>df_all_nodes[<span class="st">'Unique Region'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print number of unique datasets per unique region.</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Number of unique datasets per unique region:"</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> df_all_nodes[<span class="st">'Unique Region'</span>].unique():</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    num_datasets <span class="op">=</span> df_all_nodes[df_all_nodes[<span class="st">'Unique Region'</span>] <span class="op">==</span> region][<span class="st">'Dataset'</span>].nunique()</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>num_datasets<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Unique Regions in the data:
['Buccal Mucosa And Minor Salivary Glands' 'Gingiva' 'Parotid'
 'Submandibular' 'Tongue']
Total number of unique regions: 5

Number of unique datasets per unique region:
Buccal Mucosa And Minor Salivary Glands: 2
Gingiva: 2
Parotid: 4
Submandibular: 2
Tongue: 3</code></pre>
</div>
</div>
</section>
<section id="process-datasets-to-add-region-information-to-edges-files." class="level2">
<h2 class="anchored" data-anchor-id="process-datasets-to-add-region-information-to-edges-files.">Process datasets to add region information to Edges files.</h2>
<div id="cell-19" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df_all_edges.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cell_id</th>
<th data-quarto-table-cell-role="th">x1</th>
<th data-quarto-table-cell-role="th">y1</th>
<th data-quarto-table-cell-role="th">z1</th>
<th data-quarto-table-cell-role="th">x2</th>
<th data-quarto-table-cell-role="th">y2</th>
<th data-quarto-table-cell-role="th">z2</th>
<th data-quarto-table-cell-role="th">Distance</th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type Level</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>2466.85</td>
<td>580.950</td>
<td>0</td>
<td>2600.55</td>
<td>598.700</td>
<td>0</td>
<td>134.873098</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>endothelial cell of vascular tree</td>
<td>Level Three Cell Type</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>759</td>
<td>2595.45</td>
<td>407.850</td>
<td>0</td>
<td>2689.10</td>
<td>404.285</td>
<td>0</td>
<td>93.717830</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>endothelial cell of vascular tree</td>
<td>Level Three Cell Type</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>782</td>
<td>2599.45</td>
<td>413.290</td>
<td>0</td>
<td>2689.10</td>
<td>404.285</td>
<td>0</td>
<td>90.101124</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>endothelial cell of vascular tree</td>
<td>Level Three Cell Type</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>840</td>
<td>2588.60</td>
<td>414.555</td>
<td>0</td>
<td>2689.10</td>
<td>404.285</td>
<td>0</td>
<td>101.023378</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>endothelial cell of vascular tree</td>
<td>Level Three Cell Type</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>869</td>
<td>2583.50</td>
<td>419.190</td>
<td>0</td>
<td>2689.10</td>
<td>404.285</td>
<td>0</td>
<td>106.646702</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>endothelial cell of vascular tree</td>
<td>Level Three Cell Type</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-20" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Process the edge data to create new columns "Unique Region" based on the "Dataset" column, similar to how it was done for the node data.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df_all_edges[<span class="st">'Unique Region'</span>] <span class="op">=</span> df_all_edges[<span class="st">'Dataset'</span>].<span class="bu">map</span>(region_map)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the new columns are created correctly.</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>df_all_edges[[<span class="st">'Dataset'</span>, <span class="st">'Unique Region'</span>]].head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-21" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print all unique regions in the data.</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Unique Regions in the data:"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_all_edges[<span class="st">'Unique Region'</span>].unique())</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the total number of unique regions.</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total number of unique regions: </span><span class="sc">{</span>df_all_edges[<span class="st">'Unique Region'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print number of unique datasets per unique region.</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Number of unique datasets per unique region:"</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> df_all_edges[<span class="st">'Unique Region'</span>].unique():</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    num_datasets <span class="op">=</span> df_all_edges[df_all_edges[<span class="st">'Unique Region'</span>] <span class="op">==</span> region][<span class="st">'Dataset'</span>].nunique()</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>num_datasets<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Unique Regions in the data:
['Buccal Mucosa And Minor Salivary Glands' 'Gingiva' 'Parotid'
 'Submandibular' 'Tongue']
Total number of unique regions: 5

Number of unique datasets per unique region:
Buccal Mucosa And Minor Salivary Glands: 2
Gingiva: 2
Parotid: 4
Submandibular: 2
Tongue: 3</code></pre>
</div>
</div>
<div id="cell-22" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_types[<span class="st">'Unique Region'</span>] <span class="op">=</span> df_all_edges_with_cell_types[<span class="st">'Dataset'</span>].<span class="bu">map</span>(region_map)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the new columns are created correctly.</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_types[[<span class="st">'Dataset'</span>, <span class="st">'Unique Region'</span>]].head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-23" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_all_nodes.head(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">Original Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three CL Label</th>
<th data-quarto-table-cell-role="th">Level Three CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/3</th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Level Two CL Label</th>
<th data-quarto-table-cell-role="th">Level Two CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/2</th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Level One CL Label</th>
<th data-quarto-table-cell-role="th">Level One CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/1</th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>2466.85</td>
<td>580.95</td>
<td>Others</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>unknown cell</td>
<td>cell:unknown</td>
<td>CL:0000000</td>
<td>skos:narrowMatch</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-24" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df_all_edges.head(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cell_id</th>
<th data-quarto-table-cell-role="th">x1</th>
<th data-quarto-table-cell-role="th">y1</th>
<th data-quarto-table-cell-role="th">z1</th>
<th data-quarto-table-cell-role="th">x2</th>
<th data-quarto-table-cell-role="th">y2</th>
<th data-quarto-table-cell-role="th">z2</th>
<th data-quarto-table-cell-role="th">Distance</th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type Level</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>2466.85</td>
<td>580.95</td>
<td>0</td>
<td>2600.55</td>
<td>598.7</td>
<td>0</td>
<td>134.873098</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>endothelial cell of vascular tree</td>
<td>Level Three Cell Type</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-25" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_types.head(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cell_id</th>
<th data-quarto-table-cell-role="th">x1</th>
<th data-quarto-table-cell-role="th">y1</th>
<th data-quarto-table-cell-role="th">z1</th>
<th data-quarto-table-cell-role="th">x2</th>
<th data-quarto-table-cell-role="th">y2</th>
<th data-quarto-table-cell-role="th">z2</th>
<th data-quarto-table-cell-role="th">Distance</th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type Level</th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>2466.85</td>
<td>580.95</td>
<td>0</td>
<td>2600.55</td>
<td>598.7</td>
<td>0</td>
<td>134.873098</td>
<td>Buccal_Mucosa_And_Minor_Salivary_Glands_1</td>
<td>endothelial cell of vascular tree</td>
<td>Level Three Cell Type</td>
<td>unknown cell</td>
<td>unknown cell</td>
<td>unknown cell</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="node-analysis" class="level2">
<h2 class="anchored" data-anchor-id="node-analysis">Node Analysis</h2>
<div id="cell-27" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot number of cells per cell type in the same plot. Color by cell type and unique region. Output figure saved in existing `figures_output_dir`.</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_cells_per_celltype(df, type_field, output_dir):</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">8</span>))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    sns.countplot(data<span class="op">=</span>df, x<span class="op">=</span>type_field, palette<span class="op">=</span><span class="st">'Spectral'</span>, hue<span class="op">=</span><span class="st">'Unique Region'</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Number of Cells per </span><span class="sc">{</span>type_field<span class="sc">}</span><span class="ss"> in `</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">`'</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_cells_per_celltype_</span><span class="sc">{</span>type_field<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>                pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_cells_per_celltype_</span><span class="sc">{</span>type_field<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>                bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>                pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    plt.legend(title<span class="op">=</span><span class="st">'Unique Region'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.85</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(type_field)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For numbers on y-axis, do not use scientific notation.</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    plt.ticklabel_format(style<span class="op">=</span><span class="st">'plain'</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set y-axis label</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Number of Cells'</span>)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the plot</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> type_field <span class="kw">in</span> type_field_list:</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>    plot_cells_per_celltype(df_all_nodes, type_field, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06_distance_analysis__oralcavity-codex-czi_files/figure-html/cell-23-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06_distance_analysis__oralcavity-codex-czi_files/figure-html/cell-23-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06_distance_analysis__oralcavity-codex-czi_files/figure-html/cell-23-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="distance-analysis" class="level2">
<h2 class="anchored" data-anchor-id="distance-analysis">Distance Analysis</h2>
<div id="cell-29" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get mean, median, minimum, maximum distance per unique region per anchor cell type.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>df_distance_stats <span class="op">=</span> df_all_edges_with_cell_types.groupby([<span class="st">'Unique Region'</span>, <span class="st">'Anchor Cell Type'</span>, <span class="st">'Anchor Cell Type Level'</span>]).agg(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    min_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'min'</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    max_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'max'</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the first few rows of the distance statistics DataFrame.</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>df_distance_stats</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type Level</th>
<th data-quarto-table-cell-role="th">mean_distance</th>
<th data-quarto-table-cell-role="th">median_distance</th>
<th data-quarto-table-cell-role="th">min_distance</th>
<th data-quarto-table-cell-role="th">max_distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>32.788252</td>
<td>22.583456</td>
<td>2.350532</td>
<td>199.920297</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
<td>66.570639</td>
<td>56.315739</td>
<td>2.400521</td>
<td>199.999181</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Two Cell Type</td>
<td>66.570639</td>
<td>56.315739</td>
<td>2.400521</td>
<td>199.999181</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>endothelial cell of vascular tree</td>
<td>Level Three Cell Type</td>
<td>41.164970</td>
<td>28.331828</td>
<td>2.350532</td>
<td>199.920297</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>endothelial cell of vascular tree</td>
<td>Level Two Cell Type</td>
<td>41.164970</td>
<td>28.331828</td>
<td>2.350532</td>
<td>199.920297</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>Gingiva</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>46.035025</td>
<td>35.977739</td>
<td>0.006517</td>
<td>199.932087</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>Gingiva</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
<td>118.082543</td>
<td>121.622867</td>
<td>0.466601</td>
<td>199.993077</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>Gingiva</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Two Cell Type</td>
<td>118.082543</td>
<td>121.622867</td>
<td>0.466601</td>
<td>199.993077</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>Gingiva</td>
<td>endothelial cell of vascular tree</td>
<td>Level Three Cell Type</td>
<td>46.818074</td>
<td>36.442616</td>
<td>0.006517</td>
<td>199.932087</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>Gingiva</td>
<td>endothelial cell of vascular tree</td>
<td>Level Two Cell Type</td>
<td>46.818074</td>
<td>36.442616</td>
<td>0.006517</td>
<td>199.932087</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>Parotid</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>27.287024</td>
<td>22.853827</td>
<td>0.004528</td>
<td>199.996540</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>Parotid</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
<td>102.361408</td>
<td>100.972133</td>
<td>0.056988</td>
<td>199.999212</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>Parotid</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Two Cell Type</td>
<td>102.361408</td>
<td>100.972133</td>
<td>0.056988</td>
<td>199.999212</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>Parotid</td>
<td>endothelial cell of vascular tree</td>
<td>Level Three Cell Type</td>
<td>28.225257</td>
<td>23.337365</td>
<td>0.004528</td>
<td>199.996540</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>Parotid</td>
<td>endothelial cell of vascular tree</td>
<td>Level Two Cell Type</td>
<td>28.225257</td>
<td>23.337365</td>
<td>0.004528</td>
<td>199.996540</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>Submandibular</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>30.266208</td>
<td>23.193534</td>
<td>2.540177</td>
<td>199.943992</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>Submandibular</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
<td>102.248432</td>
<td>99.812887</td>
<td>2.555386</td>
<td>199.999931</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>Submandibular</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Two Cell Type</td>
<td>102.248432</td>
<td>99.812887</td>
<td>2.555386</td>
<td>199.999931</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>Submandibular</td>
<td>endothelial cell of vascular tree</td>
<td>Level Three Cell Type</td>
<td>30.935485</td>
<td>23.700211</td>
<td>2.540177</td>
<td>199.943992</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>Submandibular</td>
<td>endothelial cell of vascular tree</td>
<td>Level Two Cell Type</td>
<td>30.935485</td>
<td>23.700211</td>
<td>2.540177</td>
<td>199.943992</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>Tongue</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>37.316385</td>
<td>25.104034</td>
<td>2.438237</td>
<td>199.998506</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>Tongue</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
<td>66.095612</td>
<td>56.164157</td>
<td>2.815138</td>
<td>199.994900</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>Tongue</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Two Cell Type</td>
<td>66.095612</td>
<td>56.164157</td>
<td>2.815138</td>
<td>199.994900</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>Tongue</td>
<td>endothelial cell of vascular tree</td>
<td>Level Three Cell Type</td>
<td>48.574001</td>
<td>32.080680</td>
<td>2.438237</td>
<td>199.999050</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">24</th>
<td>Tongue</td>
<td>endothelial cell of vascular tree</td>
<td>Level Two Cell Type</td>
<td>48.574001</td>
<td>32.080680</td>
<td>2.438237</td>
<td>199.999050</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="level-one-cell-type-analysis" class="level3">
<h3 class="anchored" data-anchor-id="level-one-cell-type-analysis">Level One Cell Type Analysis</h3>
<div id="cell-31" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get mean, median, minimum, maximum distance per cell type in all unique regions.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>cell_type_level <span class="op">=</span> <span class="st">'Level One Cell Type'</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_type_level <span class="op">=</span> df_all_edges_with_cell_types[(df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type Level'</span>] <span class="op">==</span> cell_type_level) <span class="op">&amp;</span> (df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type'</span>] <span class="op">==</span> anchor_cell_type_dict[cell_type_level])]</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level <span class="op">=</span> df_all_edges_with_cell_type_level.groupby([cell_type_level, <span class="st">'Unique Region'</span>]).agg(</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>),</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>),</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    min_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'min'</span>),</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    max_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'max'</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">mean_distance</th>
<th data-quarto-table-cell-role="th">median_distance</th>
<th data-quarto-table-cell-role="th">min_distance</th>
<th data-quarto-table-cell-role="th">max_distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>epithelial cell</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>47.227324</td>
<td>39.939347</td>
<td>2.451530</td>
<td>199.035857</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>epithelial cell</td>
<td>Gingiva</td>
<td>44.140615</td>
<td>34.768144</td>
<td>0.010330</td>
<td>199.836547</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>epithelial cell</td>
<td>Parotid</td>
<td>26.585115</td>
<td>22.840156</td>
<td>0.017954</td>
<td>199.947587</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>epithelial cell</td>
<td>Submandibular</td>
<td>23.907224</td>
<td>20.577384</td>
<td>2.755449</td>
<td>199.833787</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>epithelial cell</td>
<td>Tongue</td>
<td>85.775049</td>
<td>79.378846</td>
<td>2.815138</td>
<td>199.990006</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>immune cell</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>24.581746</td>
<td>18.289273</td>
<td>2.400521</td>
<td>198.825866</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>immune cell</td>
<td>Gingiva</td>
<td>52.854768</td>
<td>40.612195</td>
<td>0.029228</td>
<td>199.932087</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>immune cell</td>
<td>Parotid</td>
<td>29.196625</td>
<td>22.425217</td>
<td>0.004528</td>
<td>199.996540</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>immune cell</td>
<td>Submandibular</td>
<td>27.443867</td>
<td>22.173182</td>
<td>2.549510</td>
<td>190.454122</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>immune cell</td>
<td>Tongue</td>
<td>26.795128</td>
<td>18.708086</td>
<td>2.800446</td>
<td>199.876143</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>mesenchymal cell</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>25.865052</td>
<td>18.751667</td>
<td>2.510976</td>
<td>190.343295</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>mesenchymal cell</td>
<td>Gingiva</td>
<td>41.454674</td>
<td>34.134295</td>
<td>0.127369</td>
<td>196.036100</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>mesenchymal cell</td>
<td>Parotid</td>
<td>24.717051</td>
<td>20.026233</td>
<td>0.009735</td>
<td>199.030058</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>mesenchymal cell</td>
<td>Submandibular</td>
<td>42.638145</td>
<td>32.175398</td>
<td>2.540177</td>
<td>199.943992</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>mesenchymal cell</td>
<td>Tongue</td>
<td>35.806762</td>
<td>26.742008</td>
<td>2.530316</td>
<td>199.998506</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>neural cell</td>
<td>Parotid</td>
<td>24.032759</td>
<td>20.332039</td>
<td>0.124848</td>
<td>191.137047</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>unknown cell</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>37.841632</td>
<td>25.530619</td>
<td>2.350532</td>
<td>199.920297</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>unknown cell</td>
<td>Gingiva</td>
<td>46.744610</td>
<td>36.358142</td>
<td>0.006517</td>
<td>199.814472</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>unknown cell</td>
<td>Parotid</td>
<td>30.671119</td>
<td>24.682478</td>
<td>0.015375</td>
<td>199.882778</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>unknown cell</td>
<td>Submandibular</td>
<td>31.722377</td>
<td>25.000625</td>
<td>2.720294</td>
<td>199.821445</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>unknown cell</td>
<td>Tongue</td>
<td>27.503129</td>
<td>20.065954</td>
<td>2.438237</td>
<td>199.924628</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-32" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top five and bottom five cell types with respect to mean distance in each unique region separately.</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_top_bottom_cell_types_by_mean(df, cell_type_level, unique_region, top_n<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the DataFrame for the specified unique region and cell type level</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    df_filtered <span class="op">=</span> df[df[<span class="st">'Unique Region'</span>] <span class="op">==</span> unique_region]</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by the specified cell type level and calculate mean distance</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    df_grouped <span class="op">=</span> df_filtered.groupby(cell_type_level).agg(mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>)).reset_index()</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by mean distance to get top and bottom cell types</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    df_sorted <span class="op">=</span> df_grouped.sort_values(by<span class="op">=</span><span class="st">'mean_distance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get top N and bottom N cell types</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    top_cell_types <span class="op">=</span> df_sorted.head(top_n)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    bottom_cell_types <span class="op">=</span> df_sorted.tail(top_n)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> top_cell_types, bottom_cell_types</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_mean(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in Buccal Mucosa And Minor Salivary Glands:
  Level One Cell Type  mean_distance
0     epithelial cell      47.227324
3        unknown cell      37.841632
2    mesenchymal cell      25.865052
1         immune cell      24.581746

Bottom 5 cell types in Buccal Mucosa And Minor Salivary Glands:
  Level One Cell Type  mean_distance
0     epithelial cell      47.227324
3        unknown cell      37.841632
2    mesenchymal cell      25.865052
1         immune cell      24.581746

Top 5 cell types in Gingiva:
  Level One Cell Type  mean_distance
1         immune cell      52.854768
3        unknown cell      46.744610
0     epithelial cell      44.140615
2    mesenchymal cell      41.454674

Bottom 5 cell types in Gingiva:
  Level One Cell Type  mean_distance
1         immune cell      52.854768
3        unknown cell      46.744610
0     epithelial cell      44.140615
2    mesenchymal cell      41.454674

Top 5 cell types in Parotid:
  Level One Cell Type  mean_distance
4        unknown cell      30.671119
1         immune cell      29.196625
0     epithelial cell      26.585115
2    mesenchymal cell      24.717051
3         neural cell      24.032759

Bottom 5 cell types in Parotid:
  Level One Cell Type  mean_distance
4        unknown cell      30.671119
1         immune cell      29.196625
0     epithelial cell      26.585115
2    mesenchymal cell      24.717051
3         neural cell      24.032759

Top 5 cell types in Submandibular:
  Level One Cell Type  mean_distance
2    mesenchymal cell      42.638145
3        unknown cell      31.722377
1         immune cell      27.443867
0     epithelial cell      23.907224

Bottom 5 cell types in Submandibular:
  Level One Cell Type  mean_distance
2    mesenchymal cell      42.638145
3        unknown cell      31.722377
1         immune cell      27.443867
0     epithelial cell      23.907224

Top 5 cell types in Tongue:
  Level One Cell Type  mean_distance
0     epithelial cell      85.775049
2    mesenchymal cell      35.806762
3        unknown cell      27.503129
1         immune cell      26.795128

Bottom 5 cell types in Tongue:
  Level One Cell Type  mean_distance
0     epithelial cell      85.775049
2    mesenchymal cell      35.806762
3        unknown cell      27.503129
1         immune cell      26.795128</code></pre>
</div>
</div>
<div id="cell-33" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top five and bottom five cell types with respect to median distance in each unique region separately.</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_top_bottom_cell_types_by_median(df, cell_type_level, unique_region, top_n<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the DataFrame for the specified unique region and cell type level</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    df_filtered <span class="op">=</span> df[df[<span class="st">'Unique Region'</span>] <span class="op">==</span> unique_region]</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by the specified cell type level and calculate median distance</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    df_grouped <span class="op">=</span> df_filtered.groupby(cell_type_level).agg(median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>)).reset_index()</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by median distance to get top and bottom cell types</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    df_sorted <span class="op">=</span> df_grouped.sort_values(by<span class="op">=</span><span class="st">'median_distance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get top N and bottom N cell types</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    top_cell_types <span class="op">=</span> df_sorted.head(top_n)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    bottom_cell_types <span class="op">=</span> df_sorted.tail(top_n)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> top_cell_types, bottom_cell_types</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_median(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in Buccal Mucosa And Minor Salivary Glands:
  Level One Cell Type  median_distance
0     epithelial cell        39.939347
3        unknown cell        25.530619
2    mesenchymal cell        18.751667
1         immune cell        18.289273

Bottom 5 cell types in Buccal Mucosa And Minor Salivary Glands:
  Level One Cell Type  median_distance
0     epithelial cell        39.939347
3        unknown cell        25.530619
2    mesenchymal cell        18.751667
1         immune cell        18.289273

Top 5 cell types in Gingiva:
  Level One Cell Type  median_distance
1         immune cell        40.612195
3        unknown cell        36.358142
0     epithelial cell        34.768144
2    mesenchymal cell        34.134295

Bottom 5 cell types in Gingiva:
  Level One Cell Type  median_distance
1         immune cell        40.612195
3        unknown cell        36.358142
0     epithelial cell        34.768144
2    mesenchymal cell        34.134295

Top 5 cell types in Parotid:
  Level One Cell Type  median_distance
4        unknown cell        24.682478
0     epithelial cell        22.840156
1         immune cell        22.425217
3         neural cell        20.332039
2    mesenchymal cell        20.026233

Bottom 5 cell types in Parotid:
  Level One Cell Type  median_distance
4        unknown cell        24.682478
0     epithelial cell        22.840156
1         immune cell        22.425217
3         neural cell        20.332039
2    mesenchymal cell        20.026233

Top 5 cell types in Submandibular:
  Level One Cell Type  median_distance
2    mesenchymal cell        32.175398
3        unknown cell        25.000625
1         immune cell        22.173182
0     epithelial cell        20.577384

Bottom 5 cell types in Submandibular:
  Level One Cell Type  median_distance
2    mesenchymal cell        32.175398
3        unknown cell        25.000625
1         immune cell        22.173182
0     epithelial cell        20.577384

Top 5 cell types in Tongue:
  Level One Cell Type  median_distance
0     epithelial cell        79.378846
2    mesenchymal cell        26.742008
3        unknown cell        20.065954
1         immune cell        18.708086

Bottom 5 cell types in Tongue:
  Level One Cell Type  median_distance
0     epithelial cell        79.378846
2    mesenchymal cell        26.742008
3        unknown cell        20.065954
1         immune cell        18.708086</code></pre>
</div>
</div>
<div id="cell-34" class="cell" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate regional variability</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_regional_variability(df_all_edges_with_cell_type_level, cell_type_level):</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""    Calculate regional variability for distances in the given DataFrame.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    regional_variability <span class="op">=</span> df_all_edges_with_cell_type_level.groupby(<span class="st">'Unique Region'</span>)[<span class="st">'Distance'</span>].agg([</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'mean'</span>, <span class="st">'mean'</span>),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'std'</span>, <span class="st">'std'</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    ]).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add CV as percentage</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    regional_variability[<span class="st">'CV (%)'</span>] <span class="op">=</span> (regional_variability[<span class="st">'std'</span>] <span class="op">/</span> regional_variability[<span class="st">'mean'</span>] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Regional Variability Analysis:"</span>)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Mean: Average distance in each region"</span>)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Std: Standard deviation of distances"</span>)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"CV: Coefficient of Variation (std/mean * 100%)"</span>)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(regional_variability)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate variability for each cell type</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    cell_type_variability <span class="op">=</span> df_all_edges_with_cell_type_level.groupby(cell_type_level)[<span class="st">'Distance'</span>].agg([</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'mean'</span>, <span class="st">'mean'</span>),</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'std'</span>, <span class="st">'std'</span>)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    ]).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add CV as percentage</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    cell_type_variability[<span class="st">'CV (%)'</span>] <span class="op">=</span> (cell_type_variability[<span class="st">'std'</span>] <span class="op">/</span> cell_type_variability[<span class="st">'mean'</span>] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Cell Type Variability Analysis (sorted by CV):"</span>)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(cell_type_variability.sort_values(<span class="st">'CV (%)'</span>, ascending<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>calculate_regional_variability(df_all_edges_with_cell_type_level, cell_type_level)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regional Variability Analysis:
Mean: Average distance in each region
Std: Standard deviation of distances
CV: Coefficient of Variation (std/mean * 100%)
                                          mean    std  CV (%)
Unique Region                                                
Buccal Mucosa And Minor Salivary Glands  32.79  30.43    92.8
Gingiva                                  46.04  35.92    78.0
Parotid                                  27.29  20.14    73.8
Submandibular                            30.27  25.72    85.0
Tongue                                   37.32  34.85    93.4

Cell Type Variability Analysis (sorted by CV):
                      mean    std  CV (%)
Level One Cell Type                      
epithelial cell      31.24  27.49    88.0
unknown cell         33.97  29.68    87.4
immune cell          28.45  24.84    87.3
mesenchymal cell     35.45  30.49    86.0
neural cell          24.03  18.50    77.0</code></pre>
</div>
</div>
<div id="cell-35" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the standard region sequence for plots</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>regions <span class="op">=</span> [<span class="st">'Gingiva'</span>, <span class="st">'Submandibular'</span>, <span class="st">'Parotid'</span>, <span class="st">'Tongue'</span>, <span class="st">'Buccal Mucosa And Minor Salivary Glands'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-36" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate Violin Plot</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_violin_cells_per_celltype(df_all_edges_with_cell_type_level, cell_type_level, output_dir, density_norm<span class="op">=</span><span class="st">'area'</span>):</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    sns.set_context(<span class="st">"notebook"</span>, rc<span class="op">=</span>{<span class="st">"grid.linewidth"</span>: <span class="dv">2</span>})</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    sns.violinplot(data<span class="op">=</span>df_all_edges_with_cell_type_level, x<span class="op">=</span>cell_type_level, y<span class="op">=</span><span class="st">"Distance"</span>, density_norm<span class="op">=</span>density_norm, common_norm<span class="op">=</span><span class="va">True</span>, cut<span class="op">=</span><span class="dv">0</span>, inner<span class="op">=</span><span class="st">"box"</span>, split<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span><span class="st">'Spectral'</span>, alpha<span class="op">=</span><span class="fl">.9</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    sns.set_theme(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    sns.set_context(<span class="st">"paper"</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    font_size <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    plt.legend(fontsize<span class="op">=</span>font_size)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Violin Plot of distances by </span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss"> (Density Normalization: </span><span class="sc">{</span>density_norm<span class="sc">}</span><span class="ss">)'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="ss">f'</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Distance (</span><span class="ch">\u03bc</span><span class="st">m)'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Increase font size for all text in the figure</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span>font_size)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span>font_size)</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_violin_cells_per_celltype_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>                bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>                pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_violin_cells_per_celltype_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>                bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>                pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>plot_violin_cells_per_celltype(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">'area'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06_distance_analysis__oralcavity-codex-czi_files/figure-html/cell-30-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-37" class="cell" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplots of distribution of distances by cell type and region.</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_distance_distribution_boxplots_by_region(df_all_edges_with_cell_type_level, cell_type_level, output_dir):</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">8</span>))</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create categorical type with only the regions that exist in the data</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    available_regions <span class="op">=</span> [r <span class="cf">for</span> r <span class="kw">in</span> regions <span class="cf">if</span> r <span class="kw">in</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()]</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>] <span class="op">=</span> pd.Categorical(</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>],</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>        categories<span class="op">=</span>available_regions,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>        ordered<span class="op">=</span><span class="va">True</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make box plot.</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(data<span class="op">=</span>df_all_edges_with_cell_type_level, x<span class="op">=</span>cell_type_level, y<span class="op">=</span><span class="st">'Distance'</span>, hue<span class="op">=</span><span class="st">'Unique Region'</span>, showfliers<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span><span class="st">'Spectral'</span>) <span class="co"># viridis or Spectral palette for better color distinction</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    font_size <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>, ha<span class="op">=</span><span class="st">'right'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span>font_size)</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Distribution of distances by </span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss"> and region'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="ss">f'</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Distance (</span><span class="ch">\u03bc</span><span class="st">m)'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_distance_distribution_boxplots_by_region_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_distance_distribution_boxplots_by_region_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_boxplots_by_region(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06_distance_analysis__oralcavity-codex-czi_files/figure-html/cell-31-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-38" class="cell" data-execution_count="31">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplots of distribution of distances by cell type and region.</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_distance_distribution_heatmap(df_all_edges_with_cell_type_level, cell_type_level, output_dir):</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    pivot_data <span class="op">=</span> df_all_edges_with_cell_type_level.pivot_table(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">'Distance'</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>cell_type_level,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">'Unique Region'</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    aggfunc<span class="op">=</span><span class="st">'median'</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(pivot_data, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.1f'</span>, cmap<span class="op">=</span><span class="st">'Spectral'</span>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Heatmap of median distances by </span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    font_size <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>, ha<span class="op">=</span><span class="st">'right'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span>font_size)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Unique Region'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="ss">f'</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_distance_distribution_heatmap_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_distance_distribution_heatmap_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_heatmap(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06_distance_analysis__oralcavity-codex-czi_files/figure-html/cell-32-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-39" class="cell" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate Violin Plot per unique region in both small intestine and large intestine. Create for all 8 regions as 8 subplots.</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_violin_plots_all_regions(df_all_edges_with_cell_type_level, cell_type_level, output_dir, density_norm<span class="op">=</span><span class="st">"area"</span>):</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    sns.set_context(<span class="st">"notebook"</span>, rc<span class="op">=</span>{<span class="st">"grid.linewidth"</span>: <span class="dv">1</span>})</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    font_size <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    fig, axs <span class="op">=</span> plt.subplots(<span class="dv">5</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">20</span>)) <span class="co"># Adjusted figsize for horizontal layout</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(<span class="ss">f'Distance distribution per </span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss"> in `</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">` (density normalization = </span><span class="sc">{</span>density_norm<span class="sc">}</span><span class="ss">)'</span>, fontsize<span class="op">=</span>font_size, y<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep the sequence of Cell Types consistent across plots.</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    cell_types <span class="op">=</span> <span class="bu">sorted</span>(df_all_edges_with_cell_type_level[cell_type_level].unique())</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a color palette based on the number of unique classes</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    color_palette <span class="op">=</span> sns.color_palette(<span class="st">"Spectral"</span>, n_colors<span class="op">=</span><span class="bu">len</span>(cell_types))</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a dictionary mapping class to color</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    class_color_dict <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(cell_types, color_palette))</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, region <span class="kw">in</span> <span class="bu">enumerate</span>(regions):</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>        data_reg <span class="op">=</span> df_all_edges_with_cell_type_level[df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>] <span class="op">==</span> region]</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>        sns.violinplot(data<span class="op">=</span>data_reg, x<span class="op">=</span>cell_type_level, y<span class="op">=</span><span class="st">"Distance"</span>, density_norm<span class="op">=</span>density_norm, common_norm<span class="op">=</span><span class="va">True</span>, cut<span class="op">=</span><span class="dv">0</span>, inner<span class="op">=</span><span class="st">"box"</span>, split<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span>class_color_dict, alpha<span class="op">=</span><span class="fl">.9</span>, ax<span class="op">=</span>axs[i], hue<span class="op">=</span>cell_type_level, legend<span class="op">=</span><span class="va">False</span>, order<span class="op">=</span>cell_types, fill<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>        axs[i].set_title(region, fontsize<span class="op">=</span>font_size)</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>        axs[i].set_xlabel(<span class="st">''</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>        axs[i].set_ylabel(<span class="st">'Distance (</span><span class="ch">\u03bc</span><span class="st">m)'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axs[i].tick_params(axis='x', labelrotation=90, labelsize=font_size)</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># only show xtick labels for the last subplot</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(regions) <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>            axs[i].set_xticklabels([])</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>            axs[i].set_xticklabels(cell_types, fontsize<span class="op">=</span>font_size, rotation<span class="op">=</span><span class="dv">90</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axs[i].set_ylim(0, data_reg['Distance'].max() * 1.1)  # Set y-limits to be consistent across all plots</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>        axs[i].tick_params(axis<span class="op">=</span><span class="st">'both'</span>, labelsize<span class="op">=</span>font_size)</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use fig.text for precise label positioning</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    fig.figure.text(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.02</span>, <span class="ss">f'</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_violin_plots_all_regions_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_violin_plots_all_regions_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>plot_violin_plots_all_regions(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">"count"</span>) <span class="co"># density_norm="count" or "area" can be used based on preference.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06_distance_analysis__oralcavity-codex-czi_files/figure-html/cell-33-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="level-two-cell-type-analysis" class="level3">
<h3 class="anchored" data-anchor-id="level-two-cell-type-analysis">Level Two Cell Type Analysis</h3>
<div id="cell-41" class="cell" data-execution_count="33">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get mean, median, minimum, maximum distance per cell type in all unique regions.</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>cell_type_level <span class="op">=</span> <span class="st">'Level Two Cell Type'</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_type_level <span class="op">=</span> df_all_edges_with_cell_types[(df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type Level'</span>] <span class="op">==</span> cell_type_level) <span class="op">&amp;</span> (df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type'</span>] <span class="op">==</span> anchor_cell_type_dict[cell_type_level])]</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level <span class="op">=</span> df_all_edges_with_cell_type_level.groupby([cell_type_level, <span class="st">'Unique Region'</span>]).agg(</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>),</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>),</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    min_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'min'</span>),</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    max_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'max'</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">mean_distance</th>
<th data-quarto-table-cell-role="th">median_distance</th>
<th data-quarto-table-cell-role="th">min_distance</th>
<th data-quarto-table-cell-role="th">max_distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>adipocyte</td>
<td>Gingiva</td>
<td>38.921484</td>
<td>31.576881</td>
<td>1.472765</td>
<td>198.358252</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>b cell</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>23.196496</td>
<td>22.353669</td>
<td>2.804015</td>
<td>98.284549</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>b cell</td>
<td>Gingiva</td>
<td>38.913598</td>
<td>29.370338</td>
<td>1.271453</td>
<td>198.729570</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>b cell</td>
<td>Parotid</td>
<td>22.649857</td>
<td>19.314031</td>
<td>0.004528</td>
<td>195.393503</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>b cell</td>
<td>Submandibular</td>
<td>49.468888</td>
<td>45.465234</td>
<td>3.304921</td>
<td>184.012207</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>b cell</td>
<td>Tongue</td>
<td>23.064363</td>
<td>15.471976</td>
<td>3.696282</td>
<td>119.542137</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>dendritic cell</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>23.820644</td>
<td>19.333714</td>
<td>2.753634</td>
<td>176.453535</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>dendritic cell</td>
<td>Gingiva</td>
<td>53.327090</td>
<td>40.886464</td>
<td>0.225297</td>
<td>199.932087</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>dendritic cell</td>
<td>Parotid</td>
<td>21.289953</td>
<td>19.328978</td>
<td>0.050563</td>
<td>154.155788</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>dendritic cell</td>
<td>Tongue</td>
<td>49.187117</td>
<td>32.105607</td>
<td>3.162278</td>
<td>199.890432</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>endothelial cell of lymphatic vessel</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>31.266348</td>
<td>23.013311</td>
<td>3.036445</td>
<td>188.564690</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>endothelial cell of lymphatic vessel</td>
<td>Gingiva</td>
<td>51.530766</td>
<td>47.521442</td>
<td>8.561243</td>
<td>143.755112</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>endothelial cell of lymphatic vessel</td>
<td>Parotid</td>
<td>27.392054</td>
<td>19.534840</td>
<td>0.253150</td>
<td>181.675452</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>endothelial cell of lymphatic vessel</td>
<td>Submandibular</td>
<td>23.177030</td>
<td>17.112130</td>
<td>3.412477</td>
<td>121.602436</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>endothelial cell of lymphatic vessel</td>
<td>Tongue</td>
<td>44.692616</td>
<td>34.740934</td>
<td>4.208622</td>
<td>199.544105</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>epithelial cell</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>69.005527</td>
<td>63.242607</td>
<td>3.006659</td>
<td>199.616482</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>epithelial cell</td>
<td>Gingiva</td>
<td>49.671535</td>
<td>37.195439</td>
<td>1.752795</td>
<td>198.377561</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>epithelial cell</td>
<td>Parotid</td>
<td>39.288368</td>
<td>29.149386</td>
<td>0.468023</td>
<td>199.229374</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>epithelial cell</td>
<td>Tongue</td>
<td>116.777509</td>
<td>126.256991</td>
<td>3.323402</td>
<td>199.987850</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>fibroblast</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>35.795373</td>
<td>25.141972</td>
<td>2.510976</td>
<td>199.696019</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>fibroblast</td>
<td>Gingiva</td>
<td>42.361864</td>
<td>34.901074</td>
<td>0.127369</td>
<td>198.612028</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>fibroblast</td>
<td>Parotid</td>
<td>26.934849</td>
<td>21.545359</td>
<td>0.009735</td>
<td>199.030058</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>fibroblast</td>
<td>Submandibular</td>
<td>43.476570</td>
<td>33.036249</td>
<td>2.540177</td>
<td>199.943992</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>fibroblast</td>
<td>Tongue</td>
<td>52.144835</td>
<td>37.926541</td>
<td>2.530316</td>
<td>199.999050</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">24</th>
<td>gland epithelium cell</td>
<td>Gingiva</td>
<td>38.872536</td>
<td>31.698348</td>
<td>0.029614</td>
<td>199.675802</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">25</th>
<td>gland epithelium cell</td>
<td>Parotid</td>
<td>26.186293</td>
<td>22.583455</td>
<td>0.017954</td>
<td>199.567157</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">26</th>
<td>gland epithelium cell</td>
<td>Submandibular</td>
<td>25.000346</td>
<td>21.156766</td>
<td>2.773536</td>
<td>199.833787</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">27</th>
<td>keratinocyte</td>
<td>Gingiva</td>
<td>53.520737</td>
<td>42.797847</td>
<td>0.010330</td>
<td>199.836547</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">28</th>
<td>keratinocyte</td>
<td>Parotid</td>
<td>29.006264</td>
<td>23.250918</td>
<td>0.042787</td>
<td>199.947587</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">29</th>
<td>langerhans cell</td>
<td>Gingiva</td>
<td>35.348131</td>
<td>26.245455</td>
<td>0.353423</td>
<td>166.645525</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">30</th>
<td>langerhans cell</td>
<td>Parotid</td>
<td>21.515277</td>
<td>18.679420</td>
<td>0.118568</td>
<td>151.121503</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">31</th>
<td>macrophage</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>25.882874</td>
<td>20.110103</td>
<td>2.995413</td>
<td>175.639439</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">32</th>
<td>macrophage</td>
<td>Gingiva</td>
<td>43.967814</td>
<td>35.395149</td>
<td>0.362944</td>
<td>196.376846</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">33</th>
<td>macrophage</td>
<td>Parotid</td>
<td>27.069626</td>
<td>22.910843</td>
<td>0.100367</td>
<td>196.269036</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">34</th>
<td>macrophage</td>
<td>Submandibular</td>
<td>30.757152</td>
<td>23.417995</td>
<td>3.103627</td>
<td>190.454122</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">35</th>
<td>macrophage</td>
<td>Tongue</td>
<td>34.170755</td>
<td>22.358667</td>
<td>2.800446</td>
<td>199.962253</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">36</th>
<td>mast cell</td>
<td>Gingiva</td>
<td>45.118725</td>
<td>32.004082</td>
<td>0.283616</td>
<td>198.023632</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">37</th>
<td>mast cell</td>
<td>Parotid</td>
<td>55.949381</td>
<td>42.159777</td>
<td>0.497809</td>
<td>164.482230</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">38</th>
<td>muscle cell</td>
<td>Parotid</td>
<td>26.374298</td>
<td>22.262380</td>
<td>0.246935</td>
<td>196.110438</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">39</th>
<td>myoepithelial cell</td>
<td>Gingiva</td>
<td>33.597314</td>
<td>25.924170</td>
<td>0.499390</td>
<td>195.159907</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">40</th>
<td>myoepithelial cell</td>
<td>Parotid</td>
<td>31.860121</td>
<td>26.601561</td>
<td>0.027328</td>
<td>199.863760</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">41</th>
<td>myoepithelial cell</td>
<td>Submandibular</td>
<td>23.571161</td>
<td>20.641130</td>
<td>2.755449</td>
<td>136.143821</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">42</th>
<td>natural killer cell</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>46.769140</td>
<td>37.025667</td>
<td>3.381198</td>
<td>195.615196</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">43</th>
<td>natural killer cell</td>
<td>Gingiva</td>
<td>41.823514</td>
<td>29.657322</td>
<td>2.560580</td>
<td>189.288209</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">44</th>
<td>natural killer cell</td>
<td>Parotid</td>
<td>63.315905</td>
<td>54.364997</td>
<td>0.139128</td>
<td>198.587437</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">45</th>
<td>natural killer cell</td>
<td>Submandibular</td>
<td>25.280999</td>
<td>20.705518</td>
<td>3.148412</td>
<td>158.294820</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">46</th>
<td>natural killer cell</td>
<td>Tongue</td>
<td>47.527685</td>
<td>42.494294</td>
<td>3.064719</td>
<td>197.964770</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">47</th>
<td>neuroglial cell/neuron</td>
<td>Parotid</td>
<td>24.591434</td>
<td>20.583996</td>
<td>0.124848</td>
<td>191.137047</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">48</th>
<td>neutrophil</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>30.028958</td>
<td>21.579446</td>
<td>2.554408</td>
<td>194.583330</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">49</th>
<td>neutrophil</td>
<td>Gingiva</td>
<td>46.213377</td>
<td>32.192202</td>
<td>0.029228</td>
<td>199.542077</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">50</th>
<td>neutrophil</td>
<td>Parotid</td>
<td>44.659693</td>
<td>34.148935</td>
<td>18.784102</td>
<td>87.823018</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">51</th>
<td>neutrophil</td>
<td>Submandibular</td>
<td>21.857157</td>
<td>19.521302</td>
<td>2.968164</td>
<td>164.314371</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">52</th>
<td>neutrophil</td>
<td>Tongue</td>
<td>34.321570</td>
<td>22.459853</td>
<td>3.085855</td>
<td>199.231084</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">53</th>
<td>perivascular cell</td>
<td>Parotid</td>
<td>21.881249</td>
<td>18.707282</td>
<td>0.068190</td>
<td>166.700706</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">54</th>
<td>t cell</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>38.797999</td>
<td>28.289618</td>
<td>3.026549</td>
<td>198.825866</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">55</th>
<td>t cell</td>
<td>Gingiva</td>
<td>61.869930</td>
<td>49.247660</td>
<td>0.094913</td>
<td>199.784633</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">56</th>
<td>t cell</td>
<td>Parotid</td>
<td>40.798968</td>
<td>31.956611</td>
<td>0.043842</td>
<td>199.996540</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">57</th>
<td>t cell</td>
<td>Submandibular</td>
<td>31.282386</td>
<td>27.361812</td>
<td>2.549510</td>
<td>187.306834</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">58</th>
<td>t cell</td>
<td>Tongue</td>
<td>60.348191</td>
<td>45.091157</td>
<td>2.951694</td>
<td>199.994831</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">59</th>
<td>unknown cell</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>42.374333</td>
<td>28.831450</td>
<td>2.350532</td>
<td>199.920297</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">60</th>
<td>unknown cell</td>
<td>Gingiva</td>
<td>47.466793</td>
<td>36.770012</td>
<td>0.006517</td>
<td>199.814472</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">61</th>
<td>unknown cell</td>
<td>Parotid</td>
<td>32.154130</td>
<td>25.431573</td>
<td>0.015375</td>
<td>199.882778</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">62</th>
<td>unknown cell</td>
<td>Submandibular</td>
<td>32.777522</td>
<td>25.710163</td>
<td>2.720294</td>
<td>199.821445</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">63</th>
<td>unknown cell</td>
<td>Tongue</td>
<td>33.290598</td>
<td>23.558730</td>
<td>2.438237</td>
<td>199.998125</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-42" class="cell" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_mean(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in Buccal Mucosa And Minor Salivary Glands:
   Level Two Cell Type  mean_distance
3      epithelial cell      69.005527
6  natural killer cell      46.769140
9         unknown cell      42.374333
8               t cell      38.797999
4           fibroblast      35.795373

Bottom 5 cell types in Buccal Mucosa And Minor Salivary Glands:
                    Level Two Cell Type  mean_distance
2  endothelial cell of lymphatic vessel      31.266348
7                            neutrophil      30.028958
5                            macrophage      25.882874
1                        dendritic cell      23.820644
0                                b cell      23.196496

Top 5 cell types in Gingiva:
                     Level Two Cell Type  mean_distance
14                                t cell      61.869930
7                           keratinocyte      53.520737
2                         dendritic cell      53.327090
3   endothelial cell of lymphatic vessel      51.530766
4                        epithelial cell      49.671535

Bottom 5 cell types in Gingiva:
      Level Two Cell Type  mean_distance
0               adipocyte      38.921484
1                  b cell      38.913598
6   gland epithelium cell      38.872536
8         langerhans cell      35.348131
11     myoepithelial cell      33.597314

Top 5 cell types in Parotid:
    Level Two Cell Type  mean_distance
12  natural killer cell      63.315905
9             mast cell      55.949381
14           neutrophil      44.659693
16               t cell      40.798968
3       epithelial cell      39.288368

Bottom 5 cell types in Parotid:
       Level Two Cell Type  mean_distance
13  neuroglial cell/neuron      24.591434
0                   b cell      22.649857
15       perivascular cell      21.881249
7          langerhans cell      21.515277
1           dendritic cell      21.289953

Top 5 cell types in Submandibular:
  Level Two Cell Type  mean_distance
0              b cell      49.468888
2          fibroblast      43.476570
9        unknown cell      32.777522
8              t cell      31.282386
4          macrophage      30.757152

Bottom 5 cell types in Submandibular:
                    Level Two Cell Type  mean_distance
6                   natural killer cell      25.280999
3                 gland epithelium cell      25.000346
5                    myoepithelial cell      23.571161
1  endothelial cell of lymphatic vessel      23.177030
7                            neutrophil      21.857157

Top 5 cell types in Tongue:
   Level Two Cell Type  mean_distance
3      epithelial cell     116.777509
8               t cell      60.348191
4           fibroblast      52.144835
1       dendritic cell      49.187117
6  natural killer cell      47.527685

Bottom 5 cell types in Tongue:
                    Level Two Cell Type  mean_distance
2  endothelial cell of lymphatic vessel      44.692616
7                            neutrophil      34.321570
5                            macrophage      34.170755
9                          unknown cell      33.290598
0                                b cell      23.064363</code></pre>
</div>
</div>
<div id="cell-43" class="cell" data-execution_count="35">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_median(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in Buccal Mucosa And Minor Salivary Glands:
   Level Two Cell Type  median_distance
3      epithelial cell        63.242607
6  natural killer cell        37.025667
9         unknown cell        28.831450
8               t cell        28.289618
4           fibroblast        25.141972

Bottom 5 cell types in Buccal Mucosa And Minor Salivary Glands:
                    Level Two Cell Type  median_distance
2  endothelial cell of lymphatic vessel        23.013311
0                                b cell        22.353669
7                            neutrophil        21.579446
5                            macrophage        20.110103
1                        dendritic cell        19.333714

Top 5 cell types in Gingiva:
                     Level Two Cell Type  median_distance
14                                t cell        49.247660
3   endothelial cell of lymphatic vessel        47.521442
7                           keratinocyte        42.797847
2                         dendritic cell        40.886464
4                        epithelial cell        37.195439

Bottom 5 cell types in Gingiva:
    Level Two Cell Type  median_distance
0             adipocyte        31.576881
12  natural killer cell        29.657322
1                b cell        29.370338
8       langerhans cell        26.245455
11   myoepithelial cell        25.924170

Top 5 cell types in Parotid:
    Level Two Cell Type  median_distance
12  natural killer cell        54.364997
9             mast cell        42.159777
14           neutrophil        34.148935
16               t cell        31.956611
3       epithelial cell        29.149386

Bottom 5 cell types in Parotid:
                     Level Two Cell Type  median_distance
2   endothelial cell of lymphatic vessel        19.534840
1                         dendritic cell        19.328978
0                                 b cell        19.314031
15                     perivascular cell        18.707282
7                        langerhans cell        18.679420

Top 5 cell types in Submandibular:
  Level Two Cell Type  median_distance
0              b cell        45.465234
2          fibroblast        33.036249
8              t cell        27.361812
9        unknown cell        25.710163
4          macrophage        23.417995

Bottom 5 cell types in Submandibular:
                    Level Two Cell Type  median_distance
3                 gland epithelium cell        21.156766
6                   natural killer cell        20.705518
5                    myoepithelial cell        20.641130
7                            neutrophil        19.521302
1  endothelial cell of lymphatic vessel        17.112130

Top 5 cell types in Tongue:
                    Level Two Cell Type  median_distance
3                       epithelial cell       126.256991
8                                t cell        45.091157
6                   natural killer cell        42.494294
4                            fibroblast        37.926541
2  endothelial cell of lymphatic vessel        34.740934

Bottom 5 cell types in Tongue:
  Level Two Cell Type  median_distance
1      dendritic cell        32.105607
9        unknown cell        23.558730
7          neutrophil        22.459853
5          macrophage        22.358667
0              b cell        15.471976</code></pre>
</div>
</div>
<div id="cell-44" class="cell" data-execution_count="36">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>calculate_regional_variability(df_all_edges_with_cell_type_level, cell_type_level)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regional Variability Analysis:
Mean: Average distance in each region
Std: Standard deviation of distances
CV: Coefficient of Variation (std/mean * 100%)
                                          mean    std  CV (%)
Unique Region                                                
Buccal Mucosa And Minor Salivary Glands  41.16  37.14    90.2
Gingiva                                  46.82  36.63    78.2
Parotid                                  28.23  21.27    75.3
Submandibular                            30.94  26.10    84.4
Tongue                                   48.57  44.56    91.7

Cell Type Variability Analysis (sorted by CV):
                                       mean    std  CV (%)
Level Two Cell Type                                       
dendritic cell                        37.36  37.48   100.3
macrophage                            32.67  30.91    94.6
fibroblast                            44.68  39.07    87.4
unknown cell                          36.94  31.98    86.6
mast cell                             46.79  40.10    85.7
keratinocyte                          40.74  34.66    85.1
neutrophil                            25.91  21.90    84.5
t cell                                44.40  37.45    84.3
langerhans cell                       23.62  19.63    83.1
endothelial cell of lymphatic vessel  40.28  33.01    82.0
muscle cell                           26.37  21.33    80.9
b cell                                32.21  25.19    78.2
neuroglial cell/neuron                24.59  19.04    77.4
natural killer cell                   47.10  35.86    76.1
adipocyte                             38.92  28.83    74.1
perivascular cell                     21.88  16.15    73.8
myoepithelial cell                    27.09  19.05    70.3
gland epithelium cell                 26.30  17.81    67.7
epithelial cell                       94.96  57.84    60.9</code></pre>
</div>
</div>
<div id="cell-45" class="cell" data-execution_count="37">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>plot_violin_cells_per_celltype(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">'area'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06_distance_analysis__oralcavity-codex-czi_files/figure-html/cell-38-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-46" class="cell" data-execution_count="38">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_boxplots_by_region(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06_distance_analysis__oralcavity-codex-czi_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-47" class="cell" data-execution_count="39">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_heatmap(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06_distance_analysis__oralcavity-codex-czi_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-48" class="cell" data-execution_count="40">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>plot_violin_plots_all_regions(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">"count"</span>) <span class="co"># Or, density_norm="count" or "area" based on preference.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06_distance_analysis__oralcavity-codex-czi_files/figure-html/cell-41-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="level-three-cell-type-analysis" class="level3">
<h3 class="anchored" data-anchor-id="level-three-cell-type-analysis">Level Three Cell Type Analysis</h3>
<div id="cell-50" class="cell" data-execution_count="41">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get mean, median, minimum, maximum distance per cell type in all unique regions.</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>cell_type_level <span class="op">=</span> <span class="st">'Level Three Cell Type'</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_type_level <span class="op">=</span> df_all_edges_with_cell_types[(df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type Level'</span>] <span class="op">==</span> cell_type_level) <span class="op">&amp;</span> (df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type'</span>] <span class="op">==</span> anchor_cell_type_dict[cell_type_level])]</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level <span class="op">=</span> df_all_edges_with_cell_type_level.groupby([cell_type_level, <span class="st">'Unique Region'</span>]).agg(</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>),</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>),</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    min_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'min'</span>),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    max_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'max'</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">mean_distance</th>
<th data-quarto-table-cell-role="th">median_distance</th>
<th data-quarto-table-cell-role="th">min_distance</th>
<th data-quarto-table-cell-role="th">max_distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>acinar cell of salivary gland</td>
<td>Gingiva</td>
<td>36.739726</td>
<td>30.877582</td>
<td>0.029614</td>
<td>198.327899</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>acinar cell of salivary gland</td>
<td>Parotid</td>
<td>26.180957</td>
<td>22.977472</td>
<td>0.017954</td>
<td>199.271997</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>acinar cell of salivary gland</td>
<td>Submandibular</td>
<td>25.430226</td>
<td>22.379846</td>
<td>3.106445</td>
<td>198.710172</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>adipocyte</td>
<td>Gingiva</td>
<td>38.921484</td>
<td>31.576881</td>
<td>1.472765</td>
<td>198.358252</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>b cell</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>23.196496</td>
<td>22.353669</td>
<td>2.804015</td>
<td>98.284549</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>b cell</td>
<td>Gingiva</td>
<td>38.913598</td>
<td>29.370338</td>
<td>1.271453</td>
<td>198.729570</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>b cell</td>
<td>Parotid</td>
<td>24.002071</td>
<td>20.842505</td>
<td>0.004528</td>
<td>194.426806</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>b cell</td>
<td>Submandibular</td>
<td>49.468888</td>
<td>45.465234</td>
<td>3.304921</td>
<td>184.012207</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>b cell</td>
<td>Tongue</td>
<td>23.064363</td>
<td>15.471976</td>
<td>3.696282</td>
<td>119.542137</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>dendritic cell</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>23.820644</td>
<td>19.333714</td>
<td>2.753634</td>
<td>176.453535</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>dendritic cell</td>
<td>Gingiva</td>
<td>53.327090</td>
<td>40.886464</td>
<td>0.225297</td>
<td>199.932087</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>dendritic cell</td>
<td>Parotid</td>
<td>21.289953</td>
<td>19.328978</td>
<td>0.050563</td>
<td>154.155788</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>dendritic cell</td>
<td>Tongue</td>
<td>49.187117</td>
<td>32.105607</td>
<td>3.162278</td>
<td>199.890432</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>endothelial cell of lymphatic vessel</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>31.266348</td>
<td>23.013311</td>
<td>3.036445</td>
<td>188.564690</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>endothelial cell of lymphatic vessel</td>
<td>Gingiva</td>
<td>51.530766</td>
<td>47.521442</td>
<td>8.561243</td>
<td>143.755112</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>endothelial cell of lymphatic vessel</td>
<td>Parotid</td>
<td>27.392054</td>
<td>19.534840</td>
<td>0.253150</td>
<td>181.675452</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>endothelial cell of lymphatic vessel</td>
<td>Submandibular</td>
<td>23.177030</td>
<td>17.112130</td>
<td>3.412477</td>
<td>121.602436</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>endothelial cell of lymphatic vessel</td>
<td>Tongue</td>
<td>44.692616</td>
<td>34.740934</td>
<td>4.208622</td>
<td>199.544105</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>epithelial cell</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>69.005527</td>
<td>63.242607</td>
<td>3.006659</td>
<td>199.616482</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>epithelial cell</td>
<td>Gingiva</td>
<td>49.671535</td>
<td>37.195439</td>
<td>1.752795</td>
<td>198.377561</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>epithelial cell</td>
<td>Parotid</td>
<td>39.288368</td>
<td>29.149386</td>
<td>0.468023</td>
<td>199.229374</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>epithelial cell</td>
<td>Tongue</td>
<td>116.777509</td>
<td>126.256991</td>
<td>3.323402</td>
<td>199.987850</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>epithelial cell:ductal</td>
<td>Gingiva</td>
<td>42.560340</td>
<td>33.553722</td>
<td>0.238018</td>
<td>199.675802</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>epithelial cell:ductal</td>
<td>Parotid</td>
<td>26.200793</td>
<td>21.407199</td>
<td>0.037888</td>
<td>199.567157</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">24</th>
<td>epithelial cell:ductal</td>
<td>Submandibular</td>
<td>24.609401</td>
<td>20.199691</td>
<td>2.773536</td>
<td>199.833787</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">25</th>
<td>fibroblast</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>35.795373</td>
<td>25.141972</td>
<td>2.510976</td>
<td>199.696019</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">26</th>
<td>fibroblast</td>
<td>Gingiva</td>
<td>42.361864</td>
<td>34.901074</td>
<td>0.127369</td>
<td>198.612028</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">27</th>
<td>fibroblast</td>
<td>Parotid</td>
<td>25.985495</td>
<td>20.910105</td>
<td>0.009735</td>
<td>199.030058</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">28</th>
<td>fibroblast</td>
<td>Submandibular</td>
<td>45.426189</td>
<td>35.755874</td>
<td>2.540177</td>
<td>199.943992</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">29</th>
<td>fibroblast</td>
<td>Tongue</td>
<td>52.144835</td>
<td>37.926541</td>
<td>2.530316</td>
<td>199.999050</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">30</th>
<td>glial cell/neuron</td>
<td>Parotid</td>
<td>24.591434</td>
<td>20.583996</td>
<td>0.124848</td>
<td>191.137047</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">31</th>
<td>keratinocyte</td>
<td>Gingiva</td>
<td>53.520737</td>
<td>42.797847</td>
<td>0.010330</td>
<td>199.836547</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">32</th>
<td>keratinocyte</td>
<td>Parotid</td>
<td>29.006264</td>
<td>23.250918</td>
<td>0.042787</td>
<td>199.947587</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">33</th>
<td>langerhans cell</td>
<td>Gingiva</td>
<td>35.348131</td>
<td>26.245455</td>
<td>0.353423</td>
<td>166.645525</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">34</th>
<td>langerhans cell</td>
<td>Parotid</td>
<td>21.515277</td>
<td>18.679420</td>
<td>0.118568</td>
<td>151.121503</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">35</th>
<td>macrophage</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>25.882874</td>
<td>20.110103</td>
<td>2.995413</td>
<td>175.639439</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">36</th>
<td>macrophage</td>
<td>Gingiva</td>
<td>43.967814</td>
<td>35.395149</td>
<td>0.362944</td>
<td>196.376846</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">37</th>
<td>macrophage</td>
<td>Parotid</td>
<td>33.360746</td>
<td>28.845995</td>
<td>3.541892</td>
<td>123.118246</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">38</th>
<td>macrophage</td>
<td>Submandibular</td>
<td>30.757152</td>
<td>23.417995</td>
<td>3.103627</td>
<td>190.454122</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">39</th>
<td>macrophage</td>
<td>Tongue</td>
<td>34.170755</td>
<td>22.358667</td>
<td>2.800446</td>
<td>199.962253</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">40</th>
<td>mast cell</td>
<td>Gingiva</td>
<td>45.118725</td>
<td>32.004082</td>
<td>0.283616</td>
<td>198.023632</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">41</th>
<td>mast cell</td>
<td>Parotid</td>
<td>55.949381</td>
<td>42.159777</td>
<td>0.497809</td>
<td>164.482230</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">42</th>
<td>monocyte</td>
<td>Parotid</td>
<td>26.785779</td>
<td>22.590948</td>
<td>0.100367</td>
<td>196.269036</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">43</th>
<td>mural cell</td>
<td>Parotid</td>
<td>21.881249</td>
<td>18.707282</td>
<td>0.068190</td>
<td>166.700706</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">44</th>
<td>muscle cell:skeletal</td>
<td>Parotid</td>
<td>26.374298</td>
<td>22.262380</td>
<td>0.246935</td>
<td>196.110438</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">45</th>
<td>myoepithelial cell</td>
<td>Gingiva</td>
<td>33.597314</td>
<td>25.924170</td>
<td>0.499390</td>
<td>195.159907</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">46</th>
<td>myoepithelial cell</td>
<td>Parotid</td>
<td>31.860121</td>
<td>26.601561</td>
<td>0.027328</td>
<td>199.863760</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">47</th>
<td>myoepithelial cell</td>
<td>Submandibular</td>
<td>23.571161</td>
<td>20.641130</td>
<td>2.755449</td>
<td>136.143821</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">48</th>
<td>myofibroblast</td>
<td>Parotid</td>
<td>32.692357</td>
<td>25.995240</td>
<td>2.804015</td>
<td>184.105520</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">49</th>
<td>myofibroblast</td>
<td>Submandibular</td>
<td>37.834254</td>
<td>27.126555</td>
<td>2.890069</td>
<td>199.916633</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">50</th>
<td>natural killer cell</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>46.769140</td>
<td>37.025667</td>
<td>3.381198</td>
<td>195.615196</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">51</th>
<td>natural killer cell</td>
<td>Gingiva</td>
<td>41.823514</td>
<td>29.657322</td>
<td>2.560580</td>
<td>189.288209</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">52</th>
<td>natural killer cell</td>
<td>Parotid</td>
<td>63.315905</td>
<td>54.364997</td>
<td>0.139128</td>
<td>198.587437</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">53</th>
<td>natural killer cell</td>
<td>Submandibular</td>
<td>25.280999</td>
<td>20.705518</td>
<td>3.148412</td>
<td>158.294820</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">54</th>
<td>natural killer cell</td>
<td>Tongue</td>
<td>47.527685</td>
<td>42.494294</td>
<td>3.064719</td>
<td>197.964770</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">55</th>
<td>neutrophil</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>30.028958</td>
<td>21.579446</td>
<td>2.554408</td>
<td>194.583330</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">56</th>
<td>neutrophil</td>
<td>Gingiva</td>
<td>46.213377</td>
<td>32.192202</td>
<td>0.029228</td>
<td>199.542077</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">57</th>
<td>neutrophil</td>
<td>Parotid</td>
<td>44.659693</td>
<td>34.148935</td>
<td>18.784102</td>
<td>87.823018</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">58</th>
<td>neutrophil</td>
<td>Submandibular</td>
<td>21.857157</td>
<td>19.521302</td>
<td>2.968164</td>
<td>164.314371</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">59</th>
<td>neutrophil</td>
<td>Tongue</td>
<td>34.321570</td>
<td>22.459853</td>
<td>3.085855</td>
<td>199.231084</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">60</th>
<td>plasma cell</td>
<td>Parotid</td>
<td>21.626882</td>
<td>17.710427</td>
<td>0.038203</td>
<td>195.393503</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">61</th>
<td>t cell</td>
<td>Parotid</td>
<td>25.638718</td>
<td>21.043274</td>
<td>0.043842</td>
<td>184.558144</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">62</th>
<td>t cell:cd4+</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>38.785521</td>
<td>29.526032</td>
<td>3.226841</td>
<td>189.937523</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">63</th>
<td>t cell:cd4+</td>
<td>Gingiva</td>
<td>43.033934</td>
<td>32.807020</td>
<td>0.094913</td>
<td>196.281616</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">64</th>
<td>t cell:cd4+</td>
<td>Parotid</td>
<td>48.489673</td>
<td>36.242813</td>
<td>1.426787</td>
<td>198.546619</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">65</th>
<td>t cell:cd4+</td>
<td>Submandibular</td>
<td>40.572532</td>
<td>37.560784</td>
<td>3.342529</td>
<td>187.306834</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">66</th>
<td>t cell:cd4+</td>
<td>Tongue</td>
<td>56.815946</td>
<td>42.660169</td>
<td>2.951694</td>
<td>199.931813</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">67</th>
<td>t cell:cd8+</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>33.406082</td>
<td>24.008696</td>
<td>3.083018</td>
<td>196.505044</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">68</th>
<td>t cell:cd8+</td>
<td>Gingiva</td>
<td>64.303943</td>
<td>52.379107</td>
<td>0.150396</td>
<td>199.784633</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">69</th>
<td>t cell:cd8+</td>
<td>Parotid</td>
<td>44.306240</td>
<td>33.225023</td>
<td>0.106672</td>
<td>199.996540</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">70</th>
<td>t cell:cd8+</td>
<td>Submandibular</td>
<td>23.920693</td>
<td>21.025193</td>
<td>2.549510</td>
<td>136.845259</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">71</th>
<td>t cell:cd8+</td>
<td>Tongue</td>
<td>78.353407</td>
<td>70.255983</td>
<td>4.000000</td>
<td>199.529259</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">72</th>
<td>t cell:regulatory</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>40.665551</td>
<td>30.033398</td>
<td>3.026549</td>
<td>198.825866</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">73</th>
<td>t cell:regulatory</td>
<td>Parotid</td>
<td>38.177654</td>
<td>32.661321</td>
<td>3.010399</td>
<td>198.026242</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">74</th>
<td>t cell:regulatory</td>
<td>Submandibular</td>
<td>33.265373</td>
<td>30.085399</td>
<td>2.798660</td>
<td>186.292868</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">75</th>
<td>t cell:regulatory</td>
<td>Tongue</td>
<td>54.034886</td>
<td>38.850515</td>
<td>3.112073</td>
<td>199.994831</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">76</th>
<td>thymocyte:cd4-intermediate cd8+ double-positive</td>
<td>Parotid</td>
<td>44.202736</td>
<td>37.229592</td>
<td>2.683282</td>
<td>199.631642</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">77</th>
<td>thymocyte:cd4-intermediate cd8+ double-positive</td>
<td>Submandibular</td>
<td>26.009947</td>
<td>22.290413</td>
<td>3.658210</td>
<td>117.123919</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">78</th>
<td>thymocyte:cd4-intermediate cd8+ double-positive</td>
<td>Tongue</td>
<td>62.981557</td>
<td>43.618355</td>
<td>5.628943</td>
<td>194.287583</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">79</th>
<td>unknown cell</td>
<td>Buccal Mucosa And Minor Salivary Glands</td>
<td>42.374333</td>
<td>28.831450</td>
<td>2.350532</td>
<td>199.920297</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">80</th>
<td>unknown cell</td>
<td>Gingiva</td>
<td>47.466793</td>
<td>36.770012</td>
<td>0.006517</td>
<td>199.814472</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">81</th>
<td>unknown cell</td>
<td>Parotid</td>
<td>32.154130</td>
<td>25.431573</td>
<td>0.015375</td>
<td>199.882778</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">82</th>
<td>unknown cell</td>
<td>Submandibular</td>
<td>32.777522</td>
<td>25.710163</td>
<td>2.720294</td>
<td>199.821445</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">83</th>
<td>unknown cell</td>
<td>Tongue</td>
<td>33.290598</td>
<td>23.558730</td>
<td>2.438237</td>
<td>199.998125</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-51" class="cell" data-execution_count="42">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_mean(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in Buccal Mucosa And Minor Salivary Glands:
   Level Three Cell Type  mean_distance
3        epithelial cell      69.005527
6    natural killer cell      46.769140
11          unknown cell      42.374333
10     t cell:regulatory      40.665551
8            t cell:cd4+      38.785521

Bottom 5 cell types in Buccal Mucosa And Minor Salivary Glands:
                  Level Three Cell Type  mean_distance
2  endothelial cell of lymphatic vessel      31.266348
7                            neutrophil      30.028958
5                            macrophage      25.882874
1                        dendritic cell      23.820644
0                                b cell      23.196496

Top 5 cell types in Gingiva:
                   Level Three Cell Type  mean_distance
16                           t cell:cd8+      64.303943
8                           keratinocyte      53.520737
3                         dendritic cell      53.327090
4   endothelial cell of lymphatic vessel      51.530766
5                        epithelial cell      49.671535

Bottom 5 cell types in Gingiva:
            Level Three Cell Type  mean_distance
1                       adipocyte      38.921484
2                          b cell      38.913598
0   acinar cell of salivary gland      36.739726
9                 langerhans cell      35.348131
12             myoepithelial cell      33.597314

Top 5 cell types in Parotid:
   Level Three Cell Type  mean_distance
17   natural killer cell      63.315905
11             mast cell      55.949381
21           t cell:cd4+      48.489673
18            neutrophil      44.659693
22           t cell:cd8+      44.306240

Bottom 5 cell types in Parotid:
   Level Three Cell Type  mean_distance
1                 b cell      24.002071
13            mural cell      21.881249
19           plasma cell      21.626882
9        langerhans cell      21.515277
2         dendritic cell      21.289953

Top 5 cell types in Submandibular:
   Level Three Cell Type  mean_distance
1                 b cell      49.468888
4             fibroblast      45.426189
10           t cell:cd4+      40.572532
7          myofibroblast      37.834254
12     t cell:regulatory      33.265373

Bottom 5 cell types in Submandibular:
                   Level Three Cell Type  mean_distance
3                epithelial cell:ductal       24.609401
11                           t cell:cd8+      23.920693
6                     myoepithelial cell      23.571161
2   endothelial cell of lymphatic vessel      23.177030
9                             neutrophil      21.857157

Top 5 cell types in Tongue:
                              Level Three Cell Type  mean_distance
3                                   epithelial cell     116.777509
9                                       t cell:cd8+      78.353407
11  thymocyte:cd4-intermediate cd8+ double-positive      62.981557
8                                       t cell:cd4+      56.815946
10                                t cell:regulatory      54.034886

Bottom 5 cell types in Tongue:
                   Level Three Cell Type  mean_distance
2   endothelial cell of lymphatic vessel      44.692616
7                             neutrophil      34.321570
5                             macrophage      34.170755
12                          unknown cell      33.290598
0                                 b cell      23.064363</code></pre>
</div>
</div>
<div id="cell-52" class="cell" data-execution_count="43">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for each unique region in the dataset.</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>unique_regions <span class="op">=</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> unique_regions:</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    top_bottom <span class="op">=</span> get_top_bottom_cell_types_by_median(df_all_edges_with_cell_type_level, cell_type_level, region)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Top 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">0</span>])</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom 5 cell types in </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_bottom[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in Buccal Mucosa And Minor Salivary Glands:
   Level Three Cell Type  median_distance
3        epithelial cell        63.242607
6    natural killer cell        37.025667
10     t cell:regulatory        30.033398
8            t cell:cd4+        29.526032
11          unknown cell        28.831450

Bottom 5 cell types in Buccal Mucosa And Minor Salivary Glands:
                  Level Three Cell Type  median_distance
2  endothelial cell of lymphatic vessel        23.013311
0                                b cell        22.353669
7                            neutrophil        21.579446
5                            macrophage        20.110103
1                        dendritic cell        19.333714

Top 5 cell types in Gingiva:
                   Level Three Cell Type  median_distance
16                           t cell:cd8+        52.379107
4   endothelial cell of lymphatic vessel        47.521442
8                           keratinocyte        42.797847
3                         dendritic cell        40.886464
5                        epithelial cell        37.195439

Bottom 5 cell types in Gingiva:
            Level Three Cell Type  median_distance
0   acinar cell of salivary gland        30.877582
13            natural killer cell        29.657322
2                          b cell        29.370338
9                 langerhans cell        26.245455
12             myoepithelial cell        25.924170

Top 5 cell types in Parotid:
                              Level Three Cell Type  median_distance
17                              natural killer cell        54.364997
11                                        mast cell        42.159777
24  thymocyte:cd4-intermediate cd8+ double-positive        37.229592
21                                      t cell:cd4+        36.242813
18                                       neutrophil        34.148935

Bottom 5 cell types in Parotid:
                   Level Three Cell Type  median_distance
3   endothelial cell of lymphatic vessel        19.534840
2                         dendritic cell        19.328978
13                            mural cell        18.707282
9                        langerhans cell        18.679420
19                           plasma cell        17.710427

Top 5 cell types in Submandibular:
   Level Three Cell Type  median_distance
1                 b cell        45.465234
10           t cell:cd4+        37.560784
4             fibroblast        35.755874
12     t cell:regulatory        30.085399
7          myofibroblast        27.126555

Bottom 5 cell types in Submandibular:
                  Level Three Cell Type  median_distance
8                   natural killer cell        20.705518
6                    myoepithelial cell        20.641130
3               epithelial cell:ductal         20.199691
9                            neutrophil        19.521302
2  endothelial cell of lymphatic vessel        17.112130

Top 5 cell types in Tongue:
                              Level Three Cell Type  median_distance
3                                   epithelial cell       126.256991
9                                       t cell:cd8+        70.255983
11  thymocyte:cd4-intermediate cd8+ double-positive        43.618355
8                                       t cell:cd4+        42.660169
6                               natural killer cell        42.494294

Bottom 5 cell types in Tongue:
   Level Three Cell Type  median_distance
1         dendritic cell        32.105607
12          unknown cell        23.558730
7             neutrophil        22.459853
5             macrophage        22.358667
0                 b cell        15.471976</code></pre>
</div>
</div>
<div id="cell-53" class="cell" data-execution_count="44">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>calculate_regional_variability(df_all_edges_with_cell_type_level, cell_type_level)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regional Variability Analysis:
Mean: Average distance in each region
Std: Standard deviation of distances
CV: Coefficient of Variation (std/mean * 100%)
                                          mean    std  CV (%)
Unique Region                                                
Buccal Mucosa And Minor Salivary Glands  41.16  37.14    90.2
Gingiva                                  46.82  36.63    78.2
Parotid                                  28.23  21.27    75.3
Submandibular                            30.94  26.10    84.4
Tongue                                   48.57  44.56    91.7

Cell Type Variability Analysis (sorted by CV):
                                                  mean    std  CV (%)
Level Three Cell Type                                                
dendritic cell                                   37.36  37.48   100.3
macrophage                                       32.99  31.34    95.0
myofibroblast                                    36.72  33.92    92.4
t cell:cd8+                                      46.75  41.83    89.5
fibroblast                                       45.47  39.46    86.8
unknown cell                                     36.94  31.98    86.6
mast cell                                        46.79  40.10    85.7
keratinocyte                                     40.74  34.66    85.1
neutrophil                                       25.91  21.90    84.5
langerhans cell                                  23.62  19.63    83.1
t cell:regulatory                                43.48  36.08    83.0
t cell                                           25.64  21.19    82.6
endothelial cell of lymphatic vessel             40.28  33.01    82.0
muscle cell:skeletal                             26.37  21.33    80.9
monocyte                                         26.79  20.86    77.9
t cell:cd4+                                      47.81  37.01    77.4
glial cell/neuron                                24.59  19.04    77.4
plasma cell                                      21.63  16.71    77.3
natural killer cell                              47.10  35.86    76.1
thymocyte:cd4-intermediate cd8+ double-positive  42.88  32.57    76.0
epithelial cell:ductal                           26.18  19.56    74.7
adipocyte                                        38.92  28.83    74.1
mural cell                                       21.88  16.15    73.8
b cell                                           37.32  26.94    72.2
myoepithelial cell                               27.09  19.05    70.3
acinar cell of salivary gland                    26.36  16.89    64.1
epithelial cell                                  94.96  57.84    60.9</code></pre>
</div>
</div>
<div id="cell-54" class="cell" data-execution_count="45">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>plot_violin_cells_per_celltype(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">'area'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06_distance_analysis__oralcavity-codex-czi_files/figure-html/cell-46-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-55" class="cell" data-execution_count="46">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_boxplots_by_region(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06_distance_analysis__oralcavity-codex-czi_files/figure-html/cell-47-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-56" class="cell" data-execution_count="47">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_heatmap(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06_distance_analysis__oralcavity-codex-czi_files/figure-html/cell-48-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-57" class="cell" data-execution_count="48">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>plot_violin_plots_all_regions(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">"count"</span>) <span class="co"># Or, density_norm="count" or "area" based on preference.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06_distance_analysis__oralcavity-codex-czi_files/figure-html/cell-49-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/cns-iu\.github\.io\/hra-cell-distance-analysis");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/cns-iu/hra-cell-distance-analysis/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>