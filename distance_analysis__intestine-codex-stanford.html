<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Analyze and visualize cell-to-nearest-endothelial-cell distance distributions for the codex-intestine-stanford dataset.">

<title>Distance Analysis: codex-intestine-stanford – HRA: Cell Distance Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-000f0825b9c55ed21d14970d810c14a9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Distance Analysis: codex-intestine-stanford – HRA: Cell Distance Analysis">
<meta property="og:description" content="Analyze and visualize cell-to-nearest-endothelial-cell distance distributions for the codex-intestine-stanford dataset.">
<meta property="og:image" content="https://cns-iu.github.io/hra-cell-distance-analysis/04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-24-output-1.png">
<meta property="og:site_name" content="HRA: Cell Distance Analysis">
<meta property="og:image:height" content="790">
<meta property="og:image:width" content="1389">
<meta name="twitter:title" content="Distance Analysis: codex-intestine-stanford – HRA: Cell Distance Analysis">
<meta name="twitter:description" content="Analyze and visualize cell-to-nearest-endothelial-cell distance distributions for the codex-intestine-stanford dataset.">
<meta name="twitter:image" content="https://cns-iu.github.io/hra-cell-distance-analysis/04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-24-output-1.png">
<meta name="twitter:image-height" content="790">
<meta name="twitter:image-width" content="1389">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">HRA: Cell Distance Analysis</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./distance_analysis__intestine-codex-stanford.html">Distance Analysis: codex-intestine-stanford</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cell Distance Analysis for Spatial Omics Datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_processing__convert_to_cde_format.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Processing: Convert to CDE Format</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_processing__crosswalk_cell_type_names.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Processing: Harmonize Cell Types</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_analysis__cell_distribution_across_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Analysis: Call Distribution Across Datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_processing__distance_computation_for_all_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Processing: Cell Distance Computation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__intestine-codex-stanford.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Distance Analysis: codex-intestine-stanford</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__pancreas-geomx-ufl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: pancreas-geomx-ufl</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__oralcavity-codex-czi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: oralcavity-codex-czi</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__lung-codex-urmc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: lung-codex-urmc</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__skin-confocal-sorgerlab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: skin-confocal-sorgerlab</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__bonemarrow-codex-chop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: bonemarrow-codex-chop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__colon-cycif-sorgerlab-colon-xenium-stanford.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: colon-xenium-stanford and colon-cycif-sorgerlab</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__lymphnode-codex-yale.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: lymphnode-codex-yale</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__spleen-codex-ufl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: spleen-codex-ufl</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__tonsil-codex-stanford-esophagus-codex-stanford.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: tonsil-codex-stanford and esophagus-codex-stanford</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__skin-celldive-ge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: skin-celldive-ge</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_analysis__maternalfetalinterface-mibitof-stanford.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Analysis: maternalfetalinterface-mibitof-stanford</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset." id="toc-get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset." class="nav-link active" data-scroll-target="#get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset.">Get initial statistics and identify endothelial cell categories for dataset.</a></li>
  <li><a href="#process-datasets-to-add-region-information-to-nodes-files." id="toc-process-datasets-to-add-region-information-to-nodes-files." class="nav-link" data-scroll-target="#process-datasets-to-add-region-information-to-nodes-files.">Process datasets to add region information to Nodes files.</a></li>
  <li><a href="#process-datasets-to-add-region-information-to-edges-files." id="toc-process-datasets-to-add-region-information-to-edges-files." class="nav-link" data-scroll-target="#process-datasets-to-add-region-information-to-edges-files.">Process datasets to add region information to Edges files.</a></li>
  <li><a href="#node-analysis" id="toc-node-analysis" class="nav-link" data-scroll-target="#node-analysis">Node Analysis</a></li>
  <li><a href="#distance-analysis" id="toc-distance-analysis" class="nav-link" data-scroll-target="#distance-analysis">Distance Analysis</a>
  <ul class="collapse">
  <li><a href="#level-one-cell-type-analysis" id="toc-level-one-cell-type-analysis" class="nav-link" data-scroll-target="#level-one-cell-type-analysis">Level One Cell Type Analysis</a></li>
  <li><a href="#level-two-cell-type-analysis" id="toc-level-two-cell-type-analysis" class="nav-link" data-scroll-target="#level-two-cell-type-analysis">Level Two Cell Type Analysis</a></li>
  <li><a href="#level-three-cell-type-analysis" id="toc-level-three-cell-type-analysis" class="nav-link" data-scroll-target="#level-three-cell-type-analysis">Level Three Cell Type Analysis</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/cns-iu/hra-cell-distance-analysis/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="distance_analysis__intestine-codex-stanford.html.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Distance Analysis: codex-intestine-stanford</h1>
</div>

<div>
  <div class="description">
    Analyze and visualize cell-to-nearest-endothelial-cell distance distributions for the <code>codex-intestine-stanford</code> dataset.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div id="cell-2" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> normalize</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> _cde_compute_edges_from_nodes <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="va">None</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="va">None</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># suppress warnings</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-3" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>basepath <span class="op">=</span> <span class="st">"/u/yashjain/hra-cell-distance-analysis/data"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dataset_dir <span class="op">=</span> <span class="st">"intestine-codex-stanford"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>data_filedir <span class="op">=</span> os.path.join(<span class="st">"data-processed-nodes-with-harmonized-cell-types"</span>, dataset_dir)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>output_edge_dir <span class="op">=</span> os.path.join(<span class="st">"data-processed-edges"</span>, dataset_dir)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>figures_output_dir <span class="op">=</span> <span class="st">"generated-figures"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-4" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to load your data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_data(path, edges<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> edges:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        column_names <span class="op">=</span> [<span class="st">'cell_id'</span>, <span class="st">'x1'</span>, <span class="st">'y1'</span>, <span class="st">'z1'</span>, <span class="st">'x2'</span>, <span class="st">'y2'</span>, <span class="st">'z2'</span>]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> pd.read_csv(path, header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>column_names)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> pd.read_csv(path)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-5" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to read all files ending with "-nodes.csv" in the `data_filedir` directory into a single DataFrame. </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Another additional column `Dataset` is added to identify the dataset name which comes from the filename before the `-nodes.csv` suffix.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Additionally, function reads all files ending with "-edges.csv" in the `output_edge_dir` directory into a single DataFrame. </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Three additional columns are added "Dataset", "Anchor Cell Type", and "Anchor Cell Type Level" to identify the dataset name, anchor cell type, and anchor cell type level respectively which come from the filename before the `.csv` suffix.</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The three additional columns are created by splitting the filename on the `-` character, and extracting the relevant parts.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># On splitting, the first part is the dataset name, second part is the anchor cell type level, and third part is the anchor cell type, and last part is the `edges` suffix.</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># When reading files, check if the file has the correct format (i.e., ends with `-edges.csv`).</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Additionally, the function merges the edges DataFrame with the nodes DataFrame to get the cell type information for the anchor cells.</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># This is done by reading the corresponding nodes file from the `data_filedir` directory for each edges file, and merging it with the edges DataFrame on the `cell_id` column.</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># The merged DataFrame contains the edges with additional columns for the cell type information.</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># The function returns three DataFrames:</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. `merged_nodes`: DataFrame containing all nodes with an additional column `Dataset`.</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. `merged_edges`: DataFrame containing all edges with additional columns `Dataset`, `Anchor Cell Type`, and `Anchor Cell Type Level`.</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. `merged_nodes_for_all_edges`: DataFrame containing all edges with additional columns `Dataset`, `Anchor Cell Type`, `Anchor Cell Type Level`, and the cell type information for cells.</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_all_edge_datasets(basepath, data_filedir, output_edge_dir):</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    all_nodes_files <span class="op">=</span> []</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    all_edges_files <span class="op">=</span> []</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    all_nodes_edges_files <span class="op">=</span> []</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir(os.path.join(basepath, output_edge_dir)):</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">"-edges.csv"</span>):</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            file_path <span class="op">=</span> os.path.join(basepath, output_edge_dir, <span class="bu">file</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>            dataset_name, anchor_cell_type_level, anchor_cell_type <span class="op">=</span> <span class="bu">file</span>.replace(<span class="st">"-edges.csv"</span>, <span class="st">""</span>).split(<span class="st">'-'</span>)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            edges_df <span class="op">=</span> load_data(file_path, edges<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>            edges_df[<span class="st">'Dataset'</span>] <span class="op">=</span> dataset_name</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            edges_df[<span class="st">'Anchor Cell Type'</span>] <span class="op">=</span> anchor_cell_type</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>            edges_df[<span class="st">'Anchor Cell Type Level'</span>] <span class="op">=</span> anchor_cell_type_level</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>            edges_df.rename(columns<span class="op">=</span>{<span class="st">"distance"</span>: <span class="st">"Distance"</span>}, inplace<span class="op">=</span><span class="va">True</span>) <span class="co"># Rename column "distance" to "Distance".</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>            all_edges_files.append(edges_df)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Read the corresponding nodes file from data_filedir to get the cell type information</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>            nodes_file_path <span class="op">=</span> os.path.join(basepath, data_filedir, <span class="ss">f"</span><span class="sc">{</span>dataset_name<span class="sc">}</span><span class="ss">-nodes.csv"</span>)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>            nodes_df <span class="op">=</span> load_data(nodes_file_path)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>            nodes_df[<span class="st">'Dataset'</span>] <span class="op">=</span> dataset_name</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>            all_nodes_files.append(nodes_df)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a new 'cell_id' column to nodes_df</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>            nodes_df[<span class="st">'cell_id'</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(nodes_df))</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Set 'cell_id' column as index for nodes_df</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>            nodes_df.set_index(<span class="st">'cell_id'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Merge edges_df with nodes_df to get the cell type information for the anchor cells</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>            edges_nodes_df <span class="op">=</span> pd.merge(edges_df, nodes_df[[<span class="st">'Level Three Cell Type'</span>, <span class="st">'Level Two Cell Type'</span>, <span class="st">'Level One Cell Type'</span>]], how<span class="op">=</span><span class="st">'left'</span>, left_on<span class="op">=</span><span class="st">'cell_id'</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>            all_nodes_edges_files.append(edges_nodes_df)</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    merged_edges <span class="op">=</span> pd.concat(all_edges_files, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    merged_nodes <span class="op">=</span> pd.concat(all_nodes_files, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    merged_nodes_for_all_edges <span class="op">=</span> pd.concat(all_nodes_edges_files, ignore_index<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merged_nodes, merged_edges, merged_nodes_for_all_edges</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-6" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_directory(directory):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(directory):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        os.makedirs(directory)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Directory '</span><span class="sc">{</span>directory<span class="sc">}</span><span class="ss">' created successfully."</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Directory '</span><span class="sc">{</span>directory<span class="sc">}</span><span class="ss">' already exists."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset." class="level2">
<h2 class="anchored" data-anchor-id="get-initial-statistics-and-identify-endothelial-cell-categories-for-dataset.">Get initial statistics and identify endothelial cell categories for dataset.</h2>
<div id="cell-8" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_all_nodes, df_all_edges, df_all_edges_with_cell_types <span class="op">=</span> read_all_edge_datasets(basepath, data_filedir, output_edge_dir)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-9" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df_all_nodes.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">Original Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three CL Label</th>
<th data-quarto-table-cell-role="th">Level Three CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/3</th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Level Two CL Label</th>
<th data-quarto-table-cell-role="th">Level Two CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/2</th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Level One CL Label</th>
<th data-quarto-table-cell-role="th">Level One CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/1</th>
<th data-quarto-table-cell-role="th">Dataset</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1503.64128</td>
<td>1278.32154</td>
<td>NK</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>immune cell</td>
<td>leukocyte</td>
<td>CL:0000738</td>
<td>skos:exactMatch</td>
<td>B004_Ascending</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1958.05496</td>
<td>1553.46072</td>
<td>NK</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>immune cell</td>
<td>leukocyte</td>
<td>CL:0000738</td>
<td>skos:exactMatch</td>
<td>B004_Ascending</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>2290.93940</td>
<td>1187.36332</td>
<td>NK</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>immune cell</td>
<td>leukocyte</td>
<td>CL:0000738</td>
<td>skos:exactMatch</td>
<td>B004_Ascending</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>2863.48554</td>
<td>891.08862</td>
<td>NK</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>immune cell</td>
<td>leukocyte</td>
<td>CL:0000738</td>
<td>skos:exactMatch</td>
<td>B004_Ascending</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>2563.43664</td>
<td>1468.54122</td>
<td>NK</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>immune cell</td>
<td>leukocyte</td>
<td>CL:0000738</td>
<td>skos:exactMatch</td>
<td>B004_Ascending</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-10" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the total number of unique cell types per dataset. Compute separately for each cell type column (Level One Cell Type, Level Two Cell Type, Level Three Cell Type, Original Cell Type).</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Total number of unique cell types per cell type annnotation level:"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>unique_cell_types <span class="op">=</span> {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Original Cell Type'</span>: df_all_nodes[<span class="st">'Original Cell Type'</span>].nunique(),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Three Cell Type'</span>: df_all_nodes[<span class="st">'Level Three Cell Type'</span>].nunique(),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Two Cell Type'</span>: df_all_nodes[<span class="st">'Level Two Cell Type'</span>].nunique(),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level One Cell Type'</span>: df_all_nodes[<span class="st">'Level One Cell Type'</span>].nunique()</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cell_type, count <span class="kw">in</span> unique_cell_types.items():</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>cell_type<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total number of unique cell types per cell type annnotation level:
Original Cell Type: 25
Level Three Cell Type: 25
Level Two Cell Type: 17
Level One Cell Type: 5</code></pre>
</div>
</div>
<div id="cell-11" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the unique cell types containing "endothelial" in name per cell type column (Level One Cell Type, Level Two Cell Type, Level Three Cell Type, Original Cell Type) to a dictionary where the key is the level and the value is a list of unique cell types.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>endothelial_cell_types <span class="op">=</span> {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Original Cell Type'</span>: df_all_nodes[df_all_nodes[<span class="st">'Original Cell Type'</span>].<span class="bu">str</span>.contains(<span class="st">"endothelial"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)][<span class="st">'Original Cell Type'</span>].unique().tolist(),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Three Cell Type'</span>: df_all_nodes[df_all_nodes[<span class="st">'Level Three Cell Type'</span>].<span class="bu">str</span>.contains(<span class="st">"endothelial"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)][<span class="st">'Level Three Cell Type'</span>].unique().tolist(),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Two Cell Type'</span>: df_all_nodes[df_all_nodes[<span class="st">'Level Two Cell Type'</span>].<span class="bu">str</span>.contains(<span class="st">"endothelial"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)][<span class="st">'Level Two Cell Type'</span>].unique().tolist(),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level One Cell Type'</span>: df_all_nodes[df_all_nodes[<span class="st">'Level One Cell Type'</span>].<span class="bu">str</span>.contains(<span class="st">"endothelial"</span>, case<span class="op">=</span><span class="va">False</span>, na<span class="op">=</span><span class="va">False</span>)][<span class="st">'Level One Cell Type'</span>].unique().tolist()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Endothelial cell types per cell type annotation level:"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> level, cell_types <span class="kw">in</span> endothelial_cell_types.items():</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cell <span class="kw">in</span> cell_types:</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  - </span><span class="sc">{</span>cell<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Endothelial cell types per cell type annotation level:

Original Cell Type:
  - Endothelial

Level Three Cell Type:
  - endothelial cell of lymphatic vessel
  - endothelial cell

Level Two Cell Type:
  - endothelial cell of lymphatic vessel
  - endothelial cell

Level One Cell Type:
  - endothelial cell</code></pre>
</div>
</div>
<div id="cell-12" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>type_field_list <span class="op">=</span> [<span class="st">"Level Three Cell Type"</span>, <span class="st">"Level Two Cell Type"</span>, <span class="st">"Level One Cell Type"</span>] <span class="co"># Skipping Original Cell Type as it is not a hierarchical level.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the anchor cell type (type of endothelial cell) for each level in type_field_list based on available categories in the previous cell. The distance analysis at all three levels will be limited to the specified anchor cell type.</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>anchor_cell_type_dict <span class="op">=</span> {</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Three Cell Type'</span>: <span class="st">'endothelial cell'</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level Two Cell Type'</span>: <span class="st">'endothelial cell'</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Level One Cell Type'</span>: <span class="st">'endothelial cell'</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="process-datasets-to-add-region-information-to-nodes-files." class="level2">
<h2 class="anchored" data-anchor-id="process-datasets-to-add-region-information-to-nodes-files.">Process datasets to add region information to Nodes files.</h2>
<div id="cell-14" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List of regions (based on filenames) in small intestine (si) and large intestine (li).</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>si <span class="op">=</span> [<span class="st">'Duodenum'</span>, <span class="st">'Ileum'</span>, <span class="st">'Mid'</span>, <span class="st">'ProximalJejunum'</span>, <span class="st">'Midjejunum'</span>, <span class="st">'Proximaljejunum'</span>]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>li <span class="op">=</span> [<span class="st">'Ascending'</span>, <span class="st">'Descending'</span>, <span class="st">'Transverse'</span>, <span class="st">'Left'</span>, <span class="st">'Right'</span>, <span class="st">'Sigmoid'</span>, <span class="st">'Trans'</span>]</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dictionary to map si and li regions to correct region names.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>region_map <span class="op">=</span> {</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Duodenum'</span>: <span class="st">'Duodenum'</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Ileum'</span>: <span class="st">'Ileum'</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Mid'</span>: <span class="st">'Mid Jejunum'</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ProximalJejunum'</span>: <span class="st">'Proximal Jejunum'</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Midjejunum'</span>: <span class="st">'Mid Jejunum'</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Proximaljejunum'</span>: <span class="st">'Proximal Jejunum'</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Ascending'</span>: <span class="st">'Ascending'</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Descending'</span>: <span class="st">'Descending'</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Transverse'</span>: <span class="st">'Transverse'</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Left'</span>: <span class="st">'Descending'</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Right'</span>: <span class="st">'Ascending'</span>,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sigmoid'</span>: <span class="st">'Sigmoid'</span>,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Trans'</span>: <span class="st">'Transverse'</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-15" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df_all_nodes.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">Original Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three CL Label</th>
<th data-quarto-table-cell-role="th">Level Three CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/3</th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Level Two CL Label</th>
<th data-quarto-table-cell-role="th">Level Two CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/2</th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Level One CL Label</th>
<th data-quarto-table-cell-role="th">Level One CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/1</th>
<th data-quarto-table-cell-role="th">Dataset</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1503.64128</td>
<td>1278.32154</td>
<td>NK</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>immune cell</td>
<td>leukocyte</td>
<td>CL:0000738</td>
<td>skos:exactMatch</td>
<td>B004_Ascending</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1958.05496</td>
<td>1553.46072</td>
<td>NK</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>immune cell</td>
<td>leukocyte</td>
<td>CL:0000738</td>
<td>skos:exactMatch</td>
<td>B004_Ascending</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>2290.93940</td>
<td>1187.36332</td>
<td>NK</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>immune cell</td>
<td>leukocyte</td>
<td>CL:0000738</td>
<td>skos:exactMatch</td>
<td>B004_Ascending</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>2863.48554</td>
<td>891.08862</td>
<td>NK</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>immune cell</td>
<td>leukocyte</td>
<td>CL:0000738</td>
<td>skos:exactMatch</td>
<td>B004_Ascending</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>2563.43664</td>
<td>1468.54122</td>
<td>NK</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>immune cell</td>
<td>leukocyte</td>
<td>CL:0000738</td>
<td>skos:exactMatch</td>
<td>B004_Ascending</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-16" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through the df_all_data dataframe to create new columns "Donor" and "Unique Region" based on the "Dataset" column.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The "Donor" column is created by extracting the donor name from the "Dataset" column, for example B004 from B004_Duodenum.</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The "Unique Region" column is created by mapping the region names based on the full dataset name.</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>df_all_nodes[<span class="st">'Donor'</span>] <span class="op">=</span> df_all_nodes[<span class="st">'Dataset'</span>].<span class="bu">str</span>.split(<span class="st">'_'</span>).<span class="bu">str</span>[<span class="dv">0</span>]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>df_all_nodes[<span class="st">'Unique Region'</span>] <span class="op">=</span> df_all_nodes[<span class="st">'Dataset'</span>].<span class="bu">str</span>.split(<span class="st">'_'</span>).<span class="bu">str</span>[<span class="dv">1</span>].<span class="bu">map</span>(region_map)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the new columns are created correctly.</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>df_all_nodes[[<span class="st">'Dataset'</span>, <span class="st">'Donor'</span>, <span class="st">'Unique Region'</span>]].head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Donor</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>B004_Ascending</td>
<td>B004</td>
<td>Ascending</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>B004_Ascending</td>
<td>B004</td>
<td>Ascending</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>B004_Ascending</td>
<td>B004</td>
<td>Ascending</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>B004_Ascending</td>
<td>B004</td>
<td>Ascending</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>B004_Ascending</td>
<td>B004</td>
<td>Ascending</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-17" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through the df_all_data dataframe to create a new column "Tissue Subtype" based on Dataset column value after "_".</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>df_all_nodes[<span class="st">'Tissue Subtype'</span>] <span class="op">=</span> df_all_nodes[<span class="st">'Dataset'</span>].<span class="bu">str</span>.split(<span class="st">'_'</span>).<span class="bu">str</span>[<span class="dv">1</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Small Intestine'</span> <span class="cf">if</span> x <span class="kw">in</span> si <span class="cf">else</span> (<span class="st">'Large Intestine'</span> <span class="cf">if</span> x <span class="kw">in</span> li <span class="cf">else</span> <span class="st">'Unknown'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-18" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print all unique regions in the data.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Unique Regions in the data:"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_all_nodes[<span class="st">'Unique Region'</span>].unique())</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print all unique donors in the data.</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Unique Donors in the data:"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_all_nodes[<span class="st">'Donor'</span>].unique())</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print unique values in Tissue Subtype.</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Unique Tissue Subtypes in the data:"</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_all_nodes[<span class="st">'Tissue Subtype'</span>].unique())</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Print number of donors in small intestine and large intestine.</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Number of donors in Small Intestine:"</span>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_all_nodes[df_all_nodes[<span class="st">'Tissue Subtype'</span>] <span class="op">==</span> <span class="st">'Small Intestine'</span>][<span class="st">'Donor'</span>].nunique())</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Number of donors in Large Intestine:"</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_all_nodes[df_all_nodes[<span class="st">'Tissue Subtype'</span>] <span class="op">==</span> <span class="st">'Large Intestine'</span>][<span class="st">'Donor'</span>].nunique())</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the total number of unique donors and unique regions.</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Total number of unique donors: </span><span class="sc">{</span>df_all_nodes[<span class="st">'Donor'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Total number of unique donors: </span><span class="sc">{</span>df_all_nodes[<span class="st">'Donor'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total number of unique regions: </span><span class="sc">{</span>df_all_nodes[<span class="st">'Unique Region'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Print number of unique datasets per small intestine and large intestine.</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Total number of unique datasets in Small Intestine: </span><span class="sc">{</span>df_all_nodes[df_all_nodes[<span class="st">'Tissue Subtype'</span>] <span class="op">==</span> <span class="st">'Small Intestine'</span>][<span class="st">'Dataset'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total number of unique datasets in Large Intestine: </span><span class="sc">{</span>df_all_nodes[df_all_nodes[<span class="st">'Tissue Subtype'</span>] <span class="op">==</span> <span class="st">'Large Intestine'</span>][<span class="st">'Dataset'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Unique Regions in the data:
['Ascending' 'Descending' 'Duodenum' 'Ileum' 'Mid Jejunum'
 'Proximal Jejunum' 'Transverse' 'Sigmoid']

Unique Donors in the data:
['B004' 'B005' 'B006' 'B009' 'B010' 'B011' 'B012' 'B008']

Unique Tissue Subtypes in the data:
['Large Intestine' 'Small Intestine']

Number of donors in Small Intestine:
8

Number of donors in Large Intestine:
8

Total number of unique donors: 8

Total number of unique donors: 8
Total number of unique regions: 8

Total number of unique datasets in Small Intestine: 32
Total number of unique datasets in Large Intestine: 32</code></pre>
</div>
</div>
</section>
<section id="process-datasets-to-add-region-information-to-edges-files." class="level2">
<h2 class="anchored" data-anchor-id="process-datasets-to-add-region-information-to-edges-files.">Process datasets to add region information to Edges files.</h2>
<div id="cell-20" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df_all_edges.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cell_id</th>
<th data-quarto-table-cell-role="th">x1</th>
<th data-quarto-table-cell-role="th">y1</th>
<th data-quarto-table-cell-role="th">z1</th>
<th data-quarto-table-cell-role="th">x2</th>
<th data-quarto-table-cell-role="th">y2</th>
<th data-quarto-table-cell-role="th">z2</th>
<th data-quarto-table-cell-role="th">Distance</th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type Level</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>1503.64128</td>
<td>1278.32154</td>
<td>0</td>
<td>1541.00586</td>
<td>1229.63436</td>
<td>0</td>
<td>61.372252</td>
<td>B004_Ascending</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>726</td>
<td>1428.15728</td>
<td>1210.38594</td>
<td>0</td>
<td>1404.75724</td>
<td>1149.62132</td>
<td>0</td>
<td>65.114522</td>
<td>B004_Ascending</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>727</td>
<td>1428.15728</td>
<td>1216.80208</td>
<td>0</td>
<td>1404.75724</td>
<td>1149.62132</td>
<td>0</td>
<td>71.139415</td>
<td>B004_Ascending</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>729</td>
<td>1433.06374</td>
<td>1202.83754</td>
<td>0</td>
<td>1404.75724</td>
<td>1149.62132</td>
<td>0</td>
<td>60.276231</td>
<td>B004_Ascending</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>730</td>
<td>1437.21536</td>
<td>1248.50536</td>
<td>0</td>
<td>1404.75724</td>
<td>1149.62132</td>
<td>0</td>
<td>104.074891</td>
<td>B004_Ascending</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-21" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Process the edge data to create new columns "Donor", "Unique Region" and Tissue Subtype based on the "Dataset" column, similar to how it was done for the node data.</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df_all_edges[<span class="st">'Donor'</span>] <span class="op">=</span> df_all_edges[<span class="st">'Dataset'</span>].<span class="bu">str</span>.split(<span class="st">'_'</span>).<span class="bu">str</span>[<span class="dv">0</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df_all_edges[<span class="st">'Unique Region'</span>] <span class="op">=</span> df_all_edges[<span class="st">'Dataset'</span>].<span class="bu">str</span>.split(<span class="st">'_'</span>).<span class="bu">str</span>[<span class="dv">1</span>].<span class="bu">map</span>(region_map)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>df_all_edges[<span class="st">'Tissue Subtype'</span>] <span class="op">=</span> df_all_edges[<span class="st">'Dataset'</span>].<span class="bu">str</span>.split(<span class="st">'_'</span>).<span class="bu">str</span>[<span class="dv">1</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Small Intestine'</span> <span class="cf">if</span> x <span class="kw">in</span> si <span class="cf">else</span> (<span class="st">'Large Intestine'</span> <span class="cf">if</span> x <span class="kw">in</span> li <span class="cf">else</span> <span class="st">'Unknown'</span>))</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the new columns are created correctly.</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>df_all_edges[[<span class="st">'Dataset'</span>, <span class="st">'Donor'</span>, <span class="st">'Unique Region'</span>, <span class="st">'Tissue Subtype'</span>]].head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Donor</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">Tissue Subtype</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>B004_Ascending</td>
<td>B004</td>
<td>Ascending</td>
<td>Large Intestine</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>B004_Ascending</td>
<td>B004</td>
<td>Ascending</td>
<td>Large Intestine</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>B004_Ascending</td>
<td>B004</td>
<td>Ascending</td>
<td>Large Intestine</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>B004_Ascending</td>
<td>B004</td>
<td>Ascending</td>
<td>Large Intestine</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>B004_Ascending</td>
<td>B004</td>
<td>Ascending</td>
<td>Large Intestine</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-22" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print all unique regions in the data.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Unique Regions in the data:"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_all_edges[<span class="st">'Unique Region'</span>].unique())</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print all unique donors in the data.</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Unique Donors in the data:"</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_all_edges[<span class="st">'Donor'</span>].unique())</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print unique values in Tissue Subtype.</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Unique Tissue Subtypes in the data:"</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_all_edges[<span class="st">'Tissue Subtype'</span>].unique())</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Print number of donors in small intestine and large intestine.</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Number of donors in Small Intestine:"</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_all_edges[df_all_edges[<span class="st">'Tissue Subtype'</span>] <span class="op">==</span> <span class="st">'Small Intestine'</span>][<span class="st">'Donor'</span>].nunique())</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Number of donors in Large Intestine:"</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_all_edges[df_all_edges[<span class="st">'Tissue Subtype'</span>] <span class="op">==</span> <span class="st">'Large Intestine'</span>][<span class="st">'Donor'</span>].nunique())</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the total number of unique donors and unique regions.</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Total number of unique donors: </span><span class="sc">{</span>df_all_edges[<span class="st">'Donor'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Total number of unique donors: </span><span class="sc">{</span>df_all_edges[<span class="st">'Donor'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total number of unique regions: </span><span class="sc">{</span>df_all_edges[<span class="st">'Unique Region'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Print number of unique datasets per small intestine and large intestine.</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Total number of unique datasets in Small Intestine: </span><span class="sc">{</span>df_all_edges[df_all_edges[<span class="st">'Tissue Subtype'</span>] <span class="op">==</span> <span class="st">'Small Intestine'</span>][<span class="st">'Dataset'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total number of unique datasets in Large Intestine: </span><span class="sc">{</span>df_all_edges[df_all_edges[<span class="st">'Tissue Subtype'</span>] <span class="op">==</span> <span class="st">'Large Intestine'</span>][<span class="st">'Dataset'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Unique Regions in the data:
['Ascending' 'Descending' 'Duodenum' 'Ileum' 'Mid Jejunum'
 'Proximal Jejunum' 'Transverse' 'Sigmoid']

Unique Donors in the data:
['B004' 'B005' 'B006' 'B009' 'B010' 'B011' 'B012' 'B008']

Unique Tissue Subtypes in the data:
['Large Intestine' 'Small Intestine']

Number of donors in Small Intestine:
8

Number of donors in Large Intestine:
8

Total number of unique donors: 8

Total number of unique donors: 8
Total number of unique regions: 8

Total number of unique datasets in Small Intestine: 32
Total number of unique datasets in Large Intestine: 32</code></pre>
</div>
</div>
<div id="cell-23" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_types[<span class="st">'Donor'</span>] <span class="op">=</span> df_all_edges_with_cell_types[<span class="st">'Dataset'</span>].<span class="bu">str</span>.split(<span class="st">'_'</span>).<span class="bu">str</span>[<span class="dv">0</span>]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_types[<span class="st">'Unique Region'</span>] <span class="op">=</span> df_all_edges_with_cell_types[<span class="st">'Dataset'</span>].<span class="bu">str</span>.split(<span class="st">'_'</span>).<span class="bu">str</span>[<span class="dv">1</span>].<span class="bu">map</span>(region_map)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_types[<span class="st">'Tissue Subtype'</span>] <span class="op">=</span> df_all_edges_with_cell_types[<span class="st">'Dataset'</span>].<span class="bu">str</span>.split(<span class="st">'_'</span>).<span class="bu">str</span>[<span class="dv">1</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Small Intestine'</span> <span class="cf">if</span> x <span class="kw">in</span> si <span class="cf">else</span> (<span class="st">'Large Intestine'</span> <span class="cf">if</span> x <span class="kw">in</span> li <span class="cf">else</span> <span class="st">'Unknown'</span>))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the new columns are created correctly.</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_types[[<span class="st">'Dataset'</span>, <span class="st">'Donor'</span>, <span class="st">'Unique Region'</span>, <span class="st">'Tissue Subtype'</span>]].head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Donor</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">Tissue Subtype</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>B004_Ascending</td>
<td>B004</td>
<td>Ascending</td>
<td>Large Intestine</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>B004_Ascending</td>
<td>B004</td>
<td>Ascending</td>
<td>Large Intestine</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>B004_Ascending</td>
<td>B004</td>
<td>Ascending</td>
<td>Large Intestine</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>B004_Ascending</td>
<td>B004</td>
<td>Ascending</td>
<td>Large Intestine</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>B004_Ascending</td>
<td>B004</td>
<td>Ascending</td>
<td>Large Intestine</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-24" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df_all_nodes.head(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">Original Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Level Three CL Label</th>
<th data-quarto-table-cell-role="th">Level Three CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/3</th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Level Two CL Label</th>
<th data-quarto-table-cell-role="th">Level Two CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/2</th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Level One CL Label</th>
<th data-quarto-table-cell-role="th">Level One CL ID</th>
<th data-quarto-table-cell-role="th">CL_Match/1</th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Donor</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">Tissue Subtype</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1503.64128</td>
<td>1278.32154</td>
<td>NK</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>CL:0000623</td>
<td>skos:exactMatch</td>
<td>immune cell</td>
<td>leukocyte</td>
<td>CL:0000738</td>
<td>skos:exactMatch</td>
<td>B004_Ascending</td>
<td>B004</td>
<td>Ascending</td>
<td>Large Intestine</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-25" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df_all_edges.head(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cell_id</th>
<th data-quarto-table-cell-role="th">x1</th>
<th data-quarto-table-cell-role="th">y1</th>
<th data-quarto-table-cell-role="th">z1</th>
<th data-quarto-table-cell-role="th">x2</th>
<th data-quarto-table-cell-role="th">y2</th>
<th data-quarto-table-cell-role="th">z2</th>
<th data-quarto-table-cell-role="th">Distance</th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type Level</th>
<th data-quarto-table-cell-role="th">Donor</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">Tissue Subtype</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>1503.64128</td>
<td>1278.32154</td>
<td>0</td>
<td>1541.00586</td>
<td>1229.63436</td>
<td>0</td>
<td>61.372252</td>
<td>B004_Ascending</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
<td>B004</td>
<td>Ascending</td>
<td>Large Intestine</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-26" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_types.head(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cell_id</th>
<th data-quarto-table-cell-role="th">x1</th>
<th data-quarto-table-cell-role="th">y1</th>
<th data-quarto-table-cell-role="th">z1</th>
<th data-quarto-table-cell-role="th">x2</th>
<th data-quarto-table-cell-role="th">y2</th>
<th data-quarto-table-cell-role="th">z2</th>
<th data-quarto-table-cell-role="th">Distance</th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type Level</th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Donor</th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">Tissue Subtype</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>1503.64128</td>
<td>1278.32154</td>
<td>0</td>
<td>1541.00586</td>
<td>1229.63436</td>
<td>0</td>
<td>61.372252</td>
<td>B004_Ascending</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
<td>natural killer cell</td>
<td>natural killer cell</td>
<td>immune cell</td>
<td>B004</td>
<td>Ascending</td>
<td>Large Intestine</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="node-analysis" class="level2">
<h2 class="anchored" data-anchor-id="node-analysis">Node Analysis</h2>
<div id="cell-28" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot number of cells per cell type in large intestine in the same plot. Color by cell type and unique region. Output figure saved in existing `figures_output_dir`.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_cells_per_celltype(df, type_field, intestine_type, output_dir):</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">8</span>))</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    sns.countplot(data<span class="op">=</span>df[df[<span class="st">'Tissue Subtype'</span>] <span class="op">==</span> intestine_type], x<span class="op">=</span>type_field, palette<span class="op">=</span><span class="st">'Spectral'</span>, hue<span class="op">=</span><span class="st">'Unique Region'</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Number of Cells per </span><span class="sc">{</span>type_field<span class="sc">}</span><span class="ss"> in </span><span class="sc">{</span>intestine_type<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_cells_per_celltype_</span><span class="sc">{</span>type_field<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>intestine_type<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>                bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>                pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_cells_per_celltype_</span><span class="sc">{</span>type_field<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>intestine_type<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>                bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>                pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    plt.legend(title<span class="op">=</span><span class="st">'Unique Region'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.85</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(type_field)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Number of Cells'</span>)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the plot</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> type_field <span class="kw">in</span> type_field_list:</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    plot_cells_per_celltype(df_all_nodes, type_field, <span class="st">'Large Intestine'</span>, os.path.join(basepath, figures_output_dir))</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot number of cells per cell type in small intestine in the same plot. Color by cell type and unique region. Output figure saved in existing `figures_output_dir`.</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> type_field <span class="kw">in</span> type_field_list:</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    plot_cells_per_celltype(df_all_nodes, type_field, <span class="st">'Small Intestine'</span>, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-24-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-24-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-24-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-24-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-24-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-24-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="distance-analysis" class="level2">
<h2 class="anchored" data-anchor-id="distance-analysis">Distance Analysis</h2>
<div id="cell-30" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get mean, median, minimum, maximum distance per unique region in each tissue subtype per anchor cell type.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>df_distance_stats <span class="op">=</span> df_all_edges_with_cell_types.groupby([<span class="st">'Unique Region'</span>, <span class="st">'Tissue Subtype'</span>, <span class="st">'Anchor Cell Type'</span>, <span class="st">'Anchor Cell Type Level'</span>]).agg(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    min_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'min'</span>),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    max_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'max'</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the first few rows of the distance statistics DataFrame.</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>df_distance_stats</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unique Region</th>
<th data-quarto-table-cell-role="th">Tissue Subtype</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type</th>
<th data-quarto-table-cell-role="th">Anchor Cell Type Level</th>
<th data-quarto-table-cell-role="th">mean_distance</th>
<th data-quarto-table-cell-role="th">median_distance</th>
<th data-quarto-table-cell-role="th">min_distance</th>
<th data-quarto-table-cell-role="th">max_distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Ascending</td>
<td>Large Intestine</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>32.465985</td>
<td>23.412212</td>
<td>0.377420</td>
<td>199.984527</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Ascending</td>
<td>Large Intestine</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
<td>41.197999</td>
<td>31.965045</td>
<td>0.533752</td>
<td>199.984527</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Ascending</td>
<td>Large Intestine</td>
<td>endothelial cell</td>
<td>Level Two Cell Type</td>
<td>41.197999</td>
<td>31.965045</td>
<td>0.533752</td>
<td>199.984527</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Ascending</td>
<td>Large Intestine</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
<td>48.645392</td>
<td>36.122071</td>
<td>0.377420</td>
<td>199.984527</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>Ascending</td>
<td>Large Intestine</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Two Cell Type</td>
<td>48.645392</td>
<td>36.122071</td>
<td>0.377420</td>
<td>199.984527</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>Descending</td>
<td>Large Intestine</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>33.751636</td>
<td>24.981099</td>
<td>0.000000</td>
<td>199.998416</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>Descending</td>
<td>Large Intestine</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
<td>40.669880</td>
<td>31.271246</td>
<td>0.000000</td>
<td>199.998416</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>Descending</td>
<td>Large Intestine</td>
<td>endothelial cell</td>
<td>Level Two Cell Type</td>
<td>40.669880</td>
<td>31.271246</td>
<td>0.000000</td>
<td>199.998416</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>Descending</td>
<td>Large Intestine</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
<td>55.376327</td>
<td>44.605871</td>
<td>0.377420</td>
<td>199.985951</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>Descending</td>
<td>Large Intestine</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Two Cell Type</td>
<td>55.376327</td>
<td>44.605871</td>
<td>0.377420</td>
<td>199.985951</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>Duodenum</td>
<td>Small Intestine</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>32.457991</td>
<td>22.898541</td>
<td>0.533752</td>
<td>199.954608</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>Duodenum</td>
<td>Small Intestine</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
<td>36.243342</td>
<td>26.615470</td>
<td>0.533752</td>
<td>199.987020</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>Duodenum</td>
<td>Small Intestine</td>
<td>endothelial cell</td>
<td>Level Two Cell Type</td>
<td>36.243342</td>
<td>26.615470</td>
<td>0.533752</td>
<td>199.987020</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>Duodenum</td>
<td>Small Intestine</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
<td>57.516441</td>
<td>45.767525</td>
<td>0.843937</td>
<td>199.997703</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>Duodenum</td>
<td>Small Intestine</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Two Cell Type</td>
<td>57.516441</td>
<td>45.767525</td>
<td>0.843937</td>
<td>199.997703</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>Ileum</td>
<td>Small Intestine</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>32.578045</td>
<td>22.318897</td>
<td>0.000000</td>
<td>199.975979</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>Ileum</td>
<td>Small Intestine</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
<td>37.434302</td>
<td>27.216143</td>
<td>0.000000</td>
<td>199.977404</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>Ileum</td>
<td>Small Intestine</td>
<td>endothelial cell</td>
<td>Level Two Cell Type</td>
<td>37.434302</td>
<td>27.216143</td>
<td>0.000000</td>
<td>199.977404</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>Ileum</td>
<td>Small Intestine</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
<td>51.209250</td>
<td>39.180850</td>
<td>0.000000</td>
<td>199.977404</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>Ileum</td>
<td>Small Intestine</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Two Cell Type</td>
<td>51.209250</td>
<td>39.180850</td>
<td>0.000000</td>
<td>199.977404</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>Mid Jejunum</td>
<td>Small Intestine</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>37.485418</td>
<td>24.636595</td>
<td>0.000000</td>
<td>199.994498</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>Mid Jejunum</td>
<td>Small Intestine</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
<td>41.185966</td>
<td>29.137215</td>
<td>0.000000</td>
<td>199.987020</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>Mid Jejunum</td>
<td>Small Intestine</td>
<td>endothelial cell</td>
<td>Level Two Cell Type</td>
<td>41.185966</td>
<td>29.137215</td>
<td>0.000000</td>
<td>199.987020</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>Mid Jejunum</td>
<td>Small Intestine</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
<td>55.117326</td>
<td>41.727532</td>
<td>0.000000</td>
<td>199.997703</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">24</th>
<td>Mid Jejunum</td>
<td>Small Intestine</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Two Cell Type</td>
<td>55.117326</td>
<td>41.727532</td>
<td>0.000000</td>
<td>199.997703</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">25</th>
<td>Proximal Jejunum</td>
<td>Small Intestine</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>36.900594</td>
<td>24.532300</td>
<td>0.000000</td>
<td>199.983458</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">26</th>
<td>Proximal Jejunum</td>
<td>Small Intestine</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
<td>41.262498</td>
<td>29.392756</td>
<td>0.000000</td>
<td>199.974554</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">27</th>
<td>Proximal Jejunum</td>
<td>Small Intestine</td>
<td>endothelial cell</td>
<td>Level Two Cell Type</td>
<td>41.262498</td>
<td>29.392756</td>
<td>0.000000</td>
<td>199.974554</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">28</th>
<td>Proximal Jejunum</td>
<td>Small Intestine</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
<td>56.616775</td>
<td>42.250816</td>
<td>0.533752</td>
<td>199.987020</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">29</th>
<td>Proximal Jejunum</td>
<td>Small Intestine</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Two Cell Type</td>
<td>56.616775</td>
<td>42.250816</td>
<td>0.533752</td>
<td>199.987020</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">30</th>
<td>Sigmoid</td>
<td>Large Intestine</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>37.371448</td>
<td>28.286364</td>
<td>1.687874</td>
<td>199.975979</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">31</th>
<td>Sigmoid</td>
<td>Large Intestine</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
<td>48.924570</td>
<td>38.727412</td>
<td>1.687874</td>
<td>199.984527</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">32</th>
<td>Sigmoid</td>
<td>Large Intestine</td>
<td>endothelial cell</td>
<td>Level Two Cell Type</td>
<td>48.924570</td>
<td>38.727412</td>
<td>1.687874</td>
<td>199.984527</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">33</th>
<td>Sigmoid</td>
<td>Large Intestine</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
<td>59.624433</td>
<td>45.405053</td>
<td>2.416667</td>
<td>199.984527</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">34</th>
<td>Sigmoid</td>
<td>Large Intestine</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Two Cell Type</td>
<td>59.624433</td>
<td>45.405053</td>
<td>2.416667</td>
<td>199.984527</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">35</th>
<td>Transverse</td>
<td>Large Intestine</td>
<td>endothelial cell</td>
<td>Level One Cell Type</td>
<td>34.822264</td>
<td>25.800184</td>
<td>0.377420</td>
<td>199.977404</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">36</th>
<td>Transverse</td>
<td>Large Intestine</td>
<td>endothelial cell</td>
<td>Level Three Cell Type</td>
<td>44.694353</td>
<td>35.455390</td>
<td>0.843937</td>
<td>199.977404</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">37</th>
<td>Transverse</td>
<td>Large Intestine</td>
<td>endothelial cell</td>
<td>Level Two Cell Type</td>
<td>44.694353</td>
<td>35.455390</td>
<td>0.843937</td>
<td>199.977404</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">38</th>
<td>Transverse</td>
<td>Large Intestine</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Three Cell Type</td>
<td>53.638178</td>
<td>39.751124</td>
<td>0.377420</td>
<td>199.997703</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">39</th>
<td>Transverse</td>
<td>Large Intestine</td>
<td>endothelial cell of lymphatic vessel</td>
<td>Level Two Cell Type</td>
<td>53.638178</td>
<td>39.751124</td>
<td>0.377420</td>
<td>199.997703</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="level-one-cell-type-analysis" class="level3">
<h3 class="anchored" data-anchor-id="level-one-cell-type-analysis">Level One Cell Type Analysis</h3>
<div id="cell-32" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get mean, median, minimum, maximum distance per cell type in all tissue subtypes.</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>cell_type_level <span class="op">=</span> <span class="st">'Level One Cell Type'</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_type_level <span class="op">=</span> df_all_edges_with_cell_types[(df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type Level'</span>] <span class="op">==</span> cell_type_level) <span class="op">&amp;</span> (df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type'</span>] <span class="op">==</span> anchor_cell_type_dict[cell_type_level])]</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level <span class="op">=</span> df_all_edges_with_cell_type_level.groupby([cell_type_level, <span class="st">'Tissue Subtype'</span>]).agg(</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    min_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'min'</span>),</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    max_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'max'</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Level One Cell Type</th>
<th data-quarto-table-cell-role="th">Tissue Subtype</th>
<th data-quarto-table-cell-role="th">mean_distance</th>
<th data-quarto-table-cell-role="th">median_distance</th>
<th data-quarto-table-cell-role="th">min_distance</th>
<th data-quarto-table-cell-role="th">max_distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>epithelial cell</td>
<td>Large Intestine</td>
<td>32.875946</td>
<td>26.085702</td>
<td>0.377420</td>
<td>199.984527</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>epithelial cell</td>
<td>Small Intestine</td>
<td>43.213764</td>
<td>29.083389</td>
<td>0.000000</td>
<td>199.994498</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>immune cell</td>
<td>Large Intestine</td>
<td>25.267128</td>
<td>18.151509</td>
<td>0.000000</td>
<td>199.947128</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>immune cell</td>
<td>Small Intestine</td>
<td>26.838213</td>
<td>17.229543</td>
<td>0.000000</td>
<td>199.987020</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>mesenchymal cell</td>
<td>Large Intestine</td>
<td>42.273309</td>
<td>32.458120</td>
<td>0.000000</td>
<td>199.998416</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>mesenchymal cell</td>
<td>Small Intestine</td>
<td>32.811427</td>
<td>24.166671</td>
<td>0.000000</td>
<td>199.793187</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>neural cell</td>
<td>Large Intestine</td>
<td>37.306252</td>
<td>28.396936</td>
<td>0.377420</td>
<td>198.398031</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>neural cell</td>
<td>Small Intestine</td>
<td>27.669692</td>
<td>20.812925</td>
<td>0.533752</td>
<td>198.517180</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-33" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top five and bottom five cell types with respect to mean distance in small intestine and large intestine separately.</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_top_bottom_cell_types(df, cell_type_level, tissue_subtype, top_n<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the DataFrame for the specified tissue subtype and cell type level</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    df_filtered <span class="op">=</span> df[df[<span class="st">'Tissue Subtype'</span>] <span class="op">==</span> tissue_subtype]</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by the specified cell type level and calculate mean distance</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    df_grouped <span class="op">=</span> df_filtered.groupby(cell_type_level).agg(mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>)).reset_index()</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by mean distance to get top and bottom cell types</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    df_sorted <span class="op">=</span> df_grouped.sort_values(by<span class="op">=</span><span class="st">'mean_distance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get top N and bottom N cell types</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    top_cell_types <span class="op">=</span> df_sorted.head(top_n)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    bottom_cell_types <span class="op">=</span> df_sorted.tail(top_n)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> top_cell_types, bottom_cell_types</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for small intestine</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>top_bottom_si <span class="op">=</span> get_top_bottom_cell_types(df_all_edges_with_cell_type_level, cell_type_level, <span class="st">'Small Intestine'</span>)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 cell types in Small Intestine:"</span>)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_si[<span class="dv">0</span>])</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Bottom 5 cell types in Small Intestine:"</span>)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_si[<span class="dv">1</span>])</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for large intestine</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>top_bottom_li <span class="op">=</span> get_top_bottom_cell_types(df_all_edges_with_cell_type_level, cell_type_level, <span class="st">'Large Intestine'</span>)</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 cell types in Large Intestine:"</span>)</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_li[<span class="dv">0</span>])</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Bottom 5 cell types in Large Intestine:"</span>)</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_li[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in Small Intestine:
  Level One Cell Type  mean_distance
0     epithelial cell      43.213764
2    mesenchymal cell      32.811427
3         neural cell      27.669692
1         immune cell      26.838213

Bottom 5 cell types in Small Intestine:
  Level One Cell Type  mean_distance
0     epithelial cell      43.213764
2    mesenchymal cell      32.811427
3         neural cell      27.669692
1         immune cell      26.838213

Top 5 cell types in Large Intestine:
  Level One Cell Type  mean_distance
2    mesenchymal cell      42.273309
3         neural cell      37.306252
0     epithelial cell      32.875946
1         immune cell      25.267128

Bottom 5 cell types in Large Intestine:
  Level One Cell Type  mean_distance
2    mesenchymal cell      42.273309
3         neural cell      37.306252
0     epithelial cell      32.875946
1         immune cell      25.267128</code></pre>
</div>
</div>
<div id="cell-34" class="cell" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top five and bottom five cell types with respect to median distance in small intestine and large intestine separately.</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_top_bottom_cell_types(df, cell_type_level, tissue_subtype, top_n<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the DataFrame for the specified tissue subtype and cell type level</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    df_filtered <span class="op">=</span> df[df[<span class="st">'Tissue Subtype'</span>] <span class="op">==</span> tissue_subtype]</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by the specified cell type level and calculate median distance</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    df_grouped <span class="op">=</span> df_filtered.groupby(cell_type_level).agg(median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>)).reset_index()</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by median distance to get top and bottom cell types</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    df_sorted <span class="op">=</span> df_grouped.sort_values(by<span class="op">=</span><span class="st">'median_distance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get top N and bottom N cell types</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    top_cell_types <span class="op">=</span> df_sorted.head(top_n)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    bottom_cell_types <span class="op">=</span> df_sorted.tail(top_n)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> top_cell_types, bottom_cell_types</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for small intestine</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>top_bottom_si <span class="op">=</span> get_top_bottom_cell_types(df_all_edges_with_cell_type_level, cell_type_level, <span class="st">'Small Intestine'</span>)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 cell types in Small Intestine:"</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_si[<span class="dv">0</span>])</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Bottom 5 cell types in Small Intestine:"</span>)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_si[<span class="dv">1</span>])</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for large intestine</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>top_bottom_li <span class="op">=</span> get_top_bottom_cell_types(df_all_edges_with_cell_type_level, cell_type_level, <span class="st">'Large Intestine'</span>)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 cell types in Large Intestine:"</span>)</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_li[<span class="dv">0</span>])</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Bottom 5 cell types in Large Intestine:"</span>)</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_li[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in Small Intestine:
  Level One Cell Type  median_distance
0     epithelial cell        29.083389
2    mesenchymal cell        24.166671
3         neural cell        20.812925
1         immune cell        17.229543

Bottom 5 cell types in Small Intestine:
  Level One Cell Type  median_distance
0     epithelial cell        29.083389
2    mesenchymal cell        24.166671
3         neural cell        20.812925
1         immune cell        17.229543

Top 5 cell types in Large Intestine:
  Level One Cell Type  median_distance
2    mesenchymal cell        32.458120
3         neural cell        28.396936
0     epithelial cell        26.085702
1         immune cell        18.151509

Bottom 5 cell types in Large Intestine:
  Level One Cell Type  median_distance
2    mesenchymal cell        32.458120
3         neural cell        28.396936
0     epithelial cell        26.085702
1         immune cell        18.151509</code></pre>
</div>
</div>
<div id="cell-35" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate regional variability</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_regional_variability(df_all_edges_with_cell_type_level, cell_type_level):</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""    Calculate regional variability for distances in the given DataFrame.</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    regional_variability <span class="op">=</span> df_all_edges_with_cell_type_level.groupby(<span class="st">'Unique Region'</span>)[<span class="st">'Distance'</span>].agg([</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'mean'</span>, <span class="st">'mean'</span>),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'std'</span>, <span class="st">'std'</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    ]).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add CV as percentage</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    regional_variability[<span class="st">'CV (%)'</span>] <span class="op">=</span> (regional_variability[<span class="st">'std'</span>] <span class="op">/</span> regional_variability[<span class="st">'mean'</span>] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Regional Variability Analysis:"</span>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Mean: Average distance in each region"</span>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Std: Standard deviation of distances"</span>)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"CV: Coefficient of Variation (std/mean * 100%)"</span>)</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(regional_variability)</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate variability for each cell type</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    cell_type_variability <span class="op">=</span> df_all_edges_with_cell_type_level.groupby(cell_type_level)[<span class="st">'Distance'</span>].agg([</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'mean'</span>, <span class="st">'mean'</span>),</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'std'</span>, <span class="st">'std'</span>)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    ]).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add CV as percentage</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    cell_type_variability[<span class="st">'CV (%)'</span>] <span class="op">=</span> (cell_type_variability[<span class="st">'std'</span>] <span class="op">/</span> cell_type_variability[<span class="st">'mean'</span>] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Cell Type Variability Analysis (sorted by CV):"</span>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(cell_type_variability.sort_values(<span class="st">'CV (%)'</span>, ascending<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>calculate_regional_variability(df_all_edges_with_cell_type_level, cell_type_level)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regional Variability Analysis:
Mean: Average distance in each region
Std: Standard deviation of distances
CV: Coefficient of Variation (std/mean * 100%)
                   mean    std  CV (%)
Unique Region                         
Ascending         32.47  29.00    89.3
Descending        33.75  28.99    85.9
Duodenum          32.46  31.37    96.6
Ileum             32.58  32.14    98.6
Mid Jejunum       37.49  37.58   100.2
Proximal Jejunum  36.90  35.99    97.5
Sigmoid           37.37  29.56    79.1
Transverse        34.82  29.29    84.1

Cell Type Variability Analysis (sorted by CV):
                      mean    std  CV (%)
Level One Cell Type                      
immune cell          26.29  27.85   105.9
epithelial cell      39.19  35.37    90.3
mesenchymal cell     37.66  31.52    83.7
neural cell          32.18  26.83    83.4</code></pre>
</div>
</div>
<div id="cell-36" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the standard region sequence for plots</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>regions <span class="op">=</span> [<span class="st">'Duodenum'</span>, <span class="st">'Proximal Jejunum'</span>, <span class="st">'Mid Jejunum'</span>, <span class="st">'Ileum'</span>, <span class="st">'Ascending'</span>, <span class="st">'Transverse'</span>, <span class="st">'Descending'</span>, <span class="st">'Sigmoid'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-37" class="cell" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate Violin Plot</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_violin_cells_per_celltype_small_vs_large_intestine(df_all_edges_with_cell_type_level, cell_type_level, output_dir):</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    sns.set_context(<span class="st">"notebook"</span>, rc<span class="op">=</span>{<span class="st">"grid.linewidth"</span>: <span class="dv">2</span>})</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    sns.violinplot(data<span class="op">=</span>df_all_edges_with_cell_type_level, x<span class="op">=</span>cell_type_level, y<span class="op">=</span><span class="st">"Distance"</span>, hue<span class="op">=</span><span class="st">"Tissue Subtype"</span>, density_norm<span class="op">=</span><span class="st">"area"</span>, common_norm<span class="op">=</span><span class="va">True</span>, cut<span class="op">=</span><span class="dv">0</span>, inner<span class="op">=</span><span class="st">"box"</span>, split<span class="op">=</span><span class="va">True</span>, palette<span class="op">=</span><span class="st">'Spectral'</span>, alpha<span class="op">=</span><span class="fl">.9</span>, hue_order<span class="op">=</span>[<span class="st">'Small Intestine'</span>, <span class="st">'Large Intestine'</span>])</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    sns.set_theme(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    sns.set_context(<span class="st">"paper"</span>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    font_size <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    plt.legend(fontsize<span class="op">=</span>font_size)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Cell Type'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Distance (</span><span class="ch">\u03bc</span><span class="st">m)'</span>, fontsize<span class="op">=</span>font_size)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Increase font size for all text in the figure</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span>font_size)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span>font_size)</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_violin_cells_per_celltype__small_vs_large_intestine_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>                bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>                pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_violin_cells_per_celltype__small_vs_large_intestine_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>                bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>                pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>plot_violin_cells_per_celltype_small_vs_large_intestine(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-31-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-38" class="cell" data-execution_count="31">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplots of distribution of distances by cell type and region.</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_distance_distribution_boxplots_by_region(df_all_edges_with_cell_type_level, cell_type_level, output_dir):</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create categorical type with only the regions that exist in the data</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    available_regions <span class="op">=</span> [r <span class="cf">for</span> r <span class="kw">in</span> regions <span class="cf">if</span> r <span class="kw">in</span> df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>].unique()]</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>] <span class="op">=</span> pd.Categorical(</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>        df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>],</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>        categories<span class="op">=</span>available_regions,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>        ordered<span class="op">=</span><span class="va">True</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(data<span class="op">=</span>df_all_edges_with_cell_type_level, x<span class="op">=</span>cell_type_level, y<span class="op">=</span><span class="st">'Distance'</span>, hue<span class="op">=</span><span class="st">'Unique Region'</span>, showfliers<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span><span class="st">'Spectral'</span>) <span class="co"># viridis or Spectral palette for better color distinction</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Distribution of distances by </span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss"> and region'</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_distance_distribution_boxplots_by_region_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_distance_distribution_boxplots_by_region_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_boxplots_by_region(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-32-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-39" class="cell" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplots of distribution of distances by cell type and region.</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_distance_distribution_heatmap(df_all_edges_with_cell_type_level, cell_type_level, output_dir):</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    pivot_data <span class="op">=</span> df_all_edges_with_cell_type_level.pivot_table(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">'Distance'</span>,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>cell_type_level,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">'Unique Region'</span>,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    aggfunc<span class="op">=</span><span class="st">'median'</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(pivot_data, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.1f'</span>, cmap<span class="op">=</span><span class="st">'Spectral'</span>)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Heatmap of median distances'</span>)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_distance_distribution_heatmap_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_distance_distribution_heatmap_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_heatmap(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-33-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-40" class="cell" data-execution_count="33">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate Violin Plot per unique region in both small intestine and large intestine. Create for all 8 regions as 8 subplots.</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_violin_plots_all_regions(df_all_edges_with_cell_type_level, cell_type_level, output_dir, density_norm<span class="op">=</span><span class="st">"area"</span>):</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    sns.set_context(<span class="st">"notebook"</span>, rc<span class="op">=</span>{<span class="st">"grid.linewidth"</span>: <span class="dv">1</span>})</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    plt.rcParams[<span class="st">"svg.fonttype"</span>] <span class="op">=</span> <span class="st">'none'</span>  <span class="co"># to store text as text, not as path</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    fig, axs <span class="op">=</span> plt.subplots(<span class="dv">4</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">18</span>))</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(<span class="ss">f'Distance distribution per </span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss"> in small and large intestine (density normalization = </span><span class="sc">{</span>density_norm<span class="sc">}</span><span class="ss">)'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep the sequence of Cell Types consistent across plots.</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    cell_types <span class="op">=</span> <span class="bu">sorted</span>(df_all_edges_with_cell_type_level[cell_type_level].unique())</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a color palette based on the number of unique classes</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    color_palette <span class="op">=</span> sns.color_palette(<span class="st">"Spectral"</span>, n_colors<span class="op">=</span><span class="bu">len</span>(cell_types))</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a dictionary mapping class to color</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    class_color_dict <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(cell_types, color_palette))</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, region <span class="kw">in</span> <span class="bu">enumerate</span>(regions):</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>        data_reg <span class="op">=</span> df_all_edges_with_cell_type_level[df_all_edges_with_cell_type_level[<span class="st">'Unique Region'</span>] <span class="op">==</span> region]</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>        sns.violinplot(data<span class="op">=</span>data_reg, x<span class="op">=</span>cell_type_level, y<span class="op">=</span><span class="st">"Distance"</span>, density_norm<span class="op">=</span>density_norm, common_norm<span class="op">=</span><span class="va">True</span>, cut<span class="op">=</span><span class="dv">0</span>, inner<span class="op">=</span><span class="st">"box"</span>, split<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span>class_color_dict, alpha<span class="op">=</span><span class="fl">.9</span>, ax<span class="op">=</span>axs[i<span class="op">//</span><span class="dv">2</span>, i<span class="op">%</span><span class="dv">2</span>], hue<span class="op">=</span>cell_type_level, legend<span class="op">=</span><span class="va">False</span>, order<span class="op">=</span>cell_types, fill<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>        axs[i<span class="op">//</span><span class="dv">2</span>, i<span class="op">%</span><span class="dv">2</span>].set_title(region)</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>        axs[i<span class="op">//</span><span class="dv">2</span>, i<span class="op">%</span><span class="dv">2</span>].set_xlabel(<span class="st">'Cell Type'</span>, fontsize<span class="op">=</span><span class="dv">13</span>)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>        axs[i<span class="op">//</span><span class="dv">2</span>, i<span class="op">%</span><span class="dv">2</span>].set_ylabel(<span class="st">'Distance (</span><span class="ch">\u03bc</span><span class="st">m)'</span>, fontsize<span class="op">=</span><span class="dv">13</span>)</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>        axs[i<span class="op">//</span><span class="dv">2</span>, i<span class="op">%</span><span class="dv">2</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelrotation<span class="op">=</span><span class="dv">90</span>, labelsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>        axs[i<span class="op">//</span><span class="dv">2</span>, i<span class="op">%</span><span class="dv">2</span>].tick_params(axis<span class="op">=</span><span class="st">'both'</span>, labelsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>        axs[i<span class="op">//</span><span class="dv">2</span>, i<span class="op">%</span><span class="dv">2</span>].set_ylim(<span class="dv">0</span>, <span class="dv">200</span>)</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_violin_plots_all_regions_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.png'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>    plt.savefig(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>dataset_dir<span class="sc">}</span><span class="ss">_violin_plots_all_regions_</span><span class="sc">{</span>cell_type_level<span class="sc">}</span><span class="ss">.svg'</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>                    bbox_inches<span class="op">=</span><span class="st">'tight'</span>,</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>                    pad_inches<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>plot_violin_plots_all_regions(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">"count"</span>) <span class="co"># Or, density_norm="count"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-34-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="level-two-cell-type-analysis" class="level3">
<h3 class="anchored" data-anchor-id="level-two-cell-type-analysis">Level Two Cell Type Analysis</h3>
<div id="cell-42" class="cell" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get mean, median, minimum, maximum distance per cell type in all tissue subtypes.</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>cell_type_level <span class="op">=</span> <span class="st">'Level Two Cell Type'</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_type_level <span class="op">=</span> df_all_edges_with_cell_types[(df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type Level'</span>] <span class="op">==</span> cell_type_level) <span class="op">&amp;</span> (df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type'</span>] <span class="op">==</span> anchor_cell_type_dict[cell_type_level])]</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level <span class="op">=</span> df_all_edges_with_cell_type_level.groupby([cell_type_level, <span class="st">'Tissue Subtype'</span>]).agg(</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>),</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>),</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    min_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'min'</span>),</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    max_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'max'</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Level Two Cell Type</th>
<th data-quarto-table-cell-role="th">Tissue Subtype</th>
<th data-quarto-table-cell-role="th">mean_distance</th>
<th data-quarto-table-cell-role="th">median_distance</th>
<th data-quarto-table-cell-role="th">min_distance</th>
<th data-quarto-table-cell-role="th">max_distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>b cell</td>
<td>Large Intestine</td>
<td>27.053305</td>
<td>21.526179</td>
<td>0.843937</td>
<td>197.546834</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>b cell</td>
<td>Small Intestine</td>
<td>21.818137</td>
<td>17.894644</td>
<td>0.000000</td>
<td>191.707070</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>dendritic cell</td>
<td>Large Intestine</td>
<td>28.327602</td>
<td>21.410062</td>
<td>0.843937</td>
<td>198.968722</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>dendritic cell</td>
<td>Small Intestine</td>
<td>22.322890</td>
<td>16.056992</td>
<td>0.377420</td>
<td>198.825486</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>endocrine cell</td>
<td>Large Intestine</td>
<td>36.294670</td>
<td>31.225661</td>
<td>1.601257</td>
<td>199.648045</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>endocrine cell</td>
<td>Small Intestine</td>
<td>40.786922</td>
<td>31.225661</td>
<td>1.193507</td>
<td>199.569903</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>endothelial cell of lymphatic vessel</td>
<td>Large Intestine</td>
<td>37.245417</td>
<td>27.113891</td>
<td>0.377420</td>
<td>199.705116</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>endothelial cell of lymphatic vessel</td>
<td>Small Intestine</td>
<td>26.096485</td>
<td>17.802866</td>
<td>0.377420</td>
<td>199.313497</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>enterocyte</td>
<td>Large Intestine</td>
<td>41.954515</td>
<td>34.853669</td>
<td>0.377420</td>
<td>199.984527</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>enterocyte</td>
<td>Small Intestine</td>
<td>49.309524</td>
<td>34.872056</td>
<td>0.000000</td>
<td>199.987020</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>goblet cell</td>
<td>Large Intestine</td>
<td>39.134738</td>
<td>33.146416</td>
<td>0.377420</td>
<td>199.371021</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>goblet cell</td>
<td>Small Intestine</td>
<td>42.001191</td>
<td>32.346017</td>
<td>0.000000</td>
<td>199.977404</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>lymphoid cell</td>
<td>Large Intestine</td>
<td>40.153142</td>
<td>32.768230</td>
<td>2.387014</td>
<td>189.225983</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>lymphoid cell</td>
<td>Small Intestine</td>
<td>63.133067</td>
<td>43.305553</td>
<td>0.000000</td>
<td>199.951759</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>macrophage</td>
<td>Large Intestine</td>
<td>41.718298</td>
<td>27.551660</td>
<td>0.533752</td>
<td>199.895115</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>macrophage</td>
<td>Small Intestine</td>
<td>28.724084</td>
<td>18.041308</td>
<td>0.533752</td>
<td>199.984527</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>muscle cell</td>
<td>Large Intestine</td>
<td>53.677561</td>
<td>45.674058</td>
<td>0.000000</td>
<td>199.998416</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>muscle cell</td>
<td>Small Intestine</td>
<td>35.881348</td>
<td>28.706259</td>
<td>0.000000</td>
<td>199.772153</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>natural killer cell</td>
<td>Large Intestine</td>
<td>29.557145</td>
<td>22.920304</td>
<td>3.042857</td>
<td>193.128436</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>natural killer cell</td>
<td>Small Intestine</td>
<td>36.501047</td>
<td>22.686050</td>
<td>0.000000</td>
<td>199.987020</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>neurecto-epithelial cell</td>
<td>Large Intestine</td>
<td>37.836789</td>
<td>26.159318</td>
<td>0.377420</td>
<td>199.877655</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>neurecto-epithelial cell</td>
<td>Small Intestine</td>
<td>27.136101</td>
<td>18.871000</td>
<td>0.843937</td>
<td>199.829545</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>neuron</td>
<td>Large Intestine</td>
<td>48.971272</td>
<td>39.629100</td>
<td>0.377420</td>
<td>199.878012</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>neuron</td>
<td>Small Intestine</td>
<td>34.567294</td>
<td>27.058671</td>
<td>0.533752</td>
<td>197.159960</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">24</th>
<td>neutrophil</td>
<td>Large Intestine</td>
<td>40.546310</td>
<td>24.832400</td>
<td>0.533752</td>
<td>199.580610</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">25</th>
<td>neutrophil</td>
<td>Small Intestine</td>
<td>32.473085</td>
<td>18.431857</td>
<td>0.377420</td>
<td>199.860551</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">26</th>
<td>paneth cell</td>
<td>Large Intestine</td>
<td>138.624783</td>
<td>154.596150</td>
<td>12.821175</td>
<td>199.554914</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">27</th>
<td>paneth cell</td>
<td>Small Intestine</td>
<td>32.606219</td>
<td>29.450854</td>
<td>0.533752</td>
<td>199.977404</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">28</th>
<td>stromal cell</td>
<td>Large Intestine</td>
<td>53.780477</td>
<td>41.228708</td>
<td>0.533752</td>
<td>199.984527</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">29</th>
<td>stromal cell</td>
<td>Small Intestine</td>
<td>45.676768</td>
<td>33.698344</td>
<td>0.000000</td>
<td>199.900103</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">30</th>
<td>t cell</td>
<td>Large Intestine</td>
<td>29.954248</td>
<td>23.765475</td>
<td>0.000000</td>
<td>199.947128</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">31</th>
<td>t cell</td>
<td>Small Intestine</td>
<td>34.966318</td>
<td>23.636257</td>
<td>0.000000</td>
<td>199.984527</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-43" class="cell" data-execution_count="35">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top five and bottom five cell types with respect to mean distance in small intestine and large intestine separately.</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_top_bottom_cell_types(df, cell_type_level, tissue_subtype, top_n<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the DataFrame for the specified tissue subtype and cell type level</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    df_filtered <span class="op">=</span> df[df[<span class="st">'Tissue Subtype'</span>] <span class="op">==</span> tissue_subtype]</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by the specified cell type level and calculate mean distance</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    df_grouped <span class="op">=</span> df_filtered.groupby(cell_type_level).agg(mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>)).reset_index()</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by mean distance to get top and bottom cell types</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    df_sorted <span class="op">=</span> df_grouped.sort_values(by<span class="op">=</span><span class="st">'mean_distance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get top N and bottom N cell types</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    top_cell_types <span class="op">=</span> df_sorted.head(top_n)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    bottom_cell_types <span class="op">=</span> df_sorted.tail(top_n)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> top_cell_types, bottom_cell_types</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for small intestine</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>top_bottom_si <span class="op">=</span> get_top_bottom_cell_types(df_all_edges_with_cell_type_level, cell_type_level, <span class="st">'Small Intestine'</span>)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 cell types in Small Intestine:"</span>)</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_si[<span class="dv">0</span>])</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Bottom 5 cell types in Small Intestine:"</span>)</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_si[<span class="dv">1</span>])</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for large intestine</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>top_bottom_li <span class="op">=</span> get_top_bottom_cell_types(df_all_edges_with_cell_type_level, cell_type_level, <span class="st">'Large Intestine'</span>)</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 cell types in Large Intestine:"</span>)</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_li[<span class="dv">0</span>])</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Bottom 5 cell types in Large Intestine:"</span>)</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_li[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in Small Intestine:
   Level Two Cell Type  mean_distance
6        lymphoid cell      63.133067
4           enterocyte      49.309524
14        stromal cell      45.676768
5          goblet cell      42.001191
2       endocrine cell      40.786922

Bottom 5 cell types in Small Intestine:
                     Level Two Cell Type  mean_distance
7                             macrophage      28.724084
10              neurecto-epithelial cell      27.136101
3   endothelial cell of lymphatic vessel      26.096485
1                         dendritic cell      22.322890
0                                 b cell      21.818137

Top 5 cell types in Large Intestine:
   Level Two Cell Type  mean_distance
13         paneth cell     138.624783
14        stromal cell      53.780477
8          muscle cell      53.677561
11              neuron      48.971272
4           enterocyte      41.954515

Bottom 5 cell types in Large Intestine:
    Level Two Cell Type  mean_distance
2        endocrine cell      36.294670
15               t cell      29.954248
9   natural killer cell      29.557145
1        dendritic cell      28.327602
0                b cell      27.053305</code></pre>
</div>
</div>
<div id="cell-44" class="cell" data-execution_count="36">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top five and bottom five cell types with respect to median distance in small intestine and large intestine separately.</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_top_bottom_cell_types(df, cell_type_level, tissue_subtype, top_n<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the DataFrame for the specified tissue subtype and cell type level</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    df_filtered <span class="op">=</span> df[df[<span class="st">'Tissue Subtype'</span>] <span class="op">==</span> tissue_subtype]</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by the specified cell type level and calculate median distance</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    df_grouped <span class="op">=</span> df_filtered.groupby(cell_type_level).agg(median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>)).reset_index()</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by median distance to get top and bottom cell types</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    df_sorted <span class="op">=</span> df_grouped.sort_values(by<span class="op">=</span><span class="st">'median_distance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get top N and bottom N cell types</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    top_cell_types <span class="op">=</span> df_sorted.head(top_n)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    bottom_cell_types <span class="op">=</span> df_sorted.tail(top_n)</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> top_cell_types, bottom_cell_types</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for small intestine</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>top_bottom_si <span class="op">=</span> get_top_bottom_cell_types(df_all_edges_with_cell_type_level, cell_type_level, <span class="st">'Small Intestine'</span>)</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 cell types in Small Intestine:"</span>)</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_si[<span class="dv">0</span>])</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Bottom 5 cell types in Small Intestine:"</span>)</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_si[<span class="dv">1</span>])</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for large intestine</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>top_bottom_li <span class="op">=</span> get_top_bottom_cell_types(df_all_edges_with_cell_type_level, cell_type_level, <span class="st">'Large Intestine'</span>)</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 cell types in Large Intestine:"</span>)</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_li[<span class="dv">0</span>])</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Bottom 5 cell types in Large Intestine:"</span>)</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_li[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in Small Intestine:
   Level Two Cell Type  median_distance
6        lymphoid cell        43.305553
4           enterocyte        34.872056
14        stromal cell        33.698344
5          goblet cell        32.346017
2       endocrine cell        31.225661

Bottom 5 cell types in Small Intestine:
                     Level Two Cell Type  median_distance
12                            neutrophil        18.431857
7                             macrophage        18.041308
0                                 b cell        17.894644
3   endothelial cell of lymphatic vessel        17.802866
1                         dendritic cell        16.056992

Top 5 cell types in Large Intestine:
   Level Two Cell Type  median_distance
13         paneth cell       154.596150
8          muscle cell        45.674058
14        stromal cell        41.228708
11              neuron        39.629100
4           enterocyte        34.853669

Bottom 5 cell types in Large Intestine:
    Level Two Cell Type  median_distance
12           neutrophil        24.832400
15               t cell        23.765475
9   natural killer cell        22.920304
0                b cell        21.526179
1        dendritic cell        21.410062</code></pre>
</div>
</div>
<div id="cell-45" class="cell" data-execution_count="37">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>calculate_regional_variability(df_all_edges_with_cell_type_level, cell_type_level)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regional Variability Analysis:
Mean: Average distance in each region
Std: Standard deviation of distances
CV: Coefficient of Variation (std/mean * 100%)
                   mean    std  CV (%)
Unique Region                         
Ascending         41.20  32.11    77.9
Descending        40.67  32.26    79.3
Duodenum          36.24  32.45    89.5
Ileum             37.43  33.54    89.6
Mid Jejunum       41.19  37.64    91.4
Proximal Jejunum  41.26  36.84    89.3
Sigmoid           48.92  35.83    73.2
Transverse        44.69  33.58    75.1

Cell Type Variability Analysis (sorted by CV):
                                       mean    std  CV (%)
Level Two Cell Type                                       
neutrophil                            35.60  38.33   107.7
natural killer cell                   33.64  33.72   100.2
macrophage                            34.30  34.07    99.3
t cell                                33.65  32.40    96.3
neurecto-epithelial cell              31.59  29.57    93.6
endothelial cell of lymphatic vessel  30.87  28.45    92.2
dendritic cell                        25.43  22.42    88.2
lymphoid cell                         57.05  47.42    83.1
stromal cell                          49.58  40.53    81.7
enterocyte                            46.48  36.86    79.3
neuron                                41.30  32.40    78.5
endocrine cell                        39.37  30.36    77.1
muscle cell                           45.43  34.12    75.1
goblet cell                           40.65  29.59    72.8
b cell                                23.99  17.20    71.7
paneth cell                           34.14  22.89    67.0</code></pre>
</div>
</div>
<div id="cell-46" class="cell" data-execution_count="38">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>plot_violin_cells_per_celltype_small_vs_large_intestine(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-47" class="cell" data-execution_count="39">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_boxplots_by_region(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-48" class="cell" data-execution_count="40">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_heatmap(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-41-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-49" class="cell" data-execution_count="41">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>plot_violin_plots_all_regions(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">"count"</span>) <span class="co"># Or, density_norm="count"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-42-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="level-three-cell-type-analysis" class="level3">
<h3 class="anchored" data-anchor-id="level-three-cell-type-analysis">Level Three Cell Type Analysis</h3>
<div id="cell-51" class="cell" data-execution_count="42">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get mean, median, minimum, maximum distance per cell type in all tissue subtypes.</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>cell_type_level <span class="op">=</span> <span class="st">'Level Three Cell Type'</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>df_all_edges_with_cell_type_level <span class="op">=</span> df_all_edges_with_cell_types[(df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type Level'</span>] <span class="op">==</span> cell_type_level) <span class="op">&amp;</span> (df_all_edges_with_cell_types[<span class="st">'Anchor Cell Type'</span>] <span class="op">==</span> anchor_cell_type_dict[cell_type_level])]</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level <span class="op">=</span> df_all_edges_with_cell_type_level.groupby([cell_type_level, <span class="st">'Tissue Subtype'</span>]).agg(</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>),</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>),</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    min_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'min'</span>),</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    max_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'max'</span>)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>df_distance_stats_cell_type_level</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Level Three Cell Type</th>
<th data-quarto-table-cell-role="th">Tissue Subtype</th>
<th data-quarto-table-cell-role="th">mean_distance</th>
<th data-quarto-table-cell-role="th">median_distance</th>
<th data-quarto-table-cell-role="th">min_distance</th>
<th data-quarto-table-cell-role="th">max_distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>b cell</td>
<td>Large Intestine</td>
<td>29.018398</td>
<td>22.347599</td>
<td>1.193507</td>
<td>195.356325</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>b cell</td>
<td>Small Intestine</td>
<td>27.518600</td>
<td>22.960665</td>
<td>0.377420</td>
<td>156.771564</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>dendritic cell</td>
<td>Large Intestine</td>
<td>28.327602</td>
<td>21.410062</td>
<td>0.843937</td>
<td>198.968722</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>dendritic cell</td>
<td>Small Intestine</td>
<td>22.322890</td>
<td>16.056992</td>
<td>0.377420</td>
<td>198.825486</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>endothelial cell of lymphatic vessel</td>
<td>Large Intestine</td>
<td>37.245417</td>
<td>27.113891</td>
<td>0.377420</td>
<td>199.705116</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>endothelial cell of lymphatic vessel</td>
<td>Small Intestine</td>
<td>26.096485</td>
<td>17.802866</td>
<td>0.377420</td>
<td>199.313497</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>enterocyte</td>
<td>Large Intestine</td>
<td>39.822866</td>
<td>33.086197</td>
<td>0.377420</td>
<td>199.984527</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>enterocyte</td>
<td>Small Intestine</td>
<td>50.623921</td>
<td>35.085853</td>
<td>0.000000</td>
<td>199.977404</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>enterocyte:cd57+</td>
<td>Large Intestine</td>
<td>33.451914</td>
<td>30.388738</td>
<td>2.641940</td>
<td>156.161145</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>enterocyte:cd57+</td>
<td>Small Intestine</td>
<td>31.409334</td>
<td>25.782228</td>
<td>3.717156</td>
<td>199.954608</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>enterocyte:cd66+</td>
<td>Large Intestine</td>
<td>54.150643</td>
<td>44.593095</td>
<td>1.193507</td>
<td>199.899034</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>enterocyte:cd66+</td>
<td>Small Intestine</td>
<td>77.146245</td>
<td>62.703991</td>
<td>0.533752</td>
<td>199.878724</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>enterocyte:muc1+</td>
<td>Large Intestine</td>
<td>45.036560</td>
<td>40.120296</td>
<td>1.360807</td>
<td>198.518974</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>enterocyte:muc1+</td>
<td>Small Intestine</td>
<td>32.640887</td>
<td>29.031916</td>
<td>1.132260</td>
<td>198.929343</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>goblet cell</td>
<td>Large Intestine</td>
<td>39.134738</td>
<td>33.146416</td>
<td>0.377420</td>
<td>199.371021</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>goblet cell</td>
<td>Small Intestine</td>
<td>42.001191</td>
<td>32.346017</td>
<td>0.000000</td>
<td>199.977404</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>interstitial cell of cajal</td>
<td>Large Intestine</td>
<td>37.836789</td>
<td>26.159318</td>
<td>0.377420</td>
<td>199.877655</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>interstitial cell of cajal</td>
<td>Small Intestine</td>
<td>27.136101</td>
<td>18.871000</td>
<td>0.843937</td>
<td>199.829545</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>lymphocyte:cd7+</td>
<td>Large Intestine</td>
<td>40.153142</td>
<td>32.768230</td>
<td>2.387014</td>
<td>189.225983</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>lymphocyte:cd7+</td>
<td>Small Intestine</td>
<td>63.133067</td>
<td>43.305553</td>
<td>0.000000</td>
<td>199.951759</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>macrophage</td>
<td>Large Intestine</td>
<td>44.336284</td>
<td>29.528141</td>
<td>0.533752</td>
<td>199.895115</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>macrophage</td>
<td>Small Intestine</td>
<td>30.807581</td>
<td>19.614950</td>
<td>0.843937</td>
<td>199.984527</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>macrophage:inflammatory</td>
<td>Large Intestine</td>
<td>27.235706</td>
<td>20.935756</td>
<td>1.360807</td>
<td>193.407037</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>macrophage:inflammatory</td>
<td>Small Intestine</td>
<td>18.758805</td>
<td>12.986758</td>
<td>0.533752</td>
<td>199.290626</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">24</th>
<td>muscle cell:smooth</td>
<td>Large Intestine</td>
<td>53.677561</td>
<td>45.674058</td>
<td>0.000000</td>
<td>199.998416</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">25</th>
<td>muscle cell:smooth</td>
<td>Small Intestine</td>
<td>35.881348</td>
<td>28.706259</td>
<td>0.000000</td>
<td>199.772153</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">26</th>
<td>natural killer cell</td>
<td>Large Intestine</td>
<td>29.557145</td>
<td>22.920304</td>
<td>3.042857</td>
<td>193.128436</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">27</th>
<td>natural killer cell</td>
<td>Small Intestine</td>
<td>36.501047</td>
<td>22.686050</td>
<td>0.000000</td>
<td>199.987020</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">28</th>
<td>neuroendocrine cell</td>
<td>Large Intestine</td>
<td>36.294670</td>
<td>31.225661</td>
<td>1.601257</td>
<td>199.648045</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">29</th>
<td>neuroendocrine cell</td>
<td>Small Intestine</td>
<td>40.786922</td>
<td>31.225661</td>
<td>1.193507</td>
<td>199.569903</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">30</th>
<td>neuron</td>
<td>Large Intestine</td>
<td>48.971272</td>
<td>39.629100</td>
<td>0.377420</td>
<td>199.878012</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">31</th>
<td>neuron</td>
<td>Small Intestine</td>
<td>34.567294</td>
<td>27.058671</td>
<td>0.533752</td>
<td>197.159960</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">32</th>
<td>neutrophil</td>
<td>Large Intestine</td>
<td>40.546310</td>
<td>24.832400</td>
<td>0.533752</td>
<td>199.580610</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">33</th>
<td>neutrophil</td>
<td>Small Intestine</td>
<td>32.473085</td>
<td>18.431857</td>
<td>0.377420</td>
<td>199.860551</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">34</th>
<td>paneth cell</td>
<td>Large Intestine</td>
<td>138.624783</td>
<td>154.596150</td>
<td>12.821175</td>
<td>199.554914</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">35</th>
<td>paneth cell</td>
<td>Small Intestine</td>
<td>32.606219</td>
<td>29.450854</td>
<td>0.533752</td>
<td>199.977404</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">36</th>
<td>plasma cell</td>
<td>Large Intestine</td>
<td>26.523197</td>
<td>21.330074</td>
<td>0.843937</td>
<td>197.546834</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">37</th>
<td>plasma cell</td>
<td>Small Intestine</td>
<td>20.214029</td>
<td>16.849172</td>
<td>0.000000</td>
<td>191.707070</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">38</th>
<td>stromal cell</td>
<td>Large Intestine</td>
<td>53.780477</td>
<td>41.228708</td>
<td>0.533752</td>
<td>199.984527</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">39</th>
<td>stromal cell</td>
<td>Small Intestine</td>
<td>45.676768</td>
<td>33.698344</td>
<td>0.000000</td>
<td>199.900103</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">40</th>
<td>t cell:cd4+</td>
<td>Large Intestine</td>
<td>27.552400</td>
<td>21.516250</td>
<td>0.000000</td>
<td>199.626640</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">41</th>
<td>t cell:cd4+</td>
<td>Small Intestine</td>
<td>23.445133</td>
<td>17.802866</td>
<td>0.377420</td>
<td>199.681220</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">42</th>
<td>t cell:cd8+ alpha-beta</td>
<td>Large Intestine</td>
<td>32.725200</td>
<td>26.289680</td>
<td>1.193507</td>
<td>199.947128</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">43</th>
<td>t cell:cd8+ alpha-beta</td>
<td>Small Intestine</td>
<td>40.672900</td>
<td>27.197819</td>
<td>0.000000</td>
<td>199.984527</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">44</th>
<td>transit amplifying cell</td>
<td>Large Intestine</td>
<td>40.889106</td>
<td>34.347294</td>
<td>0.754840</td>
<td>199.984527</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">45</th>
<td>transit amplifying cell</td>
<td>Small Intestine</td>
<td>47.585919</td>
<td>35.930304</td>
<td>0.377420</td>
<td>199.987020</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">46</th>
<td>transit amplifying cell:proliferating</td>
<td>Large Intestine</td>
<td>38.313899</td>
<td>33.266528</td>
<td>1.132260</td>
<td>199.946060</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">47</th>
<td>transit amplifying cell:proliferating</td>
<td>Small Intestine</td>
<td>39.587575</td>
<td>32.425189</td>
<td>0.843937</td>
<td>199.793187</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-52" class="cell" data-execution_count="43">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top five and bottom five cell types with respect to mean distance in small intestine and large intestine separately.</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_top_bottom_cell_types(df, cell_type_level, tissue_subtype, top_n<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the DataFrame for the specified tissue subtype and cell type level</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    df_filtered <span class="op">=</span> df[df[<span class="st">'Tissue Subtype'</span>] <span class="op">==</span> tissue_subtype]</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by the specified cell type level and calculate mean distance</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    df_grouped <span class="op">=</span> df_filtered.groupby(cell_type_level).agg(mean_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'mean'</span>)).reset_index()</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by mean distance to get top and bottom cell types</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    df_sorted <span class="op">=</span> df_grouped.sort_values(by<span class="op">=</span><span class="st">'mean_distance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get top N and bottom N cell types</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>    top_cell_types <span class="op">=</span> df_sorted.head(top_n)</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    bottom_cell_types <span class="op">=</span> df_sorted.tail(top_n)</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> top_cell_types, bottom_cell_types</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for small intestine</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>top_bottom_si <span class="op">=</span> get_top_bottom_cell_types(df_all_edges_with_cell_type_level, cell_type_level, <span class="st">'Small Intestine'</span>)</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 cell types in Small Intestine:"</span>)</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_si[<span class="dv">0</span>])</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Bottom 5 cell types in Small Intestine:"</span>)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_si[<span class="dv">1</span>])</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for large intestine</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>top_bottom_li <span class="op">=</span> get_top_bottom_cell_types(df_all_edges_with_cell_type_level, cell_type_level, <span class="st">'Large Intestine'</span>)</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 cell types in Large Intestine:"</span>)</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_li[<span class="dv">0</span>])</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Bottom 5 cell types in Large Intestine:"</span>)</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_li[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in Small Intestine:
      Level Three Cell Type  mean_distance
5          enterocyte:cd66+      77.146245
9           lymphocyte:cd7+      63.133067
3                enterocyte      50.623921
22  transit amplifying cell      47.585919
19             stromal cell      45.676768

Bottom 5 cell types in Small Intestine:
                   Level Three Cell Type  mean_distance
2   endothelial cell of lymphatic vessel      26.096485
20                           t cell:cd4+      23.445133
1                         dendritic cell      22.322890
18                           plasma cell      20.214029
11               macrophage:inflammatory      18.758805

Top 5 cell types in Large Intestine:
   Level Three Cell Type  mean_distance
17           paneth cell     138.624783
5       enterocyte:cd66+      54.150643
19          stromal cell      53.780477
12    muscle cell:smooth      53.677561
15                neuron      48.971272

Bottom 5 cell types in Large Intestine:
      Level Three Cell Type  mean_distance
0                    b cell      29.018398
1            dendritic cell      28.327602
20              t cell:cd4+      27.552400
11  macrophage:inflammatory      27.235706
18              plasma cell      26.523197</code></pre>
</div>
</div>
<div id="cell-53" class="cell" data-execution_count="44">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top five and bottom five cell types with respect to median distance in small intestine and large intestine separately.</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_top_bottom_cell_types(df, cell_type_level, tissue_subtype, top_n<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the DataFrame for the specified tissue subtype and cell type level</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    df_filtered <span class="op">=</span> df[df[<span class="st">'Tissue Subtype'</span>] <span class="op">==</span> tissue_subtype]</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by the specified cell type level and calculate median distance</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    df_grouped <span class="op">=</span> df_filtered.groupby(cell_type_level).agg(median_distance<span class="op">=</span>(<span class="st">'Distance'</span>, <span class="st">'median'</span>)).reset_index()</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by median distance to get top and bottom cell types</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>    df_sorted <span class="op">=</span> df_grouped.sort_values(by<span class="op">=</span><span class="st">'median_distance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get top N and bottom N cell types</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    top_cell_types <span class="op">=</span> df_sorted.head(top_n)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>    bottom_cell_types <span class="op">=</span> df_sorted.tail(top_n)</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> top_cell_types, bottom_cell_types</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for small intestine</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>top_bottom_si <span class="op">=</span> get_top_bottom_cell_types(df_all_edges_with_cell_type_level, cell_type_level, <span class="st">'Small Intestine'</span>)</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 cell types in Small Intestine:"</span>)</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_si[<span class="dv">0</span>])</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Bottom 5 cell types in Small Intestine:"</span>)</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_si[<span class="dv">1</span>])</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top and bottom cell types for large intestine</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>top_bottom_li <span class="op">=</span> get_top_bottom_cell_types(df_all_edges_with_cell_type_level, cell_type_level, <span class="st">'Large Intestine'</span>)</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 cell types in Large Intestine:"</span>)</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_li[<span class="dv">0</span>])</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Bottom 5 cell types in Large Intestine:"</span>)</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_bottom_li[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 cell types in Small Intestine:
      Level Three Cell Type  median_distance
5          enterocyte:cd66+        62.703991
9           lymphocyte:cd7+        43.305553
22  transit amplifying cell        35.930304
3                enterocyte        35.085853
19             stromal cell        33.698344

Bottom 5 cell types in Small Intestine:
                   Level Three Cell Type  median_distance
2   endothelial cell of lymphatic vessel        17.802866
20                           t cell:cd4+        17.802866
18                           plasma cell        16.849172
1                         dendritic cell        16.056992
11               macrophage:inflammatory        12.986758

Top 5 cell types in Large Intestine:
   Level Three Cell Type  median_distance
17           paneth cell       154.596150
12    muscle cell:smooth        45.674058
5       enterocyte:cd66+        44.593095
19          stromal cell        41.228708
6       enterocyte:muc1+        40.120296

Bottom 5 cell types in Large Intestine:
      Level Three Cell Type  median_distance
0                    b cell        22.347599
20              t cell:cd4+        21.516250
1            dendritic cell        21.410062
18              plasma cell        21.330074
11  macrophage:inflammatory        20.935756</code></pre>
</div>
</div>
<div id="cell-54" class="cell" data-execution_count="45">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>calculate_regional_variability(df_all_edges_with_cell_type_level, cell_type_level)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regional Variability Analysis:
Mean: Average distance in each region
Std: Standard deviation of distances
CV: Coefficient of Variation (std/mean * 100%)
                   mean    std  CV (%)
Unique Region                         
Ascending         41.20  32.11    77.9
Descending        40.67  32.26    79.3
Duodenum          36.24  32.45    89.5
Ileum             37.43  33.54    89.6
Mid Jejunum       41.19  37.64    91.4
Proximal Jejunum  41.26  36.84    89.3
Sigmoid           48.92  35.83    73.2
Transverse        44.69  33.58    75.1

Cell Type Variability Analysis (sorted by CV):
                                        mean    std  CV (%)
Level Three Cell Type                                      
neutrophil                             35.60  38.33   107.7
natural killer cell                    33.64  33.72   100.2
macrophage                             36.69  35.65    97.2
t cell:cd8+ alpha-beta                 39.10  37.03    94.7
interstitial cell of cajal             31.59  29.57    93.6
macrophage:inflammatory                22.15  20.61    93.0
endothelial cell of lymphatic vessel   30.87  28.45    92.2
dendritic cell                         25.43  22.42    88.2
lymphocyte:cd7+                        57.05  47.42    83.1
enterocyte                             47.21  38.67    81.9
stromal cell                           49.58  40.53    81.7
t cell:cd4+                            24.94  20.31    81.4
neuron                                 41.30  32.40    78.5
neuroendocrine cell                    39.37  30.36    77.1
enterocyte:cd57+                       31.65  23.87    75.4
muscle cell:smooth                     45.43  34.12    75.1
transit amplifying cell                44.71  32.94    73.7
goblet cell                            40.65  29.59    72.8
plasma cell                            22.84  16.21    71.0
b cell                                 28.13  19.82    70.5
enterocyte:cd66+                       58.73  39.94    68.0
transit amplifying cell:proliferating  38.97  26.29    67.5
paneth cell                            34.14  22.89    67.0
enterocyte:muc1+                       38.46  24.06    62.6</code></pre>
</div>
</div>
<div id="cell-55" class="cell" data-execution_count="46">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>plot_violin_cells_per_celltype_small_vs_large_intestine(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-47-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-56" class="cell" data-execution_count="47">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_boxplots_by_region(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-48-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-57" class="cell" data-execution_count="48">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>plot_distance_distribution_heatmap(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-49-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-58" class="cell" data-execution_count="49">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>plot_violin_plots_all_regions(df_all_edges_with_cell_type_level, cell_type_level, os.path.join(basepath, figures_output_dir), density_norm<span class="op">=</span><span class="st">"count"</span>) <span class="co"># Or, density_norm="count"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="04_distance_analysis__intestine-codex-stanford_files/figure-html/cell-50-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/cns-iu\.github\.io\/hra-cell-distance-analysis");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/cns-iu/hra-cell-distance-analysis/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>